@helper toRocDate(DateTime inDate)
{
    int year = int.Parse(inDate.Year.ToString()) - 1911;
    string outDate = year.ToString() + inDate.ToString("-MM-dd");
    @outDate
}

@helper setDateTime(string DateField, string TimeField = "", string ToHide = "", string maxDateTime = "0", string minDateTime = "", string St_MinDate = "", string St_MaxDate = "",string zindex="")
{
    @:<script type="text/javascript">
        @:$(function(){
            @:var now = new Date();
            @:var maxDate = new Date();
            @:var minDate = new Date();
            if (maxDateTime != "")
            {
                @:var addDay =  @(maxDateTime);
                @:maxDate.setDate( now.getDate() + addDay );
            }
            if (minDateTime != "")
            {
                @:var devDay = @(minDateTime);
                @:minDate.setDate( now.getDate() - devDay);
            }
            if (St_MinDate != "")
            {
                @:minDate = new Date('@St_MinDate');
            }
            if (St_MaxDate != "")
            {
                @:maxDate = new Date('@St_MaxDate');
            }
            @:$("#@(DateField)").removeAttr('readonly');
            @:$("#@(DateField)").attr("readonly",true);
            @:$("#@(DateField)").css({ "width": "80px"});
            @:$("#@(DateField)").css({ "font-size": "12px"});
            if (TimeField != "")
            {
                @:$("#@(TimeField)").css({ "width": "50px" });
                @:$("#@(TimeField)").removeAttr('readonly');
                @:$("#@(TimeField)").attr("readonly",true);
                @:$("#@(TimeField)").css({ "font-size": "12px"});
            }
            @:$("#@(DateField)").datetimepicker({
                if (TimeField != "")
                {
                    @:altField:"#@(TimeField)",
                }
                else
                {
                    @:showTimepicker: false,
                }
                if (ToHide != "")
                {
                    if (TimeField != "")
                    {
                    @:onClose: function (dateText) {
                        @:$("#@(ToHide)").val(dateText + " " + $("#@(TimeField)").val());
                    @:},
                    }
                    else
                    {
                    @:onClose: function (dateText) {
                        @:$("#@(ToHide)").val(dateText + " 00:00");
                    @:},
                    }
                }
                @:beforeShowDay: function(date){
                    @:switch(date.getDay()){
                        @:case 6:
                            @:return [true, 'satday'];
                        @:break;
                        @:case 0:
                            @:return [true, 'sunday'];
                        @:break;
                        @:default:
                            @:return [true, ''];
                        @:break;
                    @:}
                @:},
                if (zindex!="")//zinex層數
                {
                @:beforeShow: function(){
                @:setTimeout(function(){$('#ui-datepicker-div').css({'z-index':'@(zindex)'})},0);
                @:},
                }

                @:inline: true,
                @:changeYear: true,
                @:changeMonth: true,
                @:showAnim: "slideDown",
                @:controlType: myControl,
                if (minDateTime != "" || St_MinDate != "")
                {
                    @:minDateTime: minDate,
                }
                if (maxDateTime != "" || St_MaxDate != "")
                {
                    @:maxDateTime: maxDate,
                }
                @:addSliderAccess: true,
    	        @:sliderAccessArgs: { touchonly: false }
            @:});
        @:});
    @:</script>    
}

@helper setDateTime_new(string DateField, string TimeField = "", string ToHide = "", string maxDateTime = "0", string minDateTime = "", string St_MinDate = "", string St_MaxDate = "", string zindex = "")
{
    @:<script type="text/javascript">
        @:$(function(){
            @:change_flag = false;
            @:var now = new Date();
            @:var maxDate = new Date();
            @:var minDate = new Date();
            if (maxDateTime != "")
            {
                @:var addDay =  @(maxDateTime);
                @:maxDate.setDate( now.getDate() + addDay );
            }
            if (minDateTime != "")
            {
                @:var devDay = @(minDateTime);
                @:minDate.setDate( now.getDate() - devDay);
                @:minDate.setHours(0,0,0,0);      //20181022增加，本日前n天(因為在入院時間後，所以調整為0點0分0秒0毫秒)
            }
            if (St_MinDate != "")
            {
                @:minDate = new Date('@St_MinDate');
            }
            if (St_MaxDate != "")
            {
                @:maxDate = new Date('@St_MaxDate');
            }
            @:$("#@(DateField)").removeAttr('readonly');
            @:$("#@(DateField)").attr("readonly",true);
            @:$("#@(DateField)").css({ "width": "80px"});
            @:$("#@(DateField)").css({ "font-size": "12px"});
            if (TimeField != "")
            {
                @:$("#@(TimeField)").css({ "width": "50px" });
                @:$("#@(TimeField)").removeAttr('readonly');
                @:$("#@(TimeField)").attr("readonly",true);
                @:$("#@(TimeField)").css({ "font-size": "12px"});
            }
            @:$("#@(DateField)").datetimepicker({
                if (TimeField != "")
                {
                    @:altField:"#@(TimeField)",
                }
                else
                {
                    @:showTimepicker: false,  //不顯示時間選擇器
                    @:showButtonPanel: false, //不顯示完成、現在的按鈕
                    @:onSelect: function() {  //選一個日期就自動關閉
						@:$("#@(DateField)").datepicker("hide");
					@:},
                }
                if (ToHide != "")
                {
                    if (TimeField != "")
                    {
                    @:onClose: function (dateText) {
                        @:$("#@(ToHide)").val(dateText + " " + $("#@(TimeField)").val());
                    @:},
                    }
                    else
                    {
                    @:onClose: function (dateText) {
                        @:$("#@(ToHide)").val(dateText + " 00:00");
                    @:},
                    }
                }
                @:beforeShowDay: function(date){
                    @:switch(date.getDay()){
                        @:case 6:
                            @:return [true, 'satday'];
                        @:break;
                        @:case 0:
                            @:return [true, 'sunday'];
                        @:break;
                        @:default:
                            @:return [true, ''];
                        @:break;
                    @:}
                @:},
                if (zindex!="")//zindex層數
                {
                @:beforeShow: function(){
                @:setTimeout(function(){$('#ui-datepicker-div').css({'z-index':'@(zindex)'})},0);
                @:},
                }

                @:inline: true,
                @:changeYear: true,
                @:changeMonth: true,
                @:showAnim: "slideDown",
                @:controlType: myControl,
                if (minDateTime != "" || St_MinDate != "")
                {
                    @:minDateTime: minDate,
                }
                else
                {
                    @:minDateTime: null,

                }
                if (maxDateTime != "" || St_MaxDate != "")
                {
                    @:maxDateTime: maxDate,
                }
                else
                {
                    @:maxDateTime: null,
                }
                @:addSliderAccess: true,
    	        @:sliderAccessArgs: { touchonly: false }
            @:});
        @:});

    @:</script>
}

@helper  complementList_Status(bool complement_List_Status, string InDate, string nowDateTime, string DateField, string TimeField = "", bool needRange = false, string maxDateTime = "0", string zindex = "")
{
    @:<script type="text/javascript" src="../Scripts/JSTool.js?@(NIS.Controllers.BaseController.build_date_str)"></script>


    @:<script type="text/javascript">
    @:$(window).focus(function () {
             @:check_userdate();
        @:});
    @:$(window).change(function () {
             @:check_userdate();
    @:});

    @:</script>
if (needRange)
{
    if (complement_List_Status)
    { //能選 住院日到今天
            @WebTool.setDateTime_new(DateField, TimeField, "", maxDateTime, "", InDate, "", zindex)

    }
    else
    {
        if (InDate == nowDateTime)
        { //若住院日為今天，只能選 入院時間到當下時間
                @WebTool.setDateTime_new(DateField, TimeField, "", maxDateTime, "", InDate, "", zindex)

        }
        else
        {//只能選 昨天跟今天
                @WebTool.setDateTime_new(DateField, TimeField, "", maxDateTime, "1", "", "", zindex)
        }
    }
}
else
{
    if (InDate != "")
    {
        @WebTool.setDateTime_new(DateField, TimeField, "", maxDateTime, "1", InDate, "", zindex)
    }
    else
    {
        @WebTool.setDateTime_new(DateField, TimeField, "", maxDateTime, "", "", "", zindex)
        }
    }
}
@helper setDate(string pType, string DateField)
{
    @:<script type="text/javascript">
		@:var NewDate = new Date($("#@(DateField)").val());
		@:$("#@(DateField)").datetimepicker({
			@:if (pType == 'prev'){
				@:$("#@(DateField)").datepicker("setDate", NewDate.getDate() + addDay);
			@:}else if (pType == 'next'){
				@:$("#@(DateField)").datepicker("setDate", NewDate.getDate() - devDay);
    			@:}else{
                @:$("#@(DateField)").datepicker("setDate", NewDate.getDate() );
            @:}
		@:});
	@:</script>
}