var GridViewScrollOptions=function(){},GridViewScrollScrollPosition=function(){},GridViewScroll=function(){function e(e){this._initialized=!1,null==e.elementID&&(e.elementID=""),null==e.width&&(e.width="700"),null==e.height&&(e.height="350"),null==e.freezeColumnCssClass&&(e.freezeColumnCssClass=""),null==e.freezeFooterCssClass&&(e.freezeFooterCssClass=""),null==e.freezeHeaderRowCount&&(e.freezeHeaderRowCount=1),null==e.freezeColumnCount&&(e.freezeColumnCount=1),this.initializeOptions(e)}return e.prototype.initializeOptions=function(e){this.GridID=e.elementID,this.GridWidth=e.width,this.GridHeight=e.height,this.FreezeColumn=e.freezeColumn,this.FreezeFooter=e.freezeFooter,this.FreezeColumnCssClass=e.freezeColumnCssClass,this.FreezeFooterCssClass=e.freezeFooterCssClass,this.FreezeHeaderRowCount=e.freezeHeaderRowCount,this.FreezeColumnCount=e.freezeColumnCount,this.OnScroll=e.onscroll},e.prototype.enhance=function(){if(this.FreezeCellWidths=[],this.IsVerticalScrollbarEnabled=!1,this.IsHorizontalScrollbarEnabled=!1,null!=this.GridID&&""!=this.GridID&&(this.ContentGrid=document.getElementById(this.GridID),null!=this.ContentGrid&&!(this.ContentGrid.rows.length<2))){if(this._initialized&&this.undo(),this._initialized=!0,this.Parent=this.ContentGrid.parentNode,this.ContentGrid.style.display="none","string"==typeof this.GridWidth&&-1<this.GridWidth.indexOf("%")){var e=parseInt(this.GridWidth);this.Width=this.Parent.offsetWidth*e/100}else this.Width=parseInt(this.GridWidth);if("string"==typeof this.GridHeight&&-1<this.GridHeight.indexOf("%")){e=parseInt(this.GridHeight);this.Height=this.Parent.offsetHeight*e/100}else this.Height=parseInt(this.GridHeight);this.ContentGrid.style.display="",this.ContentGridHeaderRows=this.getGridHeaderRows(),this.ContentGridItemRow=this.ContentGrid.rows.item(this.FreezeHeaderRowCount);var t=this.ContentGrid.rows.length-1;this.ContentGridFooterRow=this.ContentGrid.rows.item(t),this.Content=document.createElement("div"),this.Content.id=this.GridID+"_Content",this.Content.style.position="relative",this.Content=this.Parent.insertBefore(this.Content,this.ContentGrid),this.ContentFixed=document.createElement("div"),this.ContentFixed.id=this.GridID+"_Content_Fixed",this.ContentFixed.style.overflow="auto",this.ContentFixed=this.Content.appendChild(this.ContentFixed),this.ContentGrid=this.ContentFixed.appendChild(this.ContentGrid),this.ContentFixed.style.width=String(this.Width)+"px",this.ContentGrid.offsetWidth>this.Width&&(this.IsHorizontalScrollbarEnabled=!0),this.ContentGrid.offsetHeight>this.Height&&(this.IsVerticalScrollbarEnabled=!0),this.Header=document.createElement("div"),this.Header.id=this.GridID+"_Header",this.Header.style.position="relative",this.HeaderFixed=document.createElement("div"),this.HeaderFixed.id=this.GridID+"_Header_Fixed",this.HeaderFixed.style.overflow="hidden",this.Header=this.Parent.insertBefore(this.Header,this.Content),this.HeaderFixed=this.Header.appendChild(this.HeaderFixed),this.ScrollbarWidth=this.getScrollbarWidth(),this.prepareHeader(),this.calculateHeader(),this.Header.style.width=String(this.Width)+"px",this.IsVerticalScrollbarEnabled?(this.HeaderFixed.style.width=String(this.Width-this.ScrollbarWidth)+"px",this.IsHorizontalScrollbarEnabled&&(this.ContentFixed.style.width=this.HeaderFixed.style.width,this.isRTL()?this.ContentFixed.style.paddingLeft=String(this.ScrollbarWidth)+"px":this.ContentFixed.style.paddingRight=String(this.ScrollbarWidth)+"px"),this.ContentFixed.style.height=String(this.Height-this.Header.offsetHeight)+"px"):(this.HeaderFixed.style.width=this.Header.style.width,this.ContentFixed.style.width=this.Header.style.width),this.FreezeColumn&&this.IsHorizontalScrollbarEnabled&&(this.appendFreezeHeader(),this.appendFreezeContent()),this.FreezeFooter&&this.IsVerticalScrollbarEnabled&&(this.appendFreezeFooter(),this.FreezeColumn&&this.IsHorizontalScrollbarEnabled&&this.appendFreezeFooterColumn());var r=this;this.ContentFixed.onscroll=function(e){var t=r.ContentFixed.scrollTop,i=r.ContentFixed.scrollLeft;r.HeaderFixed.scrollLeft=i,null!=r.ContentFreeze&&(r.ContentFreeze.scrollTop=t),null!=r.FooterFreeze&&(r.FooterFreeze.scrollLeft=i),null!=r.OnScroll&&r.OnScroll(t,i)}}},Object.defineProperty(e.prototype,"scrollPosition",{get:function(){var e=new GridViewScrollScrollPosition;return e.scrollTop=this.ContentFixed.scrollTop,e.scrollLeft=this.ContentFixed.scrollLeft,e},set:function(e){var t=e.scrollTop,i=e.scrollLeft;this.ContentFixed.scrollTop=t,this.ContentFixed.scrollLeft=i,null!=this.ContentFreeze&&(this.ContentFreeze.scrollTop=t),null!=this.FooterFreeze&&(this.FooterFreeze.scrollLeft=i)},enumerable:!0,configurable:!0}),e.prototype.getGridHeaderRows=function(){for(var e=new Array,t=0;t<this.FreezeHeaderRowCount;t++)e.push(this.ContentGrid.rows.item(t));return e},e.prototype.prepareHeader=function(){this.HeaderGrid=this.ContentGrid.cloneNode(!1),this.HeaderGrid.id=this.GridID+"_Header_Fixed_Grid",this.HeaderGrid=this.HeaderFixed.appendChild(this.HeaderGrid),this.prepareHeaderGridRows();for(var e=0;e<this.ContentGridItemRow.cells.length;e++)this.appendHelperElement(this.ContentGridItemRow.cells.item(e)),this.appendHelperElement(this.HeaderGridHeaderCells[e])},e.prototype.prepareHeaderGridRows=function(){this.HeaderGridHeaderRows=new Array;for(var e=0;e<this.FreezeHeaderRowCount;e++){var t=this.ContentGridHeaderRows[e].cloneNode(!0);this.HeaderGridHeaderRows.push(t),this.HeaderGrid.appendChild(t)}this.prepareHeaderGridCells()},e.prototype.prepareHeaderGridCells=function(){this.HeaderGridHeaderCells=new Array;for(var e=0;e<this.ContentGridItemRow.cells.length;e++)for(var t in this.HeaderGridHeaderRows)for(var i=this.HeaderGridHeaderRows[t],r=0,n=0;n<i.cells.length;n++){var a=i.cells.item(n);1==a.colSpan&&e==r?this.HeaderGridHeaderCells.push(a):r+=a.colSpan-1,r++}},e.prototype.calculateHeader=function(){for(var e=0;e<this.ContentGridItemRow.cells.length;e++){var t=this.ContentGridItemRow.cells.item(e).firstChild,i=parseInt(String(t.offsetWidth));this.FreezeCellWidths.push(i),t.style.width=i+"px",(t=this.HeaderGridHeaderCells[e].firstChild).style.width=i+"px"}for(e=0;e<this.FreezeHeaderRowCount;e++)this.ContentGridHeaderRows[e].style.display="none"},e.prototype.appendFreezeHeader=function(){this.HeaderFreeze=document.createElement("div"),this.HeaderFreeze.id=this.GridID+"_Header_Freeze",this.HeaderFreeze.style.position="absolute",this.HeaderFreeze.style.overflow="hidden",this.HeaderFreeze.style.top="0px",this.HeaderFreeze.style.left="0px",this.HeaderFreeze.style.width="",this.HeaderFreezeGrid=this.HeaderGrid.cloneNode(!1),this.HeaderFreezeGrid.id=this.GridID+"_Header_Freeze_Grid",this.HeaderFreezeGrid=this.HeaderFreeze.appendChild(this.HeaderFreezeGrid),this.HeaderFreezeGridHeaderRows=new Array;for(var e=0;e<this.HeaderGridHeaderRows.length;e++){var t=this.HeaderGridHeaderRows[e].cloneNode(!1);this.HeaderFreezeGridHeaderRows.push(t);for(var i=0,r=0;r<this.FreezeColumnCount;){var n=this.HeaderGridHeaderRows[e].cells.item(i).cloneNode(!0);t.appendChild(n),r+=n.colSpan,i++}this.HeaderFreezeGrid.appendChild(t)}this.HeaderFreeze=this.Header.appendChild(this.HeaderFreeze)},e.prototype.appendFreezeContent=function(){this.ContentFreeze=document.createElement("div"),this.ContentFreeze.id=this.GridID+"_Content_Freeze",this.ContentFreeze.style.position="absolute",this.ContentFreeze.style.overflow="hidden",this.ContentFreeze.style.top="0px",this.ContentFreeze.style.left="0px",this.ContentFreeze.style.width="",this.ContentFreezeGrid=this.HeaderGrid.cloneNode(!1),this.ContentFreezeGrid.id=this.GridID+"_Content_Freeze_Grid",this.ContentFreezeGrid=this.ContentFreeze.appendChild(this.ContentFreezeGrid);for(var e=[],t=this.getPaddingTop(this.ContentGridItemRow.cells.item(0)),i=this.getPaddingBottom(this.ContentGridItemRow.cells.item(0)),r=0,n=!1,a=0;a<this.ContentGrid.rows.length;a++){1<(p=(u=this.ContentGrid.rows.item(a)).cells.item(0)).rowSpan&&(r=p.rowSpan,n=!0),"gridViewScrollHelper"==p.firstChild.className?p.firstChild:this.appendHelperElement(p);var l=parseInt(String(p.offsetHeight-t-i));e.push(l);var o=u.cloneNode(!1),s=p.cloneNode(!0);null==this.FreezeColumnCssClass&&""==this.FreezeColumnCssClass||(o.className=this.FreezeColumnCssClass);var d=0,h=0;for(n?(n=!1,r--):!n&&0<r&&(h++,r--);h<this.FreezeColumnCount;){var c=u.cells.item(d).cloneNode(!0);o.appendChild(c),h+=c.colSpan,d++}this.ContentFreezeGrid.appendChild(o)}for(a=0;a<this.ContentGrid.rows.length;a++){var u,p=(u=this.ContentGrid.rows.item(a)).cells.item(0);s=(o=this.ContentFreezeGrid.rows.item(a)).cells.item(0);p.firstChild.style.height=String(e[a])+"px",s.firstChild.style.height=String(e[a])+"px"}this.IsVerticalScrollbarEnabled?this.ContentFreeze.style.height=String(this.Height-this.Header.offsetHeight-this.ScrollbarWidth)+"px":this.ContentFreeze.style.height=String(this.ContentFixed.offsetHeight-this.ScrollbarWidth)+"px",this.ContentFreeze=this.Content.appendChild(this.ContentFreeze)},e.prototype.appendFreezeFooter=function(){this.FooterFreeze=document.createElement("div"),this.FooterFreeze.id=this.GridID+"_Footer_Freeze",this.FooterFreeze.style.position="absolute",this.FooterFreeze.style.overflow="hidden",this.FooterFreeze.style.left="0px",this.FooterFreeze.style.width=String(this.ContentFixed.offsetWidth-this.ScrollbarWidth)+"px",this.FooterFreezeGrid=this.HeaderGrid.cloneNode(!1),this.FooterFreezeGrid.id=this.GridID+"_Footer_Freeze_Grid",this.FooterFreezeGrid=this.FooterFreeze.appendChild(this.FooterFreezeGrid),this.FooterFreezeGridHeaderRow=this.ContentGridFooterRow.cloneNode(!0),null==this.FreezeFooterCssClass&&""==this.FreezeFooterCssClass||(this.FooterFreezeGridHeaderRow.className=this.FreezeFooterCssClass);for(var e=0;e<this.FooterFreezeGridHeaderRow.cells.length;e++){var t=this.FooterFreezeGridHeaderRow.cells.item(e);this.appendHelperElement(t).style.width=String(this.FreezeCellWidths[e])+"px"}this.FooterFreezeGridHeaderRow=this.FooterFreezeGrid.appendChild(this.FooterFreezeGridHeaderRow),this.FooterFreeze=this.Content.appendChild(this.FooterFreeze);var i=this.ContentFixed.offsetHeight-this.FooterFreeze.offsetHeight;this.IsHorizontalScrollbarEnabled&&(i-=this.ScrollbarWidth),this.FooterFreeze.style.top=String(i)+"px"},e.prototype.appendFreezeFooterColumn=function(){this.FooterFreezeColumn=document.createElement("div"),this.FooterFreezeColumn.id=this.GridID+"_Footer_FreezeColumn",this.FooterFreezeColumn.style.position="absolute",this.FooterFreezeColumn.style.overflow="hidden",this.FooterFreezeColumn.style.left="0px",this.FooterFreezeColumn.style.width="",this.FooterFreezeColumnGrid=this.HeaderGrid.cloneNode(!1),this.FooterFreezeColumnGrid.id=this.GridID+"_Footer_FreezeColumn_Grid",this.FooterFreezeColumnGrid=this.FooterFreezeColumn.appendChild(this.FooterFreezeColumnGrid),this.FooterFreezeColumnGridHeaderRow=this.FooterFreezeGridHeaderRow.cloneNode(!1),this.FooterFreezeColumnGridHeaderRow=this.FooterFreezeColumnGrid.appendChild(this.FooterFreezeColumnGridHeaderRow),null!=this.FreezeFooterCssClass&&(this.FooterFreezeColumnGridHeaderRow.className=this.FreezeFooterCssClass);for(var e=0,t=0;t<this.FreezeColumnCount;){var i=this.FooterFreezeGridHeaderRow.cells.item(e).cloneNode(!0);this.FooterFreezeColumnGridHeaderRow.appendChild(i),t+=i.colSpan,e++}var r=this.ContentFixed.offsetHeight-this.FooterFreeze.offsetHeight;this.IsHorizontalScrollbarEnabled&&(r-=this.ScrollbarWidth),this.FooterFreezeColumn.style.top=String(r)+"px",this.FooterFreezeColumn=this.Content.appendChild(this.FooterFreezeColumn)},e.prototype.appendHelperElement=function(e){var t=document.createElement("div");for(t.className="gridViewScrollHelper";e.hasChildNodes();)t.appendChild(e.firstChild);return e.appendChild(t)},e.prototype.getScrollbarWidth=function(){var e=document.createElement("p");e.style.width="100%",e.style.height="200px";var t=document.createElement("div");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden",t.style.width="200px",t.style.height="150px",t.style.overflow="hidden",t.appendChild(e),document.body.appendChild(t);var i=e.offsetWidth;t.style.overflow="scroll";var r=e.offsetWidth;return i===r&&(r=t.clientWidth),document.body.removeChild(t),i-r},e.prototype.isRTL=function(){return"rtl"===(window.getComputedStyle?window.getComputedStyle(this.ContentGrid,null).getPropertyValue("direction"):this.ContentGrid.currentStyle.direction)},e.prototype.getPaddingTop=function(e){var t="";return t=window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue("padding-Top"):e.currentStyle.paddingTop,parseInt(t)},e.prototype.getPaddingBottom=function(e){var t="";return t=window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue("padding-Bottom"):e.currentStyle.paddingBottom,parseInt(t)},e.prototype.undo=function(){this.undoHelperElement();for(var e=0,t=this.ContentGridHeaderRows;e<t.length;e++){t[e].style.display=""}this.Parent.insertBefore(this.ContentGrid,this.Header),this.Parent.removeChild(this.Header),this.Parent.removeChild(this.Content),this._initialized=!1},e.prototype.undoHelperElement=function(){for(var e=0;e<this.ContentGridItemRow.cells.length;e++){for(var t=(i=this.ContentGridItemRow.cells.item(e)).firstChild;t.hasChildNodes();)i.appendChild(t.firstChild);i.removeChild(t)}if(this.FreezeColumn)for(e=2;e<this.ContentGrid.rows.length;e++){var i;for(t=(i=this.ContentGrid.rows.item(e).cells.item(0)).firstChild;t.hasChildNodes();)i.appendChild(t.firstChild);i.removeChild(t)}},e}();function enhance(){gridViewScroll.enhance()}function undo(){gridViewScroll.undo()}function GrideViewScrollTable_initial(e,t,i,r,n,a,l){var o=new GridViewScrollOptions;o.elementID=e,o.width=a,o.height=l,o.freezeColumn=t,o.freezeFooter=i,o.freezeColumnCssClass="GridViewScrollItemFreeze",o.freezeFooterCssClass="GridViewScrollFooterFreeze",o.freezeHeaderRowCount=r,o.freezeColumnCount=n,new GridViewScroll(o).enhance()}var labDates_text=[],labDates_dateTime=[],labNames=[],labDateWithLabNames=[];function addDays(e,t){return e.setDate(e.getDate()+t),e}function getAlllabDates(e){labDates_text=[],labDates_dateTime=[],e.forEach(function(e){-1==labDates_text.indexOf(e.LabDate)&&(labDates_text.push(e.LabDate),labDates_dateTime.push(new Date(e.LabDate)))});var l=function(e){if(e.length<=1)return e;for(var t=Math.floor(e.length/2),i=e.splice(t,1)[0],r=[],n=[],a=0;a<e.length;a++)e[a]<i?r.push(e[a]):n.push(e[a]);return l(r).concat([i],l(n))};labDates_text=l(labDates_text).reverse(),labDates_dateTime=l(labDates_dateTime).reverse()}function getAllLabNames(e){labNames=[],e.forEach(function(e){if(-1==labNames.map(function(e){return e.name}).indexOf(e.LabName)){var t=getLabNameDetails(e);labNames.push(t)}}),labNames.sort(function(e,t){return e.name.toUpperCase()<t.name.toUpperCase()?-1:e.name.toUpperCase()>t.name.toUpperCase()?1:0})}function getLabNameDetails(e){return{name:e.LabName,specimen:e.Specimen,unit:e.LabValueUnit}}function getLabDateWithLabName(n){labDateWithLabNames=[],labDates_text.forEach(function(r){var e=n.filter(function(e,t,i){return e.LabDate==r}),i=[];e.forEach(function(e){var t=getRecordDetails(e);i.push(t)});var t=getDateName(r,i);labDateWithLabNames.push(t)})}function getDateName(e,t){return{labDate:e,labDetail:t}}function getRecordDetails(e){return{name:e.LabName,value:e.LabValue,errorFlag:e.LabErrorFlag}}function buildCareRecordTable(e,t,r){var i=document.getElementById(e),o=0,s=0,d=i.insertRow(-1);d.className="GridViewScrollHeader";var h=d.insertCell(0);h.innerHTML="項目",h.className="LabTitle SubTitle_name",(h=d.insertCell(1)).innerHTML="檢體",h.className="LabTitle SubTitle_specimen",(h=d.insertCell(2)).innerHTML="單位",h.className="LabTitle SubTitle_unit",o=3,labDates_dateTime.forEach(function(e){var t=e.getFullYear(),i=e.getMonth()+1,r=e.getDate(),n=e.getHours(),a=e.getMinutes(),l=e.getSeconds();i=i<10?"0"+i:i,r=r<10?"0"+r:r,n=n<10?"0"+n:n,a=a<10?"0"+a:a,l=l<10?"0"+l:l,h=d.insertCell(o),o++,h.innerHTML=t+"/"+i+"/"+r+"</br>"+n+":"+a+":"+l,h.id="LabDate"+s,s++});var n=0,a="#ABC8E2";for(s=0;s<labNames.length;s++){a=0==s||s%2==0?"#E1E6FA":"#ABC8E2";var l=i.insertRow(-1);l.className="GridViewScrollItem",l.style.backgroundColor=a,(h=l.insertCell(0)).innerHTML=labNames[s].name,h.className="SubTitle_name",(h=l.insertCell(1)).innerHTML=labNames[s].specimen,h.className="SubTitle_specimen",(h=l.insertCell(2)).innerHTML=labNames[s].unit,h.className="SubTitle_unit",o=3,n=0,labDates_text.forEach(function(e){var t=labDateWithLabNames[n].labDetail.map(function(e){return e.name}).indexOf(labNames[s].name);if(-1!=t){h=l.insertCell(o),o++;var i=labDateWithLabNames[n].labDetail[t].value;h.innerHTML=i,"Y"==labDateWithLabNames[n].labDetail[t].errorFlag&&(h.style.color="red"),r&&(h.innerHTML+='<input id="0" type="button" value="帶入" onclick="btn_write(\''+e+"', '"+labNames[s].name+"', '"+labNames[s].unit+"', '"+i+"');\" />")}else(h=l.insertCell(o)).innerHTML="",o++;n++})}}function buildEmptyCareRecordTable(e){var t=document.getElementById(e),i=t.insertRow(-1);i.className="GridViewScrollHeader";var r=i.insertCell(0);r.innerHTML="項目",r.style.width="160px",(r=i.insertCell(1)).innerHTML="檢體",r.style.width="123px",(r=i.insertCell(2)).innerHTML="單位",r.style.width="66px",(r=i.insertCell(3)).innerHTML="",r.id="LabDate0",r.style.width="160px";var n=t.insertRow(-1);n.className="GridViewScrollItem",n.style.backgroundColor="#ABC8E2",(r=n.insertCell(0)).innerHTML="",(r=n.insertCell(1)).innerHTML="",(r=n.insertCell(2)).innerHTML="",(r=n.insertCell(3)).innerHTML=""}function caculateCareRecord(e,t){getAlllabDates(t),getAllLabNames(t),getLabDateWithLabName(t)}var currObj,inquire_tubes=[],inquire_tubes_ID=[],timeBlocks=[],timeBlocks_total_index=[],timeBlocks_start_index=[0],time_tubes=[],D_txt="",E_txt="",N_txt="",DEN_txt="";function addDays(e,t){return e.setDate(e.getDate()+t),e}function getAllInquireTubes(e){for(inquire_tubes=[],inquire_tubes_ID=[],i=0;i<e.length;i++)-1==inquire_tubes.indexOf(e[i].TUBE_CONTENT)&&inquire_tubes.push(e[i].TUBE_CONTENT),-1==inquire_tubes_ID.indexOf(e[i].ITEMID)&&inquire_tubes_ID.push(e[i].ITEMID)}function getAllTimeBlocks(e,t,r,n){timeBlocks=[],timeBlocks_total_index=[],timeBlocks_start_index=[0];var a=0,l=e.concat(t).concat(r),o=l.length-n;for(i=0;i<=o;i+=n)i==o?timeBlocks.push(l[i]+"-"+l[0]):timeBlocks.push(l[i]+"-"+l[i+n]),a++,l[i+n]!=t[0]&&l[i+n]!=r[0]&&i!=o||(timeBlocks.push("小計"),timeBlocks_total_index.push(a),i!=o&&timeBlocks_start_index.push(a+1),a++)}function caculateDENAmount(e,t,i,u,r,n){var p,_,m,f,v,b;p=new Date(r[0],parseInt(r[1])-1,r[2],e[0]),_=new Date(r[0],parseInt(r[1])-1,r[2],e[7],59,59),m=new Date(r[0],parseInt(r[1])-1,r[2],t[0]),f=new Date(r[0],parseInt(r[1])-1,r[2],t[7],59,59),v=new Date(r[0],parseInt(r[1])-1,r[2],i[0]),b=new Date(r[0],parseInt(r[1])-1,r[2],i[7],59,59),b=addDays(b,1);var $=[];inquire_tubes.forEach(function(r){var n=0,a=0,l=0,o=0,s=!1,d=!1,h=!1,c=0,e=[];u.forEach(function(e){var t=new Date(e.CREATETIME);if(r==e.TUBE_CONTENT){var i=e.AMOUNT;null==e.AMOUNT&&(i=0),p<=t&&t<=_?(n+=parseFloat(i),"1"==e.REASON&&(s=!0)):m<=t&&t<=f?(a+=parseFloat(i),"1"==e.REASON&&(d=!0)):v<=t&&t<=b&&(l+=parseFloat(i),"1"==e.REASON&&(h=!0)),o+=parseFloat(i),"1"==e.REASON&&(c=!0)}});var t=getTubeDEN("D",n,s);e.push(t),t=getTubeDEN("E",a,d),e.push(t),t=getTubeDEN("N",l,h),e.push(t),t=getTubeDEN("All",o,c),e.push(t);var i=getTube(r,e);$.push(i)}),DEN_txt=N_txt=E_txt=D_txt="",$.forEach(function(t){t.DEN.forEach(function(e){0<e.amount&&("D"==e.jobBlock?D_txt=addTubeToTotal(t.tubeName,e.amount,e.hasLoss,D_txt,n):"E"==e.jobBlock?E_txt=addTubeToTotal(t.tubeName,e.amount,e.hasLoss,E_txt,n):"N"==e.jobBlock?N_txt=addTubeToTotal(t.tubeName,e.amount,e.hasLoss,N_txt,n):"All"==e.jobBlock&&(DEN_txt=addTubeToTotal(t.tubeName,e.amount,e.hasLoss,DEN_txt,n)))})})}function getDENTotalTxt(e,t,i,r,n,a){var l=n.split("/");getAllInquireTubes(r),caculateDENAmount(e,t,i,r,l,a);var o=[];return o.push(D_txt),o.push(E_txt),o.push(N_txt),o.push(DEN_txt),o}function getTube(e,t){return{tubeName:e,DEN:t}}function getTubeDEN(e,t,i){return{jobBlock:e,amount:t,hasLoss:i}}function addTubeToTotal(e,t,i,r,n){return""===r?r=i?e+"："+t+n+"+Loss":e+"："+t+n:r+=i?"； "+e+"："+t+n+"+Loss":"； "+e+"："+t+n,r}function getTimeTubesArray(h,c){time_tubes=[],timeBlocks.forEach(function(e){var a=[];if("小計"!=e){var l,o,t=e.split("-"),i=t[0],r=t[1],s=!1,d=0;parseInt(i)<7?(l=new Date(c[0],parseInt(c[1])-1,c[2],i),l=addDays(l,1),o=new Date(c[0],parseInt(c[1])-1,c[2],r),o=addDays(o,1)):i<r?(l=new Date(c[0],parseInt(c[1])-1,c[2],i),o=new Date(c[0],parseInt(c[1])-1,c[2],r)):r<i&&(l=new Date(c[0],parseInt(c[1])-1,c[2],i),o=new Date(c[0],parseInt(c[1])-1,c[2],r),o=addDays(o,1)),h.forEach(function(e){var t=new Date(e.CREATETIME),i={};if(l<=t&&t<o){var r=e.AMOUNT;null==r&&(r=0),"1"==e.REASON&&(s=!0),d+=parseFloat(r);var n=a.map(function(e){return e.tubeName}).indexOf(e.TUBE_CONTENT);if(-1!=n)a[n].amount=parseFloat(a[n].amount)+parseFloat(r),1==e.REASON&&(a[n].reason=1);else{i=getMatchTube(e.TUBE_CONTENT,r,e.REASON);a.push(i)}}});var n=getTimeTube(e,a,d,s);time_tubes.push(n)}})}function getTimeTube(e,t,i,r){return{timeBlock:e,tubes:t,totalAmount:i,hasLoss:r}}function getMatchTube(e,t,i){return{tubeName:e,amount:t,reason:i}}function buildTable(e,t,r){var n=document.getElementById(e),a=(t.split("/"),n.insertRow(-1));a.className="GridViewScrollHeader";var l=a.insertCell(0);for(l.innerHTML="引流管",l.className="HideCell",l.colSpan=2,(l=a.insertCell(1)).innerHTML="引流管",l.colSpan=inquire_tubes.length,l.id="InquireTubeTitle",(l=a.insertCell(2)).rowSpan=2,l.innerHTML="合計",l.style.width="72px",l.id="timeblockTotalTitle",(a=n.insertRow(-1)).className="GridViewScrollHeader",(l=a.insertCell(0)).innerHTML="班別",l.style.width="70px",l.style.height="20px",l.className="jobBlocksTitle",(l=a.insertCell(1)).innerHTML="時間\\管路",l.style.width="53px",l.className="timeBlocksTitle",i=0;i<inquire_tubes.length;i++)(l=a.insertCell(i+2)).innerHTML=inquire_tubes[i]+"<input type='button' value='明細' style='font-size: 12px;margin-left: 10px;' onclick='pup_window(\"Detail?show_by=tube&from_func=IO_Tube&itemid="+inquire_tubes_ID[i]+"&day="+t+'", "1000", "500");\'>',l.id="inquire_tube"+i,l.className="inquire_tube",l.style.textAlign="center";var o=0,s=0,d="#ABC8E2";for(i=0;i<timeBlocks.length;i++){var h;d=0==i||i%2==0?"#E1E6FA":"#ABC8E2",(h=n.insertRow(-1)).className="GridViewScrollItem",h.style.backgroundColor=d;var c=0;i==timeBlocks_start_index[0]?(l=h.insertCell(c),c++,l.innerHTML=t+"<br>"+r[o]+"<br><input type='button' value='帶入護理記錄' style='word-break:break-all;overflow:hidden;font-size: 12px;margin-top: 10px;  width: 70px; height: 45px; white-space: pre-wrap;' onclick='Take_CareRecord(\"D\", \""+t+'","2","白班")\'>',l.rowSpan=timeBlocks_total_index[0]+1,l.style.textAlign="center",l.style.width="70px",l.style.backgroundColor="#85A5CC",o++):i==timeBlocks_start_index[1]?(l=h.insertCell(c),c++,l.innerHTML=t+"<br>"+r[o]+"<br><input type='button' value='帶入護理記錄' style='word-break:break-all;overflow:hidden;font-size: 12px;margin-top: 10px;width: 70px; height: 45px; white-space: pre-wrap;' onclick='Take_CareRecord(\"E\", \""+t+'","2","小夜班")\'>',l.rowSpan=timeBlocks_total_index[0]+1,l.style.textAlign="center",l.style.width="70px",l.style.backgroundColor="#85A5CC",o++):i==timeBlocks_start_index[2]&&(l=h.insertCell(c),c++,l.innerHTML=t+"<br>"+r[o]+"<br><input type='button' value='帶入護理記錄' style='word-break:break-all;overflow:hidden;font-size: 12px;margin-top: 10px;width: 70px; height: 45px; white-space: pre-wrap;' onclick='Take_CareRecord(\"N\", \""+t+'","2","大夜班")\'>',l.rowSpan=timeBlocks_total_index[0]+1,l.style.textAlign="center",l.style.width="70px",l.style.backgroundColor="#85A5CC",o++),l=h.insertCell(c),c++,l.innerHTML=timeBlocks[i],l.style.width="53px";if(i==timeBlocks_total_index[0])l=h.insertCell(c),c++,l.innerHTML=""!=D_txt?"白班內："+D_txt:"",l.style.textAlign="left",l.colSpan=inquire_tubes.length+1,l.id="subtotal_by_TempClass_D";else if(i==timeBlocks_total_index[1])l=h.insertCell(c),c++,l.innerHTML=""!=E_txt?"小夜班內："+E_txt:"",l.style.textAlign="left",l.colSpan=inquire_tubes.length+1,l.id="subtotal_by_TempClass_E";else if(i==timeBlocks_total_index[2])l=h.insertCell(c),c++,l.innerHTML=""!=N_txt?"大夜班內："+N_txt:"",l.style.textAlign="left",l.colSpan=inquire_tubes.length+1,l.id="subtotal_by_TempClass_N";else{if(0<time_tubes[s].totalAmount||0==time_tubes[s].totalAmount&&1==time_tubes[s].hasLoss){var u=[],p=[],_=[];time_tubes[s].tubes.forEach(function(e){u.push(e.tubeName),p.push(e.amount),_.push(e.reason)});var m=0;inquire_tubes.forEach(function(e){l=h.insertCell(c),c++,e==u[m]?(1==_[m]?l.innerHTML=p[m]+"+Loss":l.innerHTML=p[m],m++):l.innerHTML=""}),l=h.insertCell(c),c++,l.style.color="red",l.id="timeblockTotal"+i,time_tubes[s].hasLoss?l.innerHTML=time_tubes[s].totalAmount+"+Loss":l.innerHTML=time_tubes[s].totalAmount}else{for(m=0;m<inquire_tubes.length;m++)l=h.insertCell(c),c++,l.innerHTML="";l=h.insertCell(c),c++,l.style.color="red",l.style.width="72px",l.innerHTML="0"}s++}}d="#E1E6FA"==d?"#ABC8E2":"#E1E6FA",(h=n.insertRow(-1)).className="GridViewScrollItem",h.style.backgroundColor=d,(l=h.insertCell(0)).colSpan=2,l.style.textAlign="center",l.innerHTML="輸出量總計<br><input type='button' value='帶入護理記錄' style='word-break:break-all;overflow:hidden;font-size: 12px;margin-top: 10px;white-space: pre-wrap;' onclick='Take_CareRecord(\"\", \""+t+'","2","")\'>',(l=h.insertCell(1)).innerHTML="Record day total 引流管輸出量： "+DEN_txt,l.style.textAlign="left",l.colSpan=inquire_tubes.length+1,l.id="AllTotal"}function buildEmptyTable(e,t,r){var n=document.getElementById(e),a=(t.split("/"),n.insertRow(-1));a.className="GridViewScrollHeader";var l=a.insertCell(0);l.innerHTML="引流管",l.className="HideCell",l.colSpan=2,(l=a.insertCell(1)).innerHTML="引流管",l.id="InquireTubeTitle",(l=a.insertCell(2)).rowSpan=2,l.innerHTML="合計",l.style.width="72px",l.id="timeblockTotalTitle",(a=n.insertRow(-1)).className="GridViewScrollHeader",(l=a.insertCell(0)).innerHTML="班別",l.style.width="70px",l.className="jobBlocksTitle",(l=a.insertCell(1)).innerHTML="時間\\管路",l.style.width="53px",l.className="timeBlocksTitle",(l=a.insertCell(2)).innerHTML="",l.style.textAlign="center",l.id="inquire_tube0";var o=0,s="#ABC8E2";for(i=0;i<timeBlocks.length;i++){var d;s=0==i||i%2==0?"#E1E6FA":"#ABC8E2",(d=n.insertRow(-1)).className="GridViewScrollItem",d.style.backgroundColor=s;var h=0;i==timeBlocks_start_index[0]?(l=d.insertCell(h),h++,l.innerHTML=t+"<br>"+r[o],l.rowSpan=timeBlocks_total_index[0]+1,l.style.textAlign="center",l.style.width="70px",l.style.backgroundColor="#85A5CC",l.id="ClassD",o++):i==timeBlocks_start_index[1]?(l=d.insertCell(h),h++,l.innerHTML=t+"<br>"+r[o],l.rowSpan=timeBlocks_total_index[0]+1,l.style.textAlign="center",l.style.width="70px",l.style.backgroundColor="#85A5CC",l.id="ClassE",o++):i==timeBlocks_start_index[2]&&(l=d.insertCell(h),h++,l.innerHTML=t+"<br>"+r[o],l.rowSpan=timeBlocks_total_index[0]+1,l.style.textAlign="center",l.style.width="70px",l.style.backgroundColor="#85A5CC",l.id="ClassN",o++),l=d.insertCell(h),h++,l.innerHTML=timeBlocks[i],l.style.width="53px",l.style.backgroundColor=s;i==timeBlocks_total_index[0]?(l=d.insertCell(h),h++,l.innerHTML="",l.style.textAlign="left",l.colSpan=6,l.id="subtotal_by_TempClass_D"):i==timeBlocks_total_index[1]?(l=d.insertCell(h),h++,l.innerHTML="",l.style.textAlign="left",l.colSpan=6,l.id="subtotal_by_TempClass_E"):i==timeBlocks_total_index[2]?(l=d.insertCell(h),h++,l.innerHTML="",l.style.textAlign="left",l.colSpan=6,l.id="subtotal_by_TempClass_N"):(l=d.insertCell(h),h++,l.innerHTML="",l.style.textAlign="center",l=d.insertCell(h),h++,l.innerHTML="",l.style.color="red",l.style.textAlign="center",l.style.width="72px",l.id="timeblockTotal"+i)}s="#E1E6FA"==s?"#ABC8E2":"#E1E6FA",(d=n.insertRow(-1)).className="GridViewScrollItem",d.style.backgroundColor=s,(l=d.insertCell(0)).colSpan=2,l.style.textAlign="center",l.innerHTML="輸出量總計",(l=d.insertCell(1)).innerHTML="",l.style.textAlign="left",l.colSpan=6,l.id="AllTotal"}function caculateInquireTubes(e,t,i,r,n,a,l,o,s){var d=l.split("/");s?(getAllInquireTubes(t),getAllTimeBlocks(i,r,n,a),caculateDENAmount(i,r,n,t,d,o),getTimeTubesArray(t,d)):getAllTimeBlocks(i,r,n,a)}var preObj,regex=/<br\s*[\/]?>/gi,x=0;function color_setting(e){$(e).gridColor()}function next_tab(){var e=parseInt($(currObj).attr("tabindex"))+1;if(currObj=$("input[tabindex='"+e+"']"),$(currObj).is(":hidden"))next_tab();else if(0!=$(currObj).length){if(preObj!=$(currObj).parent("td").parent("tr").parent("tbody").attr("id")){var t=parseFloat($(currObj).parent("td").parent("tr").parent("tbody").offset().top)-15;$(".dataArea").animate({scrollTop:t},0,"swing",function(){$(currObj).focus()})}else $(currObj).focus();preObj=$(currObj).parent("td").parent("tr").parent("tbody").attr("id")}else $(currObj).focus()}function carry_in_info(a){var e=$(a).attr("lo_check"),t=$(a).attr("hi_check"),l=$(a).attr("cr_model"),i="lfn="+e+"&hfn="+t+"&cvalue="+parseFloat($(a).val())+"&model_name="+l+"&now_item=";$.ajax({url:"../VitalSign/VitalSignPrompt",type:"post",timeout:5e3,data:i,success:function(e){if(""!=Trim(e)){$("#VS_plan_"+l).prop("checked",!0),$("#vs_prompt").html(e);var t=$("#vs_prompt").outerHeight(),i=$("#vs_prompt").outerWidth(),r=$(currObj).position().top+$(currObj).height()+10,n=$(currObj).position().left;r+t>$(window).outerHeight()&&(r=$(a).position().top-t-5),n+i>$(window).outerWidth()&&(n=$(a).position().left-(i-$(a).outerWidth())),$("#vs_prompt").css({top:r,left:n}).slideDown(350)}else $("#VS_plan_"+l).prop("checked",!1),next_tab()},error:function(){showHint("資料擷取失敗，請聯絡資訊室")}})}function carrin_data(e){$("input[name='"+e+"_memo']");var t=$("input[name='"+e+"_other_memo']"),i="",r="";$("#vs_prompt #main_memo").find("input[type=checkbox]:checked").each(function(){i+=$(this).val()+"，"}),""!=$("#"+e+"_memo").val()?$("#"+e+"_memo").val($("#"+e+"_memo").val()+","+i.substring(0,i.length-1)):$("#"+e+"_memo").val($("#"+e+"_memo").val()+i.substring(0,i.length-1)),"undifined"!=typeof t&&($("#vs_prompt #other_memo").find("input[type=checkbox]:checked").each(function(){r+=$(this).val()+"<br />"}),$(t).attr("title",r)),$("#vs_prompt").slideUp(350),next_tab()}function setToolTip(){$(".tooltip").prop("readonly",!0).tooltip({content:function(){return $(this).attr("title")}})}function mt_select_setting(){$("input[relate_field]").each(function(){for(var i=$(this).attr("relate_field").split("|"),r=$(this),e=0;e<=i.length-1;e++)$("input[name='"+i[e]+"']").unbind("click").click(function(){for(var e=new Array,t=0;t<=i.length-1;t++)e[t]=$("input[name='"+i[t]+"']:checked").val();$(r).val(e.join("|"))})})}function met_check(){var e="",t=0,i=0,r="",n="",a="";$("#bph_text").val(),$("#bf_text").val();return""!=$("#bph_text").val()&&89<$("#bph_text").val()&&$("#bph_text").val()<100&&(t<(i=1)&&(t=i),r="SBP: "+$("#bph_text").val()+" mmHg,"),""!=$("#bph_text").val()&&(79<$("#bph_text").val()&&$("#bph_text").val()<90||180<$("#bph_text").val())&&(t<=(i=2)&&(t=i),r="SBP: "+$("#bph_text").val()+" mmHg,"),""!=$("#bph_text").val()&&69<$("#bph_text").val()&&$("#bph_text").val()<80&&(t<(i=3)&&(t=i),r="SBP: "+$("#bph_text").val()+" mmHg,"),""!=$("#bph_text").val()&&$("#bph_text").val()<70&&(t<=(i=4)&&(t=i),r="SBP: "+$("#bph_text").val()+" mmHg,"),""!=$("#bf_text").val()&&$("#bf_text").val()<26&&20<$("#bf_text").val()&&(t<=(i=1)&&(t=i),a="RR: "+$("#bph_text").val()+" 次/分,"),""!=$("#bf_text").val()&&$("#bf_text").val()<31&&25<$("#bf_text").val()&&(t<=(i=2)&&(t=i),a="RR: "+$("#bph_text").val()+" 次/分,"),""!=$("#bf_text").val()&&($("#bf_text").val()<9&&4<$("#bf_text").val()||$("#bf_text").val()<36&&30<$("#bf_text").val())&&(t<=(i=3)&&(t=i),a="RR: "+$("#bph_text").val()+" 次/分,"),""!=$("#bf_text").val()&&($("#bf_text").val()<5||35<$("#bf_text").val())&&(t<=(i=4)&&(t=i),a="RR: "+$("#bph_text").val()+" 次/分,"),""!=$("#mp_text").val()&&$("#mp_text").val()<121&&100<$("#mp_text").val()&&(t<=(i=1)&&(t=i),n="HR: "+$("#mp_text").val()+" 次/分,"),""!=$("#mp_text").val()&&$("#mp_text").val()<141&&120<$("#mp_text").val()&&(t<=(i=2)&&(t=i),n="HR: "+$("#mp_text").val()+" 次/分,"),""!=$("#mp_text").val()&&($("#mp_text").val()<50&&39<$("#mp_text").val()||$("#mp_text").val()<161&&140<$("#mp_text").val())&&(t<=(i=3)&&(t=i),n="HR: "+$("#mp_text").val()+" 次/分,"),""!=$("#mp_text").val()&&($("#mp_text").val()<40||160<$("#mp_text").val())&&(t<=(i=4)&&(t=i),n="HR: "+$("#mp_text").val()+" 次/分,"),1==t&&(e+="早期警示評分："+t+" 分\n",e+=n+r+a+"\n",e+="依醫囑觀察病人生命徵象。"),2==t&&(e+="早期警示評分："+t+" 分\n",e+=n+r+a+"\n",e+="1. 依醫囑觀察病人生命徵象。\n",e+="2. 通知第一線醫師/專科護理師。"),3==t&&(e+="早期警示評分："+t+" 分\n",e+=n+r+a+"\n",e+="1. 依醫囑觀察病人生命徵象。\n",e+="2. 通知第一線醫師/專科護理師。\n",e+="3. 系統發出簡訊通知主治醫師。"),4==t&&(e+="早期警示評分："+t+" 分\n",e+=n+r+a+"\n",e+="1. 依醫囑觀察病人生命徵象。\n",e+="2. 通知第一線醫師/專科護理師。\n",e+="3. 系統發出簡訊通知主治醫師及 MET 小組。"),e}function CheckComa(){var e=!1;if($("#gc").is(":visible")){for(var t=1;t<=3;t++)if(null!=$("input[name=gc_r"+t.toString()+"]:checked").val()){e=!0;break}if(e)for(var i=1;i<=3;i++)if(null==$("input[name=gc_r"+i.toString()+"]:checked").val())return!1}return!0}function CheckPain(){var e=!1,t=0;switch($("input[name=ps_assess]:checked").val()){case"CPOT評估(加護單位)":t=4;break;default:t=5}if($("#ps").is(":visible")){for(var i=1;i<=t;i++)if(null!=$("input[name=ps_r"+i.toString()+"]:checked").val()){e=!0;break}if(e)for(var r=1;r<=t;r++)if(null==$("input[name=ps_r"+r.toString()+"]:checked").val())return!1}return!0}function CheckPain(){var e=!1,t=0;switch($("input[name=ps_assess]:checked").val()){case"CPOT評估(加護單位)":t=4;break;default:t=5}if($("#ps").is(":visible")){for(var i=1;i<=t;i++)if(null!=$("input[name=ps_r"+i.toString()+"]:checked").val()){e=!0;break}if(e)for(var r=1;r<=t;r++)if(null==$("input[name=ps_r"+r.toString()+"]:checked").val())return!1}return!0}function pupils(e){switch(e){case"L1":case"L2":case"L3":$("#pupils_l_num").show(),$("#pupils_l_record").hide().val("");break;case"L4":$("#pupils_l_num").hide().find("input[type=radio]").prop("checked",!1),$("#pupils_l_record").hide().val("");break;case"L5":$("#pupils_l_num").hide().find("input[type=radio]").prop("checked",!1),$("#pupils_l_record").show();break;case"L6":$("#pupils_l_num").hide().find("input[type=radio]").prop("checked",!1),$("#pupils_l_record").hide().val("");break;case"R1":case"R2":case"R3":$("#pupils_r_num").show(),$("#pupils_r_record").hide().val("");break;case"R4":$("#pupils_r_num").hide().find("input[type=radio]").prop("checked",!1),$("#pupils_r_record").hide().val("");break;case"R5":$("#pupils_r_num").hide().find("input[type=radio]").prop("checked",!1),$("#pupils_r_record").show();break;case"R6":$("#pupils_r_num").hide().find("input[type=radio]").prop("checked",!1),$("#pupils_r_record").hide().val("")}}function set_ck_reason(e){$(".ck_reason").each(function(){$(this).val(e),"mp_reason"!=this.id&&"bf_reason"!=this.id||set_ck_reason_memo("mp",e)})}function set_ck_reason_memo(e,t){var i="";"測不到"==t&&(i="心跳及呼吸測不到，血壓:___/___mmHg，意識狀態:E___V___M___，瞳孔大小:___/___(+-±/+-±)，急通知:_______醫師並於__:__開始施行心肺復甦術，置入氣",i+="管內管__Fr.，固定___cm，予氧氣(呼吸器:VC/SIMV+PS/PS/PC Mode，TV:____，rate:__次/分，FiO2:__%， PEEP:__，PC:__)，抽痰並保持呼吸道",i+="通暢，痰量多/少，___(性質)，___(顏色)，___，密切監測心電圖及血壓。",i+="Bosmin 1支IV st. at____，予N.S.500cc+Dopamine 2 Amp IVF___gtt/min，心電圖：VT，電擊___焦耳，續行心肺復甦術。"),$("#"+e+"_memo").val(i)}function set_bt_f(){$("#bt_text").attr("lo_check","btl_f"),$("#bt_text").attr("hi_check","bth_f")}function set_bt_e(){$("#bt_text").attr("lo_check","btl_e"),$("#bt_text").attr("hi_check","bth_e")}function set_bt_a(){$("#bt_text").attr("lo_check","btl_a"),$("#bt_text").attr("hi_check","bth_a")}function set_bt_r(){$("#bt_text").attr("lo_check","btl_r"),$("#bt_text").attr("hi_check","bth_r")}function ch_all_numcheck(){for(var e=!0,t=$(".check"),i=0;i<t.length;i++)e=numcheck(t[i]);return e}function numcheck(e){var t=$(e).val(),i=!0;if(""!=t){var r=parseFloat($(e).attr("max_num")),n=parseFloat($(e).attr("min_num"));""!=r&&parseFloat(t)>r&&(i=!1),""!=n&&parseFloat(t)<n&&(i=!1)}if(!i){alert("請輸入正常範圍"),$(e).val("");var a=parseFloat($(e).parent("td").parent("tr").parent("tbody").offset().top)-15;$(".dataArea").animate({scrollTop:a},0,"swing",function(){$(e).focus()})}return i}function check_num(e){if(-1<e.value.indexOf(".")){var t=/^[0-9]+\.[0-9]*$/;0==e.value.indexOf("-")&&(t=/^[-]?[0-9]+\.[0-9]*$/)}else{t=/^[0-9]+$/;0==e.value.indexOf("-")&&(t=/^[-]?[0-9]*$/)}if(t.test(e.value)||""==e.value){if(-1<e.value.indexOf(".")){(t=/^[0-9]+\.[0-9]?$/).test(e.value)||""==e.value||$(e).val(e.value.substring(0,e.value.indexOf(".")+2))}}else alert("只能輸入數字"),$(e).val("")}function isTextSelected(e){var t=$(e).prop("selectionStart"),i=$(e).prop("selectionEnd");return null!=t&&null!=i&&t!=i&&$(e).val().substring(t,i-t).length==$(e).val().length}$.fn.getType=function(){return"INPUT"==this[0].tagName?this[0].type.toLowerCase():this[0].tagName.toLowerCase()},$(document).ready(function(){$("#vs_table tbody[hide='Y']").each(function(){try{$(this).find("input[type=hidden][name=vs_item]").prop("disabled",!0),$(this).hide()}catch(e){showHint(e)}}),$(".dataArea input").autoTabIndex(),setToolTip(),$("input[setindex=Y]").each(function(){$(this).attr("onkeyup","check_num(this);")}),$(".dataArea tr").find("td:first, td:last").each(function(){$(this).css({"text-align":"center","vertical-align":"middle"})}),$(".dataArea tr").find("td:eq(1)").each(function(){$(this).css({"vertical-align":"top"})}),$("input[vafield]").each(function(){for(var t=$(this),i=$(this).attr("vafield").split("|"),r=0;r<=i.length-1;r++)$("input[name='"+i[r]+"']").change(function(){for(var e="";0<=i.length-0;r++)e+=$("input[name='"+i[0]+"']").val();$(t).val(e)})}),$(".func_box button").click(function(){var e=$(".dataArea").scrollTop();switch($(this).html().replace(regex,"")){case"更新":var t="";if(""!=$("input[name=gc_r1]:checked").val()||""!=$("input[name=gc_r2]:checked").val()||""!=$("input[name=gc_r3]:checked").val()){for(var i=1;i<4;i++)t+=$("input[name=gc_r"+i+"]:checked").val()+"|";$("input[type=hidden][name=gc_record]").val(t.substring(0,t.length-1))}""!=$("#mp_text").val()&&$("input[name=mp_part]").val($("input[name=mp_posture]:checked").val()+"|"+$("input[name=mp_position]:checked").val()),""!=$("#bp_text").val()&&$("input[name=bp_part]").val($("input[name=bp_posture]:checked").val()+"|"+$("input[name=bp_position]:checked").val()),$("#mask,#info").show(),$("#new_date").val($("#new_day").val()+" "+$("#new_time").val());var r=!0;if("無解尿"===$("input[name=gi_u_record]:checked").val()&&"0"!=$("#gi_u_value").val()&&""!=$("#gi_u_value").val())return alert("選擇無解尿時，只能輸入0次"),$("#gi_u_value").val(""),r=!1,void $("#mask,#info").hide();if("結晶尿"===$("input[name=gi_u_record]:checked").val()&&"0"===$("#gi_u_value").val())return alert("請輸入0以外的正確的次數"),$("#gi_u_value").val(""),r=!1,void $("#mask,#info").hide();if("黃"===$("input[name=gi_u_record]:checked").val()){if("0"==$("#gi_u_value").val())return alert("請輸入0以外的正確的次數"),$("#gi_u_value").val(""),r=!1,void $("#mask,#info").hide()}else($("input[name=gi_u_record]:checked")&&""===$("#gi_u_value").val()||void 0===$("#gi_u_value").val())&&(r=!0);if($("#gi_u_value").val()&&!$("input[name=gi_u_record]:checked").prop("checked"))return alert("請選擇尿液性質"),r=!1,void $("#mask,#info").hide();if("-1"!=$("#bt_drug").val()){if("99"==$("#bt_drug").val()&&""==$.trim($("#bt_drug_other").val()))return alert("請輸入 其他藥名!"),r=!1,void $("#mask,#info").hide();if(""==$("#bt_drug_amount").val())return alert("請輸入 劑量!"),r=!1,void $("#mask,#info").hide();if("-1"==$("#bt_drug_unit").val())return alert("請選擇 單位!"),r=!1,void $("#mask,#info").hide();r=!0}if(0<$.trim($("#st_value").val())){var n="";"請選擇"!=$("#stoolType").val()&&"請選擇"!=$("#stoolColor").val()||(n+="請選擇 排便 性狀顏色!\n",r=!1),"其他"!=$("#stoolType").val()||$("#st_other2 input[name=st_record]").val()||(n+="請選擇 排便 其他性狀內容 !\n",r=!1),"其他"!=$("#stoolColor").val()||$("#st_other input[name=st_record]").val()||(n+="請選擇 排便 其他顏色內容!\n",r=!1),n&&alert(n)}if(!CheckComa())return alert("昏迷指數未輸入完整，請檢查!"),r=!1,void $("#mask,#info").hide();if(!CheckPain())return alert("疼痛評估未輸入完整，請檢查!"),r=!1,void $("#mask,#info").hide();$(".psData input:radio:checked").map(function(){var e=$(this).val().match(/^\(\d*/g).toString();return parseInt(e.replace("(",""))}).get();if(null!=$("input[type=radio][name=gi_j_part]:checked").val()&&""==$("#giMemo").val())return alert("請輸入總紅膽素 數值!"),r=!1,void $("#mask,#info").hide();if("無脫落"===$("input[type=radio][name=gi_c_record]:checked").val()&&""==$("#gi_c_type").val())return alert("請輸入臍帶 乾或濕!"),r=!1,void $("#mask,#info").hide();if(null!=$("#sis").val()&&"無"!=$("#sis").val()){if(null==$("#sir").val())return alert("請選擇 痰液 性質!"),r=!1,void $("#mask,#info").hide();if(null==$("#sid").val())return alert("請選擇 痰液 顏色!"),r=!1,void $("#mask,#info").hide()}var a=$("input[name='mp_posture']:checked").val();if(""!=$("#mp_text").val()&&0===$("input[name='mp_position']:checked").length&&a.indexOf("心尖脈")<0)return alert("請選擇心跳動脈測量部位是'左側'還是'右側'?"),r=!1,void $("#mask,#info").hide();if($("input[type=checkbox][name=sp_reason]").prop("checked")){if(0===$("input[type=radio][name=sp_part]:checked").length)return alert("請選擇血氧 測量方式!"),r=!1,void $("#mask,#info").hide()}else if(""==$("#sp_text").val()){if(1===$("input[type=radio][name=sp_part]:checked").length)return r=!1,alert("請輸入完整血氧 測量值!"),r=!1,void $("#mask,#info").hide()}else if(0===$("input[type=radio][name=sp_part]:checked").length)return alert("請選擇血氧 測量方式!"),r=!1,void $("#mask,#info").hide();if($("form[name=vs_upd_form] tr").each(function(){var e=!0;$(this).find("input[type=hidden][name=vs_item]").prop("disabled",!1),$(this).find("input, textarea, select, radio, checkbox").each(function(){switch($(this).getType()){case"textarea":case"text":case"select":$(this).val()!=$(this).attr("default")&&""!=$(this).val()&&"請選擇"!=$(this).val()&&-1!=$(this).val()&&(e=!1);break;case"radio":case"checkbox":$(this).is(":checked")!=("true"==$(this).attr("default"))&&(e=!1)}}),e&&$(this).find("input[type=hidden][name=vs_item]").prop("disabled",!0)}),$("input:enabled[name=vs_item]").map(function(){return $(this).val()}).get().length<=0&&(alert("資料無異動，無法更新!"),r=!1),r&&ch_all_numcheck()){var l=$("#bt_drug").val()+"|";l+=$("#bt_drug_other").val()+"|",l+=$("#bt_drug_amount").val()+"|",l+=$("#bt_drug_unit").val(),$("#bt_other_memo").val(l),setTimeout(function(){$("form[name=vs_upd_form]").submit()},800)}else $("#mask,#info").hide();break;case"返回":location.href="VitalSign_Index";break;case"儲存":""!=$("#mp_text").val()&&$("input[name=mp_part]").val($("input[name=mp_posture]:checked").val()+"|"+$("input[name=mp_position]:checked").val()),$("#mask,#info").show();r=!0;if("-1"!=$("#bt_drug").val()){if("99"==$("#bt_drug").val()&&""==$.trim($("#bt_drug_other").val()))return alert("請輸入 其他藥名!"),r=!1,void $("#mask,#info").hide();if(""==$("#bt_drug_amount").val())return alert("請輸入 劑量!"),r=!1,void $("#mask,#info").hide();if("-1"==$("#bt_drug_unit").val())return alert("請選擇 單位!"),r=!1,void $("#mask,#info").hide();r=!0}if(0<$.trim($("#st_value").val())){n="";"請選擇"!=$("#stoolType").val()&&"請選擇"!=$("#stoolColor").val()||(n+="請選擇 排便 性狀顏色!\n",r=!1),"其他"!=$("#stoolType").val()||$("#st_other2 input[name=st_record]").val()||(n+="請選擇 排便 其他性狀內容 !\n",r=!1),"其他"!=$("#stoolColor").val()||$("#st_other input[name=st_record]").val()||(n+="請選擇 排便 其他顏色內容!\n",r=!1),n&&alert(n)}var o=$("#sis :selected").text();if(""!=o&&"無"!=o){var s=$("#sir :selected").text(),d=$("#sid :selected").text();if(""==s)return alert("請選擇 痰液 性質!"),r=!1,void $("#mask,#info").hide();if(""==d)return alert("請選擇 痰液 顏色!"),r=!1,void $("#mask,#info").hide()}$(".psData input:radio:checked").map(function(){var e=$(this).val().match(/^\(\d*/g).toString();return parseInt(e.replace("(",""))}).get();if(""==$("#abpl_text").val()&&""!=$("#abph_text").val())return r=!1,alert("請輸入完整ABP 測量值!"),r=!1,void $("#mask,#info").hide();if(""==$("#abph_text").val()&&""!=$("#abpl_text").val())return r=!1,alert("請輸入完整ABP 測量值!"),r=!1,void $("#mask,#info").hide();if(""==$("#pal_text").val()&&""!=$("#pah_text").val())return r=!1,alert("請輸入完整PA 測量值!"),r=!1,void $("#mask,#info").hide();if(""==$("#pah_text").val()&&""!=$("#pal_text").val())return r=!1,alert("請輸入完整PA 測量值!"),r=!1,void $("#mask,#info").hide();if("無解尿"===$("input[name=gi_u_record]:checked").val()&&"0"!=$("#gi_u_value").val())return alert("選擇無解尿時，只能輸入0次"),$("#gi_u_value").val(""),r=!1,void $("#mask,#info").hide();if("結晶尿"===$("input[name=gi_u_record]:checked").val()){if(""==$("#gi_u_value").val())return alert("請輸入完整尿液 測量值!"),r=!1,void $("#mask,#info").hide();if("0"===$("#gi_u_value").val())return alert("請輸入0以外的正確的次數"),$("#gi_u_value").val(""),r=!1,void $("#mask,#info").hide()}if("黃"===$("input[name=gi_u_record]:checked").val()){if(""==$("#gi_u_value").val())return alert("請輸入完整尿液 測量值!"),r=!1,void $("#mask,#info").hide();if("0"==$("#gi_u_value").val())return alert("請輸入0以外的正確的次數"),$("#gi_u_value").val(""),r=!1,void $("#mask,#info").hide()}if($("#gi_u_value").val()&&!$("input[name=gi_u_record]:checked").prop("checked"))return alert("請選擇尿液性質"),r=!1,void $("#mask,#info").hide();if(null!=$("input[type=radio][name=gi_j_part]:checked").val()&&""==$("#giMemo").val())return alert("請輸入總紅膽素 數值!"),r=!1,void $("#mask,#info").hide();if("無脫落"===$("input[type=radio][name=gi_c_record]:checked").val()&&""==$("#gi_c_type").val())return alert("請輸入臍帶 乾或濕!"),r=!1,void $("#mask,#info").hide();if(""==$("#bph_text").val()&&""!=$("#bpl_text").val())return r=!1,alert("請輸入完整血壓 測量值!"),r=!1,void $("#mask,#info").hide();if(""==$("#bpl_text").val()&&""!=$("#bph_text").val())return r=!1,alert("請輸入完整血壓 測量值!"),r=!1,void $("#mask,#info").hide();if($("input[type=checkbox][name=sp_reason]").prop("checked")){if(0===$("input[type=radio][name=sp_part]:checked").length)return alert("請選擇血氧 測量方式!"),r=!1,void $("#mask,#info").hide()}else if(""==$("#sp_text").val()){if(1===$("input[type=radio][name=sp_part]:checked").length)return r=!1,alert("請輸入完整血氧 測量值!"),r=!1,void $("#mask,#info").hide()}else if(0===$("input[type=radio][name=sp_part]:checked").length)return alert("請選擇血氧 測量方式!"),r=!1,void $("#mask,#info").hide();a=$("input[name='mp_posture']:checked").val();if(""!=$("#mp_text").val()&&0===$("input[name='mp_position']:checked").length&&a.indexOf("心尖脈")<0)return alert("請選擇心跳動脈測量部位是'左側'還是'右側'?"),r=!1,$(".dataArea").animate({scrollTop:e-3e3},200),void $("#mask,#info").hide();if(CheckComa()||(alert("昏迷指數未輸入完整，請檢查!"),r=!1),!CheckPain())return alert("疼痛評估未輸入完整，請檢查!"),r=!1,void $("#mask,#info").hide();if(r&&ch_all_numcheck()){l=$("#bt_drug").val()+"|";l+=$("#bt_drug_other").val()+"|",l+=$("#bt_drug_amount").val()+"|",l+=$("#bt_drug_unit").val(),$("#bt_other_memo").val(l),$("form[name=vs_form]").submit()}else $("#mask,#info").hide();break;case"放棄":confirm("確認是否要放棄編輯資料?")&&location.reload();break;case"設定":var h=$(this).position().top+$(this).height()+10,c=$(this).position().left;if($(".func_setting").css({top:h,left:c}),$(".func_setting").is(":visible")){$(".func_setting").slideUp(350),$(this).css("background-color",""),"/VitalSign/VitalSignModify"!=location.pathname&&$(".mask").fadeIn(500);var u=new Array,p=0;$(".func_setting button").each(function(){"func_selected"==$(this).attr("class")&&(u[p]=$(this).val(),p++)}),"/VitalSign/VitalSignModify"!=location.pathname&&$.ajax({url:"../VitalSign/SaveVSOption",type:"post",timeout:5e3,data:"func_list="+u.join("|"),success:function(){setTimeout(function(){$(".mask").fadeOut(350)},800)}})}else $(".func_setting").slideDown(350,function(){$(".func_setting").css({overflow:""})}),$(this).css("background-color","#FFFF99");break;case"批次輸入":location.href="VitalSign_Multiple";break;case"TPR":window.open("Tpr_Index","","menubar=no,status=no,scrollbars=yes,top=0,left=200,toolbar=no,width=1024,height=768");break;case"查詢":location.href="VitalSign_Index";break;case"往上移動":$(".dataArea").animate({scrollTop:e-150},200);break;case"往下移動":$(".dataArea").animate({scrollTop:e+150},200);break;case"儀器資料":var _=$("#feeno").val();window.open("VitalSign_Interfacing?feeno="+_,"","menubar=no,status=no,scrollbars=yes,top=0,left=200,toolbar=no,width=1024,height=768");break;case"ICU帶入":_=$("#feeno").val();window.open("ICUData?feeno="+_,"","menubar=no,status=no,scrollbars=yes,top=0,left=200,toolbar=no,width=1024,height=768");break;case"VIP資料修改":location.href="Machine_Datalist"}}),$(".dataArea input[type=text][class!='tooltip'][class!='word']").focus(function(){currObj=$(this),currobj2=this;var e=$("#keybord").outerHeight(),t=$("#keybord").outerWidth(),i=$(this).position().top+$(this).height()+10,r=$(this).position().left;i+e>$(window).outerHeight()&&(i=$(this).position().top-e-10),r+t>$(window).outerWidth()&&(r=$(this).position().left-(t-$(this).outerWidth()))}).keydown(function(e){13==e.which&&($("#keybord").slideUp(350),"true"==$(this).attr("va_check")?carry_in_info($(this)):next_tab())}),$("#keybord button").click(function(){switch($(this).html()){case"↵":if(numcheck(currObj)){var e=$.Event("keydown");e.which=13,$(currObj).trigger(e)}break;case"身高":$("tbody[id='身高']").fadeIn(350),$("input[name='bh_record']").focus();break;case"體重":$("tbody[id='體重']").fadeIn(350),$("input[name='bw_record']").focus();break;case"←":var t=$(currObj).val();t=t.substring(0,t.length-1),$(currObj).val(t);break;case"×":numcheck(currObj)&&$("#keybord").slideUp(350);break;default:isTextSelected(currObj)?$(currObj).val(Trim($(this).html())):$(currObj).val($(currObj).val()+Trim($(this).html())),check_num(currobj2)}}),$("input[name=gc_part]").click(function(){var e="gc_type="+encodeURIComponent($(this).val());0<$("input[name=gc_default_data]").length&&(e+="&df_data1="+$("input[name=gc_default_data]").val()),$.ajax({url:"../VitalSign/VitalSignGCS",type:"post",cache:"false",data:e,timeout:5e3,success:function(e){$(".gcsData").html(e),mt_select_setting()}})}),$("input[name=gc_part]:checked").trigger("click"),$("input[name=ps_assess]").click(function(){var e="ps_type="+encodeURIComponent($(this).val());0<$("input[name=ps_default_data]").length&&(e+="&df_data="+$("input[name=ps_default_data]").val()),$.ajax({url:"../VitalSign/VitalSignPS",type:"post",data:e,timeout:5e3,success:function(e){$(".psData").html(e),mt_select_setting(),setToolTip()}})}),$("input[name=ps_assess]:checked").trigger("click"),$(".func_setting button").click(function(){"func_selected"==$(this).attr("class")?($(this).removeAttr("class").css("background-color",""),$("tbody[id='"+$(this).val()+"']").hide(350).find("input[type=hidden][name=vs_item]").prop("disabled",!0)):($(this).attr("class","func_selected").css("background-color","#FFFF99"),$("tbody[id='"+$(this).val()+"']").show(350).find("input[type=hidden][name=vs_item]").prop("disabled",!1)),color_setting("#vs_table")}),$(window).resize(function(){$(this).outerHeight()<=50?$(".dataArea").outerHeight(350):$(".dataArea").outerHeight($(this).outerHeight()-120)}).trigger("resize"),mt_select_setting(),setTimeout(function(){color_setting("#vs_table"),$("#info").center()},800),$('input[type="text"]').click(function(){this.select()})});