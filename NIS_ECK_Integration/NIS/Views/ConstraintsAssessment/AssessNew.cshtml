@using NIS.Data;
@using System.Data;
@{
    //Layout = "~/Views/Layout/Main.cshtml";
    Layout = "~/Views/Layout/FormLayout.cshtml";
    DataTable dtr = new DataTable();
    if(ViewBag.dtr != null)
    { dtr = ViewBag.dtr; }
    DataTable dt = ViewBag.dt;
    DataTable dt2 = ViewBag.dt2;
    string start = ViewBag.start;
    string ver = ViewBag.ver;
    string id = ViewBag.id;
    string BOUT = ViewBag.BOUT;
    string mod = ViewBag.mod;
    List<String> TList = new List<String>();
    TList = (List<String>)ViewData["time"];
    string assessdt = ViewBag.assessdt;
    string assess = "";
    string day = DateTime.Now.ToString("yyyy/MM/dd");
    string time = DateTime.Now.ToString("HH:mm");
    int feq = ViewBag.feq;
    string REASON = "", CONSCIOUS = "", REASON_OTHER = "", CONSCIOUS_OTHER = "", BINDID = "";
    //string TOOL = "", CYCLE = "", PAUSE = "", ENDING = "", EXPLAIN = "";
    //string HARM = "", HARM1 = "", HARM2 = "", OTHER = "";
    string RESTRAINT = "", BINDINGSITE = "", PULSE = "", TIGHTNESS = "", TEMPERATURE = "", COLOUR = "", INTEGRITY = "", FEELING = "", REMOVE = "",REMARK="";//new
    int TListCount = TList.Count;

    //int listtime=TList.Count;
    //if(feq != null)
    //{
    //  <script type="text/javascript">
    //      var feq =@feq
    //      $(function () {
    //          if (feq == "0" || feq == "1")
    //          {
    //               document.getElementById('tabdiv').setAttribute("style", "display:none;");                 
    //          }          
    //      });
    //    </script>
    //}


    if(dt != null && dt.Rows.Count > 0)
    {
        day = Convert.ToDateTime(dt.Rows[0]["ASSESSDT"]).ToString("yyyy/MM/dd");
        time = Convert.ToDateTime(dt.Rows[0]["ASSESSDT"]).ToString("HH:mm");
        REASON = dt.Rows[0]["REASON"].ToString().Trim();//約束原因
        CONSCIOUS = dt.Rows[0]["CONSCIOUS"].ToString().Trim();//意識程度

        REASON_OTHER = dt.Rows[0]["REASON_OTHER"].ToString().Trim();
        CONSCIOUS_OTHER = dt.Rows[0]["CONSCIOUS_OTHER"].ToString().Trim();
        PULSE = dt.Rows[0]["PULSE"].ToString().Trim();
        TIGHTNESS = dt.Rows[0]["TIGHTNESS"].ToString().Trim();
        TEMPERATURE = dt.Rows[0]["TEMPERATURE"].ToString().Trim();
        COLOUR = dt.Rows[0]["COLOUR"].ToString().Trim();
        INTEGRITY = dt.Rows[0]["INTEGRITY"].ToString().Trim();
        FEELING = dt.Rows[0]["FEELING"].ToString().Trim();
        REMOVE = dt.Rows[0]["REMOVE"].ToString().Trim();
        REMARK = dt.Rows[0]["REMARK"].ToString().Trim();

        BINDID = dt.Rows[0]["BINDID"].ToString().Trim(); //
        assessdt = dt.Rows[0]["ASSESSDT"].ToString().Trim();
        id = dt.Rows[0]["ID"].ToString().Trim();
        assess = dt.Rows[0]["ASSESS"].ToString().Trim();
        if(assess != "0")
        {//修改，進入評估過的項目
         //包含只有約束方式及約束部位兩個欄位的也是進這裡
            <script type="text/javascript">
                $(function () {
                  @*  set_for_rb('rb_restraint','@(REASON)');*@
                    set_for_ck('ck_restraint','@(REASON)');
                    set_for_ck('ck_bindingsite','@(CONSCIOUS)');

                    set_for_rb('rb_pulse','@(PULSE)');
                    set_for_rb('rb_tightness','@(TIGHTNESS)');
                    set_for_rb('rb_temperature','@(TEMPERATURE)');
                    set_for_rb('rb_colour','@(COLOUR)');
                    @*set_for_rb('rb_integrity','@(INTEGRITY)');*@
                    set_for_ck('ck_integrity','@(INTEGRITY)');
                    set_for_rb('rb_feeling','@(FEELING)');
                    set_for_rb('rb_remove','@(REMOVE)');
                    $('#txt1').val('@(REASON_OTHER)');
                    $('#txt2').val('@(CONSCIOUS_OTHER)');
                    $('#txt10').val('@(REMARK)');

                });
                function set_for_rb(id, default_val) {
                    var rb = document.getElementsByName(id);
                    for (var i = 0; i < rb.length; i++) {
                        if (rb[i].value == default_val)
                            rb[i].checked = true;
                    }
                }

                function set_for_ck(id, default_val) {
                    var ck = document.getElementsByName(id);
                    var name = (default_val + ",").split(",");

                    for (var j = 0; j < name.length - 1; j++) {
                        for (var i = 0; i < ck.length; i++) {
                            if ($(ck[i]).attr('text') == name[j]) {
                                ck[i].checked = true;
                                j++;
                            }
                        }
                    }
                }
        </script> 
        }
        else
        {//修改，進入到還沒評估過的項目 算是經過第一次-->第二次評估後，剩下來沒完成的部分，但是是單筆修改
            DataTable dt_b = ViewBag.dt2;
            if(dt_b != null && dt_b.Rows.Count > 0)
            {
                string REASON1 = dt_b.Rows[0]["REASON"].ToString();
                string CONSCIOUS1 = dt_b.Rows[0]["CONSCIOUS"].ToString();
                string REASON_OTHER1 = dt_b.Rows[0]["REASON_OTHER"].ToString();
                string CONSCIOUS_OTHER1 = dt_b.Rows[0]["CONSCIOUS_OTHER"].ToString();
            <script type="text/javascript">
                $(function(){
                    set_for_ck1('ck_bindingsite','@(CONSCIOUS1)');
                    set_for_ck1('ck_restraint','@(REASON1)');
                       @* $("[name=rb_restraint][value='@(REASON1)']").attr('checked', true);*@
                            if('@(REASON_OTHER1)'!=""){
                                    $('#txt1').removeAttr("disabled");
                                    $('#txt1').val('@(REASON_OTHER1)');
                            }
                            if('@(CONSCIOUS_OTHER1)'!=""){
                                    $('#txt2').removeAttr("disabled");
                                    $('#txt2').val('@(CONSCIOUS_OTHER1)');
                            }
                });

                function set_for_rb(id, default_val) {
                     var rb = document.getElementsByName(id);
                    for (var i = 0; i < rb.length; i++) {
                        if (rb[i].value == default_val)
                                rb[i].checked = true;
                    }
                }

                function set_for_ck1(id, default_val) {
                    var ck = document.getElementsByName(id);
                    var name = (default_val + ",").split(",");
                    for (var j = 0; j < name.length - 1; j++) {
                        for (var i = 0; i < ck.length; i++) {
                            if ($(ck[i]).attr('text') == name[j]) {
                                ck[i].checked = true;
                                j++;
                            }
                        }
                    }
                }
            </script>
            }
            
            @*<script type="text/javascript">
                $(function () {
                    set_for_rb('rb_restraint','@(REASON)');
                    set_for_ck('ck_bindingsite','@(CONSCIOUS)');
                    
                    set_for_rb('rb_pulse','@(PULSE)');
                    set_for_rb('rb_tightness','@(TIGHTNESS)');
                    set_for_rb('rb_temperature','@(TEMPERATURE)');
                    set_for_rb('rb_colour','@(COLOUR)');
                    set_for_rb('rb_integrity','@(INTEGRITY)');
                    set_for_rb('rb_feeling','@(FEELING)');
                    set_for_rb('rb_remove','@(REMOVE)');
                    $('#txt1').val('@(REASON_OTHER)');
                    $('#txt2').val('@(CONSCIOUS_OTHER)');
                });
                function set_for_rb(id, default_val) {
                    var rb = document.getElementsByName(id);
                    for (var i = 0; i < rb.length; i++) {
                        if (rb[i].value == default_val)
                            rb[i].checked = true;
                    }
                }

                function set_for_ck(id, default_val) {
                    var ck = document.getElementsByName(id);
                    var name = (default_val + ",").split(",");

                    for (var j = 0; j < name.length - 1; j++) {
                        for (var i = 0; i < ck.length; i++) {
                            if ($(ck[i]).attr('text') == name[j]) {
                                ck[i].checked = true;
                                j++;
                            }
                        }
                    }
                }
            </script>*@
        }
        //再修改時，單筆，無論是否有評估過項目，都會去做撈約束方式跟約束原因這段
        DataTable dt_c = ViewBag.dt2;
        //dt_b.DefaultView.RowFilter="ID='"+id+"'";
        DataView dv = new DataView(dt_c);
        dv.RowFilter = "ID='" + id + "'"; // query example = "id = 10"
        dt_c = dv.ToTable();
        if(dt_c != null && dt_c.Rows.Count > 0)
        {
            string REASON1 = dt_c.Rows[0]["REASON"].ToString();
            string CONSCIOUS1 = dt_c.Rows[0]["CONSCIOUS"].ToString();
            string REASON_OTHER1 = dt_c.Rows[0]["REASON_OTHER"].ToString();
            string CONSCIOUS_OTHER1 = dt_c.Rows[0]["CONSCIOUS_OTHER"].ToString();
            <script type="text/javascript">
                $(function () {
                    $("[name=lab_restraint]").each(function(){
                        $(this).text('@(REASON1)');
                    });
                    $("[name=lab_restraint_other]").each(function(){
                        if('@(REASON_OTHER1)'!=""){
                            $(this).text(':'+'@(REASON_OTHER1)');
                        }
                    });
                    $("[name=lab_bindingsite]").each(function(){
                        $(this).text('@(CONSCIOUS1)');
                    });
                    $("[name=lab_bindingsite_other]").each(function(){
                        if('@(CONSCIOUS_OTHER1)'!=""){
                            $(this).text(':'+'@(CONSCIOUS_OTHER1)');
                        }
                    });
                });
            </script>
            //if(TList != null && TList.Count > 0 && dt_b != null && dt_b.Rows.Count > 0)
            //{
            //    for(int k = 0; k < TList.Count; k++)
            //    {


            //    }
            //}
        }

    }
    else
    {//第二次評估時(多筆)會跳進來撈 第一次評估的  "約束方式"及"約束部位"
        DataTable dt_b = ViewBag.dt_b;
        if(dt_b != null && dt_b.Rows.Count > 0)
        {
            string REASON1 = dt_b.Rows[0]["REASON"].ToString();
            string CONSCIOUS1 = dt_b.Rows[0]["CONSCIOUS"].ToString();
            string REASON_OTHER1 = dt_b.Rows[0]["REASON_OTHER"].ToString();
            string CONSCIOUS_OTHER1 = dt_b.Rows[0]["CONSCIOUS_OTHER"].ToString();
        <script type="text/javascript">
            $(function () {
                $("[name=lab_restraint]").each(function(){
                    $(this).text('@(REASON1)');
                });
                $("[name=lab_restraint_other]").each(function(){
                    if('@(REASON_OTHER1)'!=""){
                        $(this).text(':'+'@(REASON_OTHER1)');
                    }
                 }); 
                $("[name=lab_bindingsite]").each(function(){
                        $(this).text('@(CONSCIOUS1)');
                });
                $("[name=lab_bindingsite_other]").each(function(){
                    if('@(CONSCIOUS_OTHER1)'!=""){
                         $(this).text(':'+'@(CONSCIOUS_OTHER1)');
                    }
                });
            });
        </script>
            if(TList != null && TList.Count > 0 && dt_b != null && dt_b.Rows.Count > 0)
            {
                for(int k = 0; k < TList.Count; k++)
                { 
                        <script type="text/javascript">
                            $(function(){
                                @*set_for_rb('rb_restraint@(k)','@(REASON1)');*@

                                set_for_ck1('ck_bindingsite@(k)','@(CONSCIOUS1)');
                                set_for_ck1('ck_restraint@(k)','@(REASON1)');
                               @* $("[name=rb_restraint"+@(k)+"][value='@(REASON1)']").attr('checked', true);*@
                                if('@(REASON_OTHER1)'!=""){
                                    $('#txt1'+'@(k)').removeAttr("disabled");
                                    $('#txt1'+'@(k)').val('@(REASON_OTHER1)');
                                }
                                if('@(CONSCIOUS_OTHER1)'!=""){
                                    $('#txt2'+'@(k)').removeAttr("disabled");
                                    $('#txt2'+'@(k)').val('@(CONSCIOUS_OTHER1)');
                                }
                            });
                            function set_for_rb(id, default_val) {
                                var rb = document.getElementsByName(id);
                                for (var i = 0; i < rb.length; i++) {
                                    if (rb[i].value == default_val)
                                        rb[i].checked = true;
                                }
                            }

                            function set_for_ck1(id, default_val) {
                                var ck = document.getElementsByName(id);
                                var name = (default_val + ",").split(",");
                                for (var j = 0; j < name.length - 1; j++) {
                                    for (var i = 0; i < ck.length; i++) {
                                        if ($(ck[i]).attr('text') == name[j]) {
                                            ck[i].checked = true;
                                            j++;
                                        }
                                    }
                                }
                            }
                        </script>

                }
            }
        }
    }

                //批次帶最後一筆的資料給展開的評估
      @**  DataTable dt_b = ViewBag.dt_b;
        if (TList != null && TList.Count > 0 && dt_b != null && dt_b.Rows.Count > 0)
        {
            for (int j = 0; j < TList.Count; j++)
            { 
               <script type="text/javascript">
                   $(function () {
            
                       other = "@dt_b.Rows[0]["OTHER"].ToString().Trim()";
            
                       //最後一筆
                       set_for_ck('ck_reaction@(j)', '@dt_b.Rows[dt_b.Rows.Count - 1]["REACTION"].ToString().Trim()');//病人反應
                       set_for_ck('ck_position@(j)', '@dt_b.Rows[dt_b.Rows.Count - 1]["POSITION"].ToString().Trim()');//約束部位
                       set_for_ck('ck_tool@(j)', '@dt_b.Rows[dt_b.Rows.Count - 1]["TOOL"].ToString().Trim()');//約束工具
                      // set_for_ck('ck_ending@(j)', '@dt_b.Rows[dt_b.Rows.Count - 1]["ENDING"].ToString().Trim()');//解除約束活動
                      // set_for_ck('ck_harm@(j)', '@dt_b.Rows[dt_b.Rows.Count - 1]["HARM"].ToString().Trim()');//約束傷害
                       set_for_rb('rb_reason@(j)', '@dt_b.Rows[dt_b.Rows.Count - 1]["REASON"].ToString().Trim()');//約束原因
                       set_for_rb('rb_conscious@(j)', '@dt_b.Rows[dt_b.Rows.Count - 1]["CONSCIOUS"].ToString().Trim()');//意識程度
                       //set_for_rb('rb_cycle@(j)', '@dt_b.Rows[dt_b.Rows.Count - 1]["CYCLE"].ToString().Trim()');//約束部位循環
                       set_for_rb('rb_pause@(j)', '@dt_b.Rows[dt_b.Rows.Count - 1]["PAUSE"].ToString().Trim()');//暫時解除約束時間
                       //該評估第一筆
                       set_for_ck('ck_reaction@(j)', '@dt_b.Rows[0]["REACTION"].ToString().Trim()');//病人反應
                       set_for_ck('ck_position@(j)', '@dt_b.Rows[0]["POSITION"].ToString().Trim()');//約束部位
                       set_for_ck('ck_tool@(j)', '@dt_b.Rows[0]["TOOL"].ToString().Trim()');//約束工具               
                       set_for_rb('rb_reason@(j)', '@dt_b.Rows[0]["REASON"].ToString().Trim()');//約束原因
                       set_for_rb('rb_conscious@(j)', '@dt_b.Rows[0]["CONSCIOUS"].ToString().Trim()');//意識程度         
                       set_for_rb('rb_pause@(j)', '@dt_b.Rows[0]["PAUSE"].ToString().Trim()');//暫時解除約束時間
                  
                       //  alert(itemlist);
                       var ohteritem = other.split(",");
                       for (i = 1; i <9; i++)//
                       {
                           // alert(ohteritem[i-1]);
                           $('#txt' + i+'@(j)').val(ohteritem[i-1]);//textbox其他
                    //   set_for_rb(rb_id[i], rb_item[i]);
                }

                   });
            function set_for_rb(id, default_val) {
                var rb = document.getElementsByName(id);
                for (var i = 0; i < rb.length; i++) {
                    if (rb[i].value == default_val)
                        rb[i].checked = true;
                }
            }

            function set_for_ck(id, default_val) {
                var ck = document.getElementsByName(id);
                var name = (default_val + ",").split(",");

                for (var j = 0; j < name.length - 1; j++) {
                    for (var i = 0; i < ck.length; i++) {
                        if ($(ck[i]).attr('text') == name[j]) {
                            ck[i].checked = true;
                            j++;
                        }
                    }
                }
            }
            </script>
            }
        }
       *@ 
}

<style type="text/css">

    .ui-tabs .ui-tabs-nav li a{
        font-size: 16px;
        padding: 3px 5px 3px 5px;
    }

    .ui-tabs{
        font-size: 16px;
    }
    
    .btn-primary {
        color: #fff;
        background-color: #337ab7;
        border-color: #2e6da4;
    }
</style>  

<script type="text/javascript">
    $(document).ready(function () {
        setGridColor();
        $(window).resize(function () {
            if($(this).outerHeight() <= 50 ){
                $(".dataArea").outerHeight(400);
            }
            else {
                $(".dataArea").outerHeight($(this).outerHeight() - 100);
            }
        }).trigger("resize");
        $(".tabArea").tabs({ active: 0 });
        // inital tooltip

            @if(dtr.Rows.Count > 0)
            {
                //@:set_for_rb('rb_reason','@dtr.Rows[0]["REASON"]');
                //@:set_for_rb('rb_conscious','@dtr.Rows[0]["CONSCIOUS"]');
                //@:set_for_ck('ck_reaction', '@dtr.Rows[0]["REACTION"]');
                //@:set_for_ck('ck_position', '@dtr.Rows[0]["POSITION"]');
                //@:set_for_ck('ck_tool', '@dtr.Rows[0]["TOOL"]');
            }
     
        $(".nexttab").click(function () {
            $(this).css("text-align", "right");
            var active = $(".tabArea").tabs("option", "active");
            $(".tabArea").tabs("option", "active", active + 1);
        });

        $(".tabs_area").tabs({
            active: 0
        });

        $(".tooltip").tooltip({
            content: function () {
                return $(this).prop('title');
            }
        }).css({
            "color": "#660000",
            "font-weight": "bold",
            "padding-left": "15px"
        });
    });
    function set_for_rb(rb_name, dvalue) {
        if (dvalue != 'undefined') {
            var rb = document.getElementsByName(rb_name);
            for (var i = 0; i < rb.length; i++) {
                if (rb[i].value == dvalue)
                    $(rb[i]).click();
            }
        }
    }

    //第一筆ck點擊時,連動使用
    function set_for_ck(ck_name, val) {
        if (val != '') {
            var default_val = val.split(",");
            var ck = document.getElementsByName(ck_name);
            for (var i = 0; i < default_val.length; i++) {
                for (var j = 0; j < ck.length; j++) {
                    if (default_val[i] == ck[j].value)
                    {    
                        $(ck[j]).click();
                    }
                }
            }
        }
    }
    function setGridColor() {
        //格行換色
        $('.dataArea tr:odd').css('background', '#ABC8E2');
        $('.dataArea tr:even').css('background', '#E1E6FA');
        $('#txt_day').datetimepicker({
            altField: "#txt_time", maxDateTime: 0
        });
        $('#txtP_day').datetimepicker({
            altField: "#txtP_time", maxDateTime: 0
        });
    }
    function able(id) {
        document.getElementById(id).disabled = false;
    }
    function enable(id) {
        document.getElementById(id).disabled = true;
    }
    function ckable(obj,txtid) {
        var ck = obj;
        if (ck.checked)
        { able(txtid); }
        else
        { enable(txtid); }
    }
    function hideother(spanid, obj) {
        var ck = obj;
        if (ck.checked) {
            document.getElementById(spanid).setAttribute("style", "display:none;");
        }
        else {
            document.getElementById(spanid).setAttribute("style", "display:;");
        }
    }
    function showtr() {
        if (document.getElementById('tr1').hasAttribute("style"))
        { document.getElementById('tr1').setAttribute("style", "display:;"); }
        else
        { document.getElementById('tr1').setAttribute("style", "display:none;"); }
    }
    function check(status) {
        //$('#rb_reason' + i + '').val($('input:radio[name=rb_reason' + i + ']:checked').val())//約束原因
        //$('#rb_conscious' + i + '').val($('input:radio[name=rb_conscious' + i + ']:checked').val())//意識程度
        //mark('ck_reaction' + i + '');//病人反應      
        //mark('ck_position' + i + '');//約束部位
        //mark('ck_tool' + i + '');//約束用具
        //$('#rb_cycle' + i + '').val($('input:radio[name=rb_cycle' + i + ']:checked').val())//循環
        //mark('ck_ending' + i + '')//解除約束
        //mark('ck_harm' + i + '')//約束傷害   

        //$('#rb_reason').val($('input:radio[name=rb_reason]:checked').val())//約束原因
        //$('#rb_conscious').val($('input:radio[name=rb_conscious]:checked').val())//意識程度
        //mark('ck_reaction');//病人反應      
        //mark('ck_position');//約束部位
        //mark('ck_tool');//約束用具
        //$('#rb_cycle').val($('input:radio[name=rb_cycle]:checked').val())//循環
        //mark('ck_ending')//解除約束
        //mark('ck_harm')//約束傷害   
     
        //var content1 = "";
        //for (i = 1; i < 9; i++){
        //    if ($('#txt' + i).val() != undefined)
        //    { content1 += '' + $('#txt' + i).val() + ','; }
        //    else
        //    { content1 +=  ','; }
        //}//textbox其他    
        //$('#OTHER').val(content1.substring(0, content1.length - 1));
        //mag = "";
        
        ////itemlist = "rb_reason,rb_conscious,ck_reaction,ck_position,ck_tool";
        //itemlist="rb_restraint,ck_bindingsite"
        //if ($.trim($("#feq").val().toString()) != '0') {
        //    //itemlist += ",rb_cycle,ck_ending,ck_harm,";

        //    //itemlist += "ck25,ck30";
        //}
        //namelist = "約束原因,意識程度,病人反應,約束部位,約束用具";
        //if ($.trim($("#feq").val().toString()) != '0') {
        //    namelist += ",循環,解除約束,約束傷害,";
        //    namelist += "拔管欄位,骨折部位";
        //}
        //var item = itemlist.split(",");
        //var name = namelist.split(",");
        //for (var i = 0; i < item.length; i++) {
        //    mag += cknull(item[i].toString(), name[i].toString());
        //}
        //if (mag != "") {
        //    alert(mag);
        //    return false;
        //}
        //else {
        //    return true;
        //}
        //---------------以上舊版---------
        //
        ////以下 by jarvis------此為修改及新增單筆時使用
        //$('#rb_restraint').val($('input:radio[name=rb_restraint]:checked').val());//約束方式
        //mark('ck_bindingsite');//
        //$('#rb_pulse').val($('input:radio[name=rb_pulse]:checked').val());
        //$('#rb_tightness').val($('input:radio[name=rb_tightness]:checked').val());
        //$('#rb_temperature').val($('input:radio[name=rb_temperature]:checked').val());
        //$('#rb_colour').val($('input:radio[name=rb_colour]:checked').val());
        //$('#rb_integrity').val($('input:radio[name=rb_integrity]:checked').val());
        //$('#rb_feeling').val($('input:radio[name=rb_feeling]:checked').val());
        //$('#rb_remove').val($('input:radio[name=rb_remove]:checked').val());
        /*----------------------------------------------*/
        //if ($('input[name=rb_restraint]:checked').val() == undefined) {
        //    alert('請選擇 約束方式');
        //    return false;
        //}
        var selected_restraint=[];
        $("[name=ck_restraint]:checked").each(function(){
            selected_restraint.push($(this).val());
        });
        if(selected_restraint.length==0)
        {
            alert('請選擇 約束方式'+selected_restraint.length);
            return false;
        }
        selected_restraint.length=0;


        var selected=[];
        $("[name=ck_bindingsite]:checked").each(function(){
            selected.push($(this).val());
        });
        if(selected.length==0)
        {
            alert('請選擇 約束部位');
            return false;
        }
        selected.length=0;

        if ( $('#txt1:enabled').val() == "" ) 
        {
            alert('請填寫 約束方式，其他');
            return false;
        }
        if ( $('#txt2:enabled').val() == "" ) 
        {
            alert('請填寫 約束部位，其他');
            return false;
        }

        if ($.trim($("#feq").val().toString()) != '0') {
            if ($('input[name=rb_pulse]:checked').val() == undefined) {
                alert('請選擇 脈搏');
                return false;
            }
            if ($('input[name=rb_tightness]:checked').val() == undefined) {
                alert('請選擇 約束鬆緊程度');
                return false;
            }
            if ($('input[name=rb_temperature]:checked').val() == undefined) {
                alert('請選擇 肢體末端溫度');
                return false;
            }
            if ($('input[name=rb_colour]:checked').val() == undefined) {
                alert('請選擇 顏色');
                return false;
            }
            //if ($('input[name=rb_integrity]:checked').val() == undefined) {
            //    alert('請選擇 皮膚完整性');
            //    return false;
            //}
            var selected_integrity=[];
            $("[name=ck_integrity]:checked").each(function(){
                selected_integrity.push($(this).val());
            });
            if(selected_integrity.length==0)
            {
                alert('請選擇 皮膚完整性');
                return false;
            }
            selected_integrity.length=0;

            if ($('input[name=rb_feeling]:checked').val() == undefined) {
                alert('請選擇 感覺度');
                return false;
            }
            //if ($('input[name=rb_remove]:checked').val() == undefined) {
            //    alert('請選擇 鬆除約束、翻身、肢體活動、清潔');
            //    return false;
            //}
        }
        return true;
    }
    function check2() {   
        ////展開多筆後的驗證
        n=0;
        mag = "";
        var obj = $('input:checkbox[id=assdtlist]:checked');//name="assdt[]"
        if (obj.length > 0) {
            for (var a = 0; a < obj.length;a++) {
                j=$(obj[a]).attr('text');
                asstime=$(obj[a]).attr('title');
                    //if ($('input[name=rb_restraint'+j+']:checked').val() == undefined) {
                    //    alert('請選擇 約束方式');
                    //    return false;
                    //}
                    var selected_res=[];
                    $("[name=ck_restraint"+j+"]:checked").each(function(){
                        selected_res.push($(this).val());
                    });
                    if(selected_res.length==0)
                    {
                        alert("資料"+asstime+"\n"+"請選擇 約束方式");
                        return false;
                    }
                    selected_res.length=0;
                    

                    var selected=[];
                    $("[name=ck_bindingsite"+j+"]:checked").each(function(){
                        selected.push($(this).val());
                    });
                    if(selected.length==0)
                    {
                        alert("資料"+asstime+"\n"+"請選擇 約束部位");
                        return false;
                    }
                    selected.length=0;
                    if ( $('#txt1'+j+':enabled').val() == "" ) 
                    {
                        alert("資料"+asstime+"\n"+"請填寫 約束方式，其他");
                        return false;
                    }
                    if ( $('#txt2'+j+':enabled').val() == "" ) 
                    {
                        alert("資料"+asstime+"\n"+"請填寫 約束部位，其他");
                        return false;
                    }
                    if ($.trim($("#feq").val().toString()) != '0') {
                        if ($('input[name=rb_pulse'+j+']:checked').val() == undefined) {
                            alert("資料"+asstime+"\n"+"請選擇 脈搏");
                            return false;
                        }
                        if ($('input[name=rb_tightness'+j+']:checked').val() == undefined) {
                            alert("資料"+asstime+"\n"+"請選擇 約束鬆緊程度");
                            return false;
                        }
                        if ($('input[name=rb_temperature'+j+']:checked').val() == undefined) {
                            alert("資料"+asstime+"\n"+"請選擇 肢體末端溫度");
                            return false;
                        }
                        if ($('input[name=rb_colour'+j+']:checked').val() == undefined) {
                            alert("資料"+asstime+"\n"+"請選擇 顏色");
                            return false;
                        }
                        //if ($('input[name=rb_integrity'+j+']:checked').val() == undefined) {
                        //    alert("資料"+asstime+"\n"+"請選擇 皮膚完整性");
                        //    return false;
                        //}
                        var selected_integrity=[];
                        $("[name=ck_integrity"+j+"]:checked").each(function(){
                            selected_integrity.push($(this).val());
                        });
                        if(selected_integrity.length==0)
                        {
                            alert("資料"+asstime+"\n"+"請選擇 皮膚完整性");
                            return false;
                        }
                        selected_integrity.length=0;
                    
                        if ($('input[name=rb_feeling'+j+']:checked').val() == undefined) {
                            alert("資料"+asstime+"\n"+"請選擇 感覺度");
                            return false;
                        }
                }
            }
            return true;
        }
    }
    
    function cknull(id, name,j) {
        if (id != ("ck25"+j) && id != ("ck30"+j)) {
            if ($('#' + id).val() == null || $('#' + id).val() == "") {
                //    alert($('#' + id).val() + " id=" + id);
                return name + "尚未輸入\n";
            }
            else {
                return "";
            }
        }
        else {
            //alert('id='+id+" name="+name);
            if (document.getElementById("ck24"+j).checked == false) {
                //  alert('id=' + id + " name=" + name);
                var ck = document.getElementById(id);

                if (ck.checked == true) {
                    if (id == ("ck25"+j) && $('#txt_harm1'+j).val() == "") {
                        return name + "尚未輸入\n";
                    }
                    if (id == ("ck30"+j) && $('#txt_harm2'+j).val() == "") {
                        return name + "尚未輸入\n";
                    }
                    else
                        return "";
                }
                return "";
            }
            return "";
        }
    }
    function mark(id) {
        //傳入id將checkbox用,分開紀錄 
        var content = '';
        var obj = $('input:checkbox[name=' + id+ ']:checked');
        if (obj.length > 0) {
            for (var i = 0; i < obj.length; i++) {
                content = content + $(obj[i]).attr('text') + ',';
                if ($(obj[i]).attr('text') == "無") {
                    content = $(obj[i]).attr('text') + ',';
                    $('#' + id).val(content.substring(0, content.length - 1));
                    break;
                }
            }
            $('#' + id).val(content.substring(0, content.length - 1));
        }
    }
    function canceladd(id,feq){
        if(confirm('確定放棄?')){
            loop_windows("open_cover");
                $.ajax({
                    type: 'POST',
                   //url: "AssessNew_Cancel",
                    url: '@Url.Content("~/ConstraintsAssessment/AssessNew_Cancel")',
                    data: { id: id ,Pfeq:feq},
                    success: function (data) {
                    },
                    error: function (data) {
                    },
                    complete: function () {
                        window.location.href='ListNew';
                        loop_windows("close_cover");
                    }
                });
            }
        
    }
    function linked (name,val)//第一筆帶下面
    {
        Count=0;
        if ($('#TListCount').val() !=""){
            Count =  $('#TListCount').val();
        }
        for(var i=1;i< Count ;i++)
        {
            if((name=='ck_restraint')||(name=='ck_bindingsite')||(name=='ck_integrity')) 
            { //(name =='ck_reaction'|| name =='ck_position' || name=='ck_tool' || name=='ck_ending' || name=='ck_harm')
                set_for_ck(name+i, val);
            }
            else if((name=='rb_pulse')||(name=='rb_tightness')||(name=='rb_temperature')||(name=='rb_colour')||(name=='rb_feeling')||(name=='rb_remove'))
            { //(name=='rb_reason'|| name=='rb_conscious' || name=='rb_cycle'|| name=='rb_pause')
                set_for_rb(name+i, val);
            }
            else
            { $('#'+name+i).val(val);//textbox其他
            }
        }
    }
    function selAll(){
        //變數checkItem為checkbox的集合
        var checkItem = document.getElementsByName("assdt[]");
        for(var i=0;i<checkItem.length;i++){
            checkItem[i].checked=true;   
        }
    }

    function unselAll(){
        //變數checkItem為checkbox的集合
        var checkItem = document.getElementsByName("assdt[]");
        for(var i=0;i<checkItem.length;i++){
            checkItem[i].checked=false;
        }
    }

    function div_hidden(id_list) {
        var list = id_list.split(',');
        for (var i = 0 ; i < list.length; i++) {
            $('.' + list[i]).fadeOut(0);
            var input_list = $('.' + list[i] + ' input, .' + list[i] + ' textarea');
            for (var j = 0 ; j < input_list.length; j++) {
                if (input_list[j].type == "textarea" || input_list[j].type == 'text')
                    $(input_list[j]).val('');
                else if (input_list[j].type == 'radio')
                    input_list[j].checked = false;
                else {
                    if (input_list[j].checked)
                        $(input_list[j]).click();
                }
            }
        }
    }
</script>
@{
    DataTable BindingSitedt = ViewBag.BindingSite_dt;
    DataTable Restraintdt= ViewBag.Restraint_dt;
    DataTable Integritydt = ViewBag.Integrity_dt;
    }
<div class="funcArea">
<form method="post" action="AssessNew"> 
    <div class="funcArea" style="width:100%;text-align:center;">
        <table border="0" cellpadding="0" cellspacing="0" style="width:100%;">

    <tr>
        <td align="center" style="padding:5px 0 5px 0;">
            <table border="0" cellpadding="0" cellspacing="0" style="width:100%;">
                <tr>
                    <td>     
                         @if(TList != null && TList.Count > 0)
                         {
                            <input type="button" value="新增存檔" onclick="loop_windows('open_cover');this.disabled=true;if(check2()){submit();}else{this.disabled=false; loop_windows('close_cover');}"/>
                         }
                         else
                         {
                             <input type="button" value="新增存檔" onclick="loop_windows('open_cover');this.disabled=true;if(check()){if(submit())window.location.href ='ListNew'}else{this.disabled=false; loop_windows('close_cover');}" />
                         }
                        @if(feq == 0)
                        {
                        <input type="button" value="放棄目前編輯資料" onclick="canceladd('@(id)','Y');" />
                        }
                        else
                        { 
                         <input type="button" value="放棄目前編輯資料" onclick="canceladd('@(id)');" />
                        }
                         <input type="button" value="全選" onclick="selAll()" />
                         <input type="button" value="取消全選" onclick="unselAll()" />
                    </td>
                </tr>
            </table>
        </td>
    </tr>    
    <tr>
        <td>
            <div class="dataArea" style="height:320px;text-align:left;">
                <table border="0" cellpadding="0" cellspacing="0" style="width:100%;">
                    <tr>
                        <td style="padding:0 0 5px 0;">
                            <input id="feq" type="hidden" value="@feq"  name="feq"/>
                            <input  type="hidden" value="@id"  name="ID"/>
                            <input  type="hidden" value="@BOUT"  name="BOUT"/>
                            <input  type="hidden" value="@assessdt"  name="assessdt"/>
                            @* <input  type="hidden" value="@OTHER"  name="OTHER" id="OTHER"/>*@
                            <input  type="hidden" value="@BINDID"  name="BINDID" />
                            <input  type="hidden" value="@TListCount"  name="TListCount" id="TListCount" />
                            @* listtime 次數 *@
                           <input  type="hidden" value="@TList.Count"  name="listtime" />
                            @{int rblist = 1, rb = 1, txt = 1, ck = 1, span = 1;}                               
                                   
                                @if (TList != null && TList.Count > 0)
                                {
                                    for (int j = 0; j < TList.Count; j++)
                                    {
                                        rblist = 1;
                                        rb = 1;
                                        txt = 1;
                                        ck = 1;
                                        span = 1;
                                <div>
                                    <span class="fath" style="text-align:center; width:99%; color:Blue;height:30px;">                 
                                        @if(feq == 0 && (dt != null || dt.Rows.Count == 0))
                                        {
                                            @Html.Label("ck_date", "評估日期:")
                                            @Html.Label("textdate", @assessdt)
                                             <label>此評估會輸入至護理紀錄</label>
                                        }
                                        else
                                        {
                                            string assdt = DateTime.Parse(TList[j]).ToString("yyyy/MM/dd HH:mm:ss").ToString();  
                                            <span class="fath" style="text-align: center; width: 99%; color: Blue; height: 30px;">
                                               @* @Html.CheckBox("ck_date[]",true, new { text =@assdt, value = @assdt })
                                                @Html.Label("ck_date" + @j, "")*@
                                                @Html.Raw("<label>")  
                                               <input id="assdtlist" name="assdt[]" type="checkbox" text="@(j)" checked="checked" value="@(j)_@(assdt)"  title="@(assdt)"  style="display:inline"/>  
                                                @Html.Raw("評估日期:" + TList[j])
                                                @Html.Raw("</label>")  
                                            </span>         
                                             <input name="AssdtAll[]" type="checkbox" checked="checked" value="@(assdt)" style="display:none"/>
                                            @*<input  type="hidden" value="@OTHER"  name="OTHER@(j)" id="OTHER@(j)"/>*@
                                        }  
                                        <span class="voiceHistoryBtn">
                                            <input type="button"
                                                   class="btn btn-primary voiceHistory voiceBtn"
                                                   voiceHistoryId="@(j)"
                                                   value="語音歷程"
                                                   title="VoiceHistory">
                                            <input type="hidden" id="voiceBtnId" value="" />
                                        </span>
                                    </span>
                                    <table border="0" cellpadding="2" cellspacing="2" style="width:100%;font-size:14px;">
                                          <tr>
                                            <th style="/*height:30px;*/">約束方式</th>
                                            <td >
                                                <input id ="ck_restraint@(j)"   type="hidden" value="@RESTRAINT"  name="RESTRAINT@(j)"/>  
                                                @*@Html.RadioButton("rb_restraint" + @j, "腕部肢體約束", false, new { id = "rb" + @rb + @j, onclick = "enable('txt1" + @j + "');if(" + @j + "==0)linked('rb_restraint',this.value)", style = "display:none;" })
                                                @Html.Label("rb" + @rb + @j, "腕部肢體約束", new { style = "display:none;" })@{rb++;}
                                                @Html.RadioButton("rb_restraint" + @j, "腰腹部床單約束", false, new { id = "rb" + @rb + @j, onclick = "enable('txt1" + @j + "');if(" + @j + "==0)linked('rb_restraint',this.value)", style = "display:none;" })
                                                @Html.Label("rb" + @rb + @j, "腰腹部床單約束", new { style = "display:none;" })@{rb++;}
                                                @Html.RadioButton("rb_restraint" + @j, "手套約束", false, new { id = "rb" + @rb + @j, onclick = "enable('txt1" + @j + "');if(" + @j + "==0)linked('rb_restraint',this.value)", style = "display:none;" })
                                                @Html.Label("rb" + @rb + @j, "手套約束", new { style = "display:none;" })@{rb++;}
                                                @Html.RadioButton("rb_restraint" + @j, "背心約束", false, new { id = "rb" + @rb + @j, onclick = "enable('txt1" + @j + "');if(" + @j + "==0)linked('rb_restraint',this.value)", style = "display:none;" })
                                                @Html.Label("rb" + @rb + @j, "背心約束", new { style = "display:none;" })@{rb++;}
                                                @Html.RadioButton("rb_restraint" + @j, "夾克約束", false, new { id = "rb" + @rb + @j, onclick = "enable('txt1" + @j + "');if(" + @j + "==0)linked('rb_restraint',this.value)", style = "display:none;" })
                                                @Html.Label("rb" + @rb + @j, "夾克約束", new { style = "display:none;" })@{rb++;}
                                                
                                                @Html.RadioButton("rb_restraint" + @j, "輪椅腰部約束", false, new { id = "rb" + @rb + @j, onclick = "enable('txt1" + @j + "');if(" + @j + "==0)linked('rb_restraint',this.value)", style = "display:none;" })
                                                @Html.Label("rb" + @rb + @j, "輪椅腰部約束", new { style = "display:none;" })@{rb++;}
                                                @Html.RadioButton("rb_restraint" + @j, "踝部約束", false, new { id = "rb" + @rb + @j, onclick = "enable('txt1" + @j + "');if(" + @j + "==0)linked('rb_restraint',this.value)", style = "display:none;" })
                                                @Html.Label("rb" + @rb + @j, "踝部約束", new { style = "display:none;" })@{rb++;}
                                                @Html.RadioButton("rb_restraint" + @j, "膝蓋約束", false, new { id = "rb" + @rb + @j, onclick = "enable('txt1" + @j + "');if(" + @j + "==0)linked('rb_restraint',this.value)", style = "display:none;" })
                                                @Html.Label("rb" + @rb + @j, "膝蓋約束", new { style = "display:none;" })@{rb++;}
                                                @Html.RadioButton("rb_restraint" + @j, "其他", false, new { id = "rb" + @rb + @j, onclick = "able('txt1" + @j + "');if(" + @j + "==0)linked('rb_restraint',this.value)", style = "display:none;" })
                                                @Html.Label("rb" + @rb + @j, "其他", new { style = "display:none;" })@{rb++;}
                                                @Html.TextBox("txt1" + @j, "", new { style = "
                                                    width:80px;display:none;", disabled = "disabled", onchange = "if(" + @j + "==0)linked('txt1',this.value)" })
                                                @{rblist++; txt++;}*@
                                                <!--2016 12 05 將約束的皮膚完整性、約束方式 ，兩項 改成複選 ， 註解部分為原本未更動前 單選 的code  by jarvis edit-->

                                                @{                    
                                                  if(Restraintdt != null && Restraintdt.Rows.Count > 0)
                                                  {
                                                      for(int x = 0; x < Restraintdt.Rows.Count; x++)
                                                      {
                                                        @Html.Raw("<input style='display:none;' id='ck" + ck + j + "' name='ck_restraint" + j + "' type='checkbox' text='" + Restraintdt.Rows[x]["P_VALUE"] + "' ")
                                                        @Html.Raw(" value='" + Restraintdt.Rows[x]["P_VALUE"] + "' onclick=\"")
                                                          if(Restraintdt.Rows[x]["P_VALUE"].ToString() == "其他")
                                                          {
                                                              @Html.Raw("ckable(this,'txt1" + @j + "');")
                                                          }
                                                        @Html.Raw("if(" + j + "==0){linked('ck_restraint',this.value);}\"/>")
                                                        @Html.Raw("<label style='display:none;' for='ck" + ck + j + "'>" + Restraintdt.Rows[x]["P_VALUE"] + "</label>")
                                                          ck++;
                                                      }
                                                      @Html.TextBox("txt1" + @j, "", new { id = "txt1" + @j, style = "width:80px;display:none;", disabled = "disabled", onchange = "if(" + @j + "==0)linked('txt1',this.value)" })
                                                      rblist++; txt++;
                                                  }     
                                                 }
                                                <label name="lab_restraint"></label><label name="lab_restraint_other"></label> 

                                            </td>
                                       </tr>
                                       <tr>
                                            <th style="/*height:30px;*/">約束部位</th>
                                            <td>
                                                <input id ="ck_bindingsite@(j)"  type="hidden" value="@BINDINGSITE"  name="BINDINGSITE@(j)"/>     
                                                @{                    
                                                  if(BindingSitedt != null && BindingSitedt.Rows.Count > 0)
                                                  {
                                                      for(int x = 0; x < BindingSitedt.Rows.Count; x++)
                                                      {
                                                        @Html.Raw("<input style='display:none;' id='ck" + ck + j + "' name='ck_bindingsite" + j + "' type='checkbox' text='" + BindingSitedt.Rows[x]["P_VALUE"] + "' ")
                                                        @Html.Raw(" value='" + BindingSitedt.Rows[x]["P_VALUE"] + "' onclick=\"")
                                                          if(BindingSitedt.Rows[x]["P_VALUE"].ToString() == "其他")
                                                          {
                                                              //@Html.Raw("able('txt2" + @j + "');")
                                                              @Html.Raw("ckable(this,'txt2" + @j + "');")
                                                          }
                                                        @Html.Raw("if(" + j + "==0){linked('ck_bindingsite',this.value);}\"/>")
                                                        @Html.Raw("<label style='display:none;' for='ck" + ck + j + "'>" + BindingSitedt.Rows[x]["P_VALUE"] + "</label>")
                                                          ck++;
                                                      }
                                                      @Html.TextBox("txt2" + @j, "", new { id = "txt2" + @j, style = "width:80px;display:none;", disabled = "disabled", onchange = "if(" + @j + "==0)linked('txt2',this.value)" })
                                                      rblist++; txt++;
                                                  }     
                                                 }
                                                <label name="lab_bindingsite"></label><label name="lab_bindingsite_other"></label>
                                            </td>
                                        </tr>
                                         

                                         @if(feq != 0)
                                         {//如果為第一筆自動新增時 不需帶出以下項目   
                                             <tr >
                                            <th style="width:15%;height:30px;">脈搏</th>
                                            <td>
                                                <input id ="rb_pulse@(j)"  type="hidden" value="@PULSE"  name="PULSE@(j)"/>
                                                <label>
                                                <input id="rb@(rb)@(j)" name="rb_pulse@(j)" type="radio" value="快" onclick="if(@(j)==0){linked('rb_pulse',this.value);}"/>快
                                                </label>@{rb++;}
                                                <label>
                                                <input id="rb@(rb)@(j)" name="rb_pulse@(j)" type="radio" value="慢" onclick="if(@(j)==0){linked('rb_pulse',this.value);}"/>慢
                                                </label>@{rb++;}
                                                <label>
                                                <input id="rb@(rb)@(j)" name="rb_pulse@(j)" type="radio" value="規則" onclick="if(@(j)==0){linked('rb_pulse',this.value);}"/>規則
                                                </label>@{rb++;}
                                              
                                            </td>
                                        </tr>
                                        <tr >
                                            <th style="width:15%;height:30px;">約束鬆緊程度</th>
                                            <td>
                                                <input id ="rb_tightness@(j)"  type="hidden" value="@TIGHTNESS"  name="TIGHTNESS@(j)"/>
                                              
                                                <label>
                                                <input id="rb@(rb)@(j)" name="rb_tightness@(j)" type="radio" value="鬆" onclick="if(@(j)==0){linked('rb_tightness',this.value);}"/>鬆
                                                </label>@{rb++;}
                                                <label>
                                                <input id="rb@(rb)@(j)" name="rb_tightness@(j)" type="radio" value="緊" onclick="if(@(j)==0){linked('rb_tightness',this.value);}"/>緊
                                                </label>@{rb++;}
                                                <label>
                                                <input id="rb@(rb)@(j)" name="rb_tightness@(j)" type="radio" value="適度" onclick="if(@(j)==0){linked('rb_tightness',this.value);}"/>適度
                                                </label>@{rb++;}
                                            </td>
                                         </tr>
                                         <tr >
                                            <th style="width:15%;height:30px;">肢體末端溫度</th>
                                            <td>
                                                <input id ="rb_temperature@(j)"  type="hidden" value="@TEMPERATURE"  name="TEMPERATURE@(j)"/>
                                                <label>
                                                <input id="rb@(rb)@(j)" name="rb_temperature@(j)" type="radio" value="溫暖" onclick="if(@(j)==0){linked('rb_temperature',this.value);}"/>溫暖
                                                </label>@{rb++;}
                                                <label>
                                                <input id="rb@(rb)@(j)" name="rb_temperature@(j)" type="radio" value="冰冷" onclick="if(@(j)==0){linked('rb_temperature',this.value);}"/>冰冷
                                                </label>@{rb++;}
                                             
                                            </td>
                                        </tr>
                                        <tr >
                                            <th style="width:15%;height:30px;">顏色</th>
                                            <td>
                                                <input id ="rb_colour@(j)"  type="hidden" value="@COLOUR"  name="COLOUR@(j)"/>

                                                <label>
                                                <input id="rb@(rb)@(j)" name="rb_colour@(j)" type="radio" value="紅潤" onclick="if(@(j)==0){linked('rb_colour',this.value);}"/>紅潤
                                                </label>@{rb++;}
                                                <label>
                                                <input id="rb@(rb)@(j)" name="rb_colour@(j)" type="radio" value="發紺" onclick="if(@(j)==0){linked('rb_colour',this.value);}"/>發紺
                                                </label>@{rb++;}

                                            </td>
                                        </tr>
                                        <tr >
                                            <th style="width:15%;height:30px;">皮膚完整性</th>
                                            <td>
                                                <input id ="ck_integrity@(j)"  type="hidden" value="@INTEGRITY"  name="INTEGRITY@(j)"/>
                                              @*  <label>
                                                <input id="rb@(rb)@(j)" name="rb_integrity@(j)" type="radio" value="腫脹" onclick="if(@(j)==0){linked('rb_integrity',this.value);}"/>腫脹
                                                </label>@{rb++;}
                                                <label>
                                                <input id="rb@(rb)@(j)" name="rb_integrity@(j)" type="radio" value="水泡" onclick="if(@(j)==0){linked('rb_integrity',this.value);}"/>水泡
                                                </label>@{rb++;}
                                                <label>
                                                <input id="rb@(rb)@(j)" name="rb_integrity@(j)" type="radio" value="破皮" onclick="if(@(j)==0){linked('rb_integrity',this.value);}"/>破皮
                                                </label>@{rb++;}
                                                <label>
                                                <input id="rb@(rb)@(j)" name="rb_integrity@(j)" type="radio" value="正常" onclick="if(@(j)==0){linked('rb_integrity',this.value);}"/>正常
                                                </label>@{rb++;}*@
                                                <!--2016 12 05 將約束的皮膚完整性、約束方式 ，兩項 改成複選 ， 註解部分為原本未更動前 單選 的code  by jarvis edit-->

                                                 @{                    
                                                  if(Integritydt != null && Integritydt.Rows.Count > 0)
                                                  {
                                                      for(int x = 0; x < Integritydt.Rows.Count; x++)
                                                      {
                                                        @Html.Raw("<input  id='ck" + ck + j + "' name='ck_integrity" + j + "' type='checkbox' text='" + Integritydt.Rows[x]["P_VALUE"] + "' ")
                                                        @Html.Raw(" value='" + Integritydt.Rows[x]["P_VALUE"] + "' onclick=\"")
                                                        @Html.Raw("if(" + j + "==0){linked('ck_integrity',this.value);}\"/>")
                                                        @Html.Raw("<label for='ck" + ck + j + "'>" + Integritydt.Rows[x]["P_VALUE"] + "</label>")
                                                          ck++;
                                                      }
                                                      rblist++;
                                                  }     
                                                 }

                                            </td>
                                        </tr>
                                        <tr >
                                            <th style="width:15%;height:30px;">感覺度</th>
                                            <td>
                                                <input id ="rb_feeling@(j)"  type="hidden" value="@FEELING"  name="FEELING@(j)"/>
                                                <label>
                                                <input id="rb@(rb)@(j)" name="rb_feeling@(j)" type="radio" value="麻木" onclick="if(@(j)==0){linked('rb_feeling',this.value);}"/>麻木
                                                </label>@{rb++;}
                                                <label>
                                                <input id="rb@(rb)@(j)" name="rb_feeling@(j)" type="radio" value="刺痛" onclick="if(@(j)==0){linked('rb_feeling',this.value);}"/>刺痛
                                                </label>@{rb++;}
                                                <label>
                                                <input id="rb@(rb)@(j)" name="rb_feeling@(j)" type="radio" value="正常" onclick="if(@(j)==0){linked('rb_feeling',this.value);}"/>正常
                                                </label>@{rb++;}
                                                <label>
                                                <input id="rb@(rb)@(j)" name="rb_feeling@(j)" type="radio" value="無法評估" onclick="if(@(j)==0){linked('rb_feeling',this.value);}"/>無法評估
                                                </label>@{rb++;}
                                            </td>
                                        </tr>
                                         <tr >
                                            <th style="width:15%;height:30px;">鬆除約束、翻身、肢體活動、清潔</th>
                                            <td>
                                                <input id ="rb_remove@(j)"  type="hidden" value="@REMOVE"  name="REMOVE@(j)"/>
                                                <label>
                                                <input id="rb@(rb)@(j)" name="rb_remove@(j)" type="radio" value="是" onclick="if(@(j)==0){linked('rb_remove',this.value);}"/>是
                                                </label>@{rb++;}
                                                <label>
                                                <input id="rb@(rb)@(j)" name="rb_remove@(j)" type="radio" value="否" onclick="if(@(j)==0){linked('rb_remove',this.value);}"/>否
                                                </label>@{rb++;}
                                            </td>
                                        </tr>  
                                        <tr>
                                            <th style="width:15%;height:30px;">備註</th>
                                            <td>
                                               @Html.TextBox("txt10"+@j, "", new { id = "txt10"+@j, style = "width:150px;"})
                                            </td>
                                        </tr>                                       
                                         }
                                    </table>
                                </div>
                                        }
                                    }
                                    else
                                    {
                                <div>
                                    <span class="fath" style="text-align:center; width:99%; color:Blue;height:30px;">                 
                                       
                                        @if(feq == 0)
                                        {                                            
                                            @Html.Label("ck_date", "評估日期:")
                                            @Html.Label("textdate", @assessdt)
                                             <label>此評估會輸入至護理紀錄</label>
                                        }                        
                                    </span>
                                    <table border="0" cellpadding="2" cellspacing="2" style="width:100%;font-size:14px;">
                                      @if(feq == 0)
                                      {@*第一次新增(修改也是進這裡)時只會出現約束方式及約束部位*@
                                          if(dt != null && dt.Rows.Count > 0)
                                          {
                                                <tr >
                                                    <th style="height:30px;width:100px;">約束方式</th>
                                                    <td> 
                                                        <label name="lab_restraint"></label><label name="lab_restraint_other"></label>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th style="height:30px;">約束部位</th>
                                                    <td>
                                                        <label name="lab_bindingsite"></label><label name="lab_bindingsite_other"></label>
                                                    </td>
                                                </tr>
                                          }
                                          else
                                          { 
                                        <tr >
                                            <th style="height:30px;width:100px;">約束方式</th>
                                            <td>
                                                <input id ="ck_restraint"  type="hidden" value="@RESTRAINT"  name="RESTRAINT"/>  
                                              @*  @Html.RadioButton("rb_restraint", "腕部肢體約束", false, new { id = "rb" + @rb, onclick = "enable('txt1')" })
                                                @Html.Label("rb" + @rb, "腕部肢體約束")@{rb++;}
                                                @Html.RadioButton("rb_restraint", "腰腹部床單約束", false, new { id = "rb" + @rb, onclick = "enable('txt1')" })
                                                @Html.Label("rb" + @rb, "腰腹部床單約束")@{rb++;}
                                                @Html.RadioButton("rb_restraint", "手套約束", false, new { id = "rb" + @rb, onclick = "enable('txt1')" })
                                                @Html.Label("rb" + @rb, "手套約束")@{rb++;}
                                                @Html.RadioButton("rb_restraint", "背心約束", false, new { id = "rb" + @rb, onclick = "enable('txt1')" })
                                                @Html.Label("rb" + @rb, "背心約束")@{rb++;}
                                                @Html.RadioButton("rb_restraint", "夾克約束", false, new { id = "rb" + @rb, onclick = "enable('txt1')" })
                                                @Html.Label("rb" + @rb, "夾克約束")@{rb++;}
                                                <br />
                                                @Html.RadioButton("rb_restraint", "輪椅腰部約束", false, new { id = "rb" + @rb, onclick = "enable('txt1')" })
                                                @Html.Label("rb" + @rb, "輪椅腰部約束")@{rb++;}
                                                @Html.RadioButton("rb_restraint", "踝部約束", false, new { id = "rb" + @rb, onclick = "enable('txt1')" })
                                                @Html.Label("rb" + @rb, "踝部約束")@{rb++;}
                                                @Html.RadioButton("rb_restraint", "膝蓋約束", false, new { id = "rb" + @rb, onclick = "enable('txt1')" })
                                                @Html.Label("rb" + @rb, "膝蓋約束")@{rb++;}
                                                @Html.RadioButton("rb_restraint", "其他", false, new { id = "rb" + @rb, onclick = "able('txt1')" })
                                                @Html.Label("rb" + @rb, "其他")@{rb++;}
                                                @Html.TextBox("txt1", "", new { style = "width:80px;", disabled = "disabled" })
                                                @{rblist++; txt++;}*@
                                                <!--2016 12 05 將約束的皮膚完整性、約束方式 ，兩項 改成複選 ， 註解部分為原本未更動前 單選 的code  by jarvis edit-->

                                                 @{                    
                                              if(Restraintdt != null && Restraintdt.Rows.Count > 0)
                                                  {
                                                      for(int x = 0; x < Restraintdt.Rows.Count; x++)
                                                      {
                                                        @Html.Raw("<input id='ck" + ck + "' name='ck_restraint' type='checkbox' text='" + Restraintdt.Rows[x]["P_VALUE"] + "' ")
                                                        @Html.Raw(" value='" + Restraintdt.Rows[x]["P_VALUE"] + "' onclick=\"")
                                                          if(Restraintdt.Rows[x]["P_VALUE"].ToString() == "其他")
                                                          {
                                                              @Html.Raw("ckable(this,'txt1');")
                                                          }
                                                        @Html.Raw("\"/>")
                                                        @Html.Raw("<label for='ck" + ck + "'>" + Restraintdt.Rows[x]["P_VALUE"] + "</label>")
                                                          ck++;
                                                      }
                                                      @Html.TextBox("txt1", "", new { id = "txt1", style = "width:80px;", disabled = "disabled", onchange = "" })
                                                      rblist++; txt++;
                                                  }
                                                    }

                                            </td>
                                        </tr>
                                        <tr>
                                            <th style="height:30px;">約束部位</th>
                                            <td>
                                                 <input id ="ck_bindingsite"  type="hidden" value="@BINDINGSITE"  name="BINDINGSITE"/>     
                                                @{                    
                                                  if(BindingSitedt != null && BindingSitedt.Rows.Count > 0)
                                                  {
                                                      for(int x = 0; x < BindingSitedt.Rows.Count; x++)
                                                      {
                                                        @Html.Raw("<input id='ck" + ck + "' name='ck_bindingsite' type='checkbox' text='" + BindingSitedt.Rows[x]["P_VALUE"] + "' ")
                                                        @Html.Raw(" value='" + BindingSitedt.Rows[x]["P_VALUE"] + "' onclick=\"")
                                                          if(BindingSitedt.Rows[x]["P_VALUE"].ToString() == "其他")
                                                          {
                                                              @Html.Raw("ckable(this,'txt2');")
                                                          }
                                                        @Html.Raw("\"/>")
                                                        @Html.Raw("<label for='ck" + ck + "'>" + BindingSitedt.Rows[x]["P_VALUE"] + "</label>")
                                                          ck++;
                                                      }
                                                      @Html.TextBox("txt2", "", new { id = "txt2", style = "width:80px;", disabled = "disabled", onchange = "" })
                                                      rblist++; txt++;
                                                  }
                                                    }
                                            </td>
                                        </tr>
                                          }
                                      }
                                      else
                                      {
                                          <tr >
                                            <th style="height:30px;width:100px;">約束方式</th>
                                            <td>
                                                <input id ="ck_restraint"  type="hidden" value="@RESTRAINT"  name="RESTRAINT"/>  @*單筆修改的顯示 <br />*@
                                               @* @Html.RadioButton("rb_restraint", "腕部肢體約束", false, new { id = "rb" + @rb, onclick = "enable('txt1')", style = "display:none;" })
                                                @Html.Label("rb" + @rb, "腕部肢體約束", new { style = "display:none;" })@{rb++;}
                                                @Html.RadioButton("rb_restraint", "腰腹部床單約束", false, new { id = "rb" + @rb, onclick = "enable('txt1')", style = "display:none;" })
                                                @Html.Label("rb" + @rb, "腰腹部床單約束", new { style = "display:none;" })@{rb++;}
                                                @Html.RadioButton("rb_restraint", "手套約束", false, new { id = "rb" + @rb, onclick = "enable('txt1')", style = "display:none;" })
                                                @Html.Label("rb" + @rb, "手套約束", new { style = "display:none;" })@{rb++;}
                                                @Html.RadioButton("rb_restraint", "背心約束", false, new { id = "rb" + @rb, onclick = "enable('txt1')", style = "display:none;" })
                                                @Html.Label("rb" + @rb, "背心約束", new { style = "display:none;" })@{rb++;}
                                                @Html.RadioButton("rb_restraint", "夾克約束", false, new { id = "rb" + @rb, onclick = "enable('txt1')", style = "display:none;" })
                                                @Html.Label("rb" + @rb, "夾克約束", new { style = "display:none;" })@{rb++;}
                                               
                                                @Html.RadioButton("rb_restraint", "輪椅腰部約束", false, new { id = "rb" + @rb, onclick = "enable('txt1')", style = "display:none;" })
                                                @Html.Label("rb" + @rb, "輪椅腰部約束", new { style = "display:none;" })@{rb++;}
                                                @Html.RadioButton("rb_restraint", "踝部約束", false, new { id = "rb" + @rb, onclick = "enable('txt1')", style = "display:none;" })
                                                @Html.Label("rb" + @rb, "踝部約束", new { style = "display:none;" })@{rb++;}
                                                @Html.RadioButton("rb_restraint", "膝蓋約束", false, new { id = "rb" + @rb, onclick = "enable('txt1')", style = "display:none;" })
                                                @Html.Label("rb" + @rb, "膝蓋約束", new { style = "display:none;" })@{rb++;}
                                                @Html.RadioButton("rb_restraint", "其他", false, new { id = "rb" + @rb, onclick = "able('txt1')", style = "display:none;" })
                                                @Html.Label("rb" + @rb, "其他", new { style = "display:none;" })@{rb++;}
                                                @Html.TextBox("txt1", "", new { style = "width:80px;display:none;", disabled = "disabled" })
                                                @{rblist++; txt++;}*@
                                                <!--2016 12 05 將約束的皮膚完整性、約束方式 ，兩項 改成複選 ， 註解部分為原本未更動前 單選 的code  by jarvis edit-->


                                                @{                    
                                                  if(Restraintdt != null && Restraintdt.Rows.Count > 0)
                                                  {
                                                      for(int x = 0; x < Restraintdt.Rows.Count; x++)
                                                      {
                                                        @Html.Raw("<input style='display:none;' id='ck" + ck + "' name='ck_restraint' type='checkbox' text='" + Restraintdt.Rows[x]["P_VALUE"] + "' ")
                                                        @Html.Raw(" value='" + Restraintdt.Rows[x]["P_VALUE"] + "' onclick=\"")
                                                          if(Restraintdt.Rows[x]["P_VALUE"].ToString() == "其他")
                                                          {
                                                              @Html.Raw("ckable(this,'txt1');")
                                                          }
                                                        @Html.Raw("\"/>")
                                                        @Html.Raw("<label style='display:none;' for='ck" + ck + "'>" + Restraintdt.Rows[x]["P_VALUE"] + "</label>")
                                                          ck++;
                                                      }
                                                      @Html.TextBox("txt1", "", new { id = "txt1", style = "width:80px;display:none;", disabled = "disabled", onchange = "" })
                                                      rblist++; txt++;
                                                  }
                                                 }

                                                <label name="lab_restraint"></label><label name="lab_restraint_other"></label>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th style="height:30px;">約束部位</th>
                                            <td>
                                                 <input id ="ck_bindingsite"  type="hidden" value="@BINDINGSITE"  name="BINDINGSITE"/>     
                                                @{                    
                                                  if(BindingSitedt != null && BindingSitedt.Rows.Count > 0)
                                                  {
                                                      for(int x = 0; x < BindingSitedt.Rows.Count; x++)
                                                      {
                                                        @Html.Raw("<input style='display:none;' id='ck" + ck + "' name='ck_bindingsite' type='checkbox' text='" + BindingSitedt.Rows[x]["P_VALUE"] + "' ")
                                                        @Html.Raw(" value='" + BindingSitedt.Rows[x]["P_VALUE"] + "' onclick=\"")
                                                          if(BindingSitedt.Rows[x]["P_VALUE"].ToString() == "其他")
                                                          {
                                                              //@Html.Raw("able('txt2" + @j + "');")
                                                              @Html.Raw("ckable(this,'txt2');")
                                                          }
                                                        @Html.Raw("\"/>")
                                                        @Html.Raw("<label style='display:none;' for='ck" + ck + "'>" + BindingSitedt.Rows[x]["P_VALUE"] + "</label>")
                                                          ck++;
                                                      }
                                                      @Html.TextBox("txt2", "", new { id = "txt2", style = "width:80px;display:none;", disabled = "disabled", onchange = "" })
                                                      rblist++; txt++;
                                                  }
                                                    }
                                                <label name="lab_bindingsite"></label><label name="lab_bindingsite_other"></label>
                                            </td>
                                        </tr>
                                      }
                                         @if(feq != 0)
                                         {//如果為第一筆自動新增時 不需帶出以下項目   
                                                        <tr >
                                            <th style="width:15%;height:30px;">脈搏</th>
                                            <td>
                                                <input id ="rb_pulse"  type="hidden" value="@PULSE"  name="PULSE"/>
                                                @Html.RadioButton("rb_pulse", "快", new { id = "rb" + @rb, onclick = "" })
                                                @Html.Label("rb" + @rb, "快")@{rb++;}
                                                @Html.RadioButton("rb_pulse", "慢", new { id = "rb" + @rb, onclick = "" })
                                                @Html.Label("rb" + @rb, "慢")@{rb++;}
                                                @Html.RadioButton("rb_pulse", "規則", new { id = "rb" + @rb, onclick = "" })
                                                @Html.Label("rb" + @rb, "規則")@{rb++;}
                                            </td>
                                        </tr>
                                        <tr >
                                            <th style="width:15%;height:30px;">約束鬆緊程度</th>
                                            <td>
                                                <input id ="rb_tightness"  type="hidden" value="@TIGHTNESS"  name="TIGHTNESS"/>
                                                @Html.RadioButton("rb_tightness", "鬆", new { id = "rb" + @rb, onclick = "" })
                                                @Html.Label("rb" + @rb, "鬆")@{rb++;}
                                                @Html.RadioButton("rb_tightness", "緊", new { id = "rb" + @rb, onclick = "" })
                                                @Html.Label("rb" + @rb, "緊")@{rb++;}
                                                @Html.RadioButton("rb_tightness", "適度", new { id = "rb" + @rb, onclick = "" })
                                                @Html.Label("rb" + @rb, "適度")@{rb++;}
                                            </td>
                                         </tr>
                                         <tr >
                                            <th style="width:15%;height:30px;">肢體末端溫度</th>
                                            <td>
                                                <input id ="rb_temperature"  type="hidden" value="@TEMPERATURE"  name="TEMPERATURE"/>
                                                @Html.RadioButton("rb_temperature", "溫暖", new { id = "rb" + @rb, onclick = "" })
                                                @Html.Label("rb" + @rb, "溫暖")@{rb++;}
                                                @Html.RadioButton("rb_temperature", "冰冷", new { id = "rb" + @rb, onclick = "" })
                                                @Html.Label("rb" + @rb, "冰冷")@{rb++;}
                                            </td>
                                        </tr>
                                        <tr >
                                            <th style="width:15%;height:30px;">顏色</th>
                                            <td>
                                                <input id ="rb_colour"  type="hidden" value="@COLOUR"  name="COLOUR"/>
                                                @Html.RadioButton("rb_colour", "紅潤", new { id = "rb" + @rb, onclick = "" })
                                                @Html.Label("rb" + @rb, "紅潤")@{rb++;}
                                                @Html.RadioButton("rb_colour", "發紺", new { id = "rb" + @rb, onclick = "" })
                                                @Html.Label("rb" + @rb, "發紺")@{rb++;}
                                            </td>
                                        </tr>
                                        <tr >
                                            <th style="width:15%;height:30px;">皮膚完整性</th>
                                            <td>
                                                <input id ="ck_integrity"  type="hidden" value="@INTEGRITY"  name="INTEGRITY"/>
                                                @*@Html.RadioButton("rb_integrity", "腫脹", new { id = "rb" + @rb, onclick = "" })
                                                @Html.Label("rb" + @rb, "腫脹")@{rb++;}
                                                @Html.RadioButton("rb_integrity", "水泡", new { id = "rb" + @rb, onclick = "" })
                                                @Html.Label("rb" + @rb, "水泡")@{rb++;}
                                                @Html.RadioButton("rb_integrity", "破皮", new { id = "rb" + @rb, onclick = "" })
                                                @Html.Label("rb" + @rb, "破皮")@{rb++;}
                                                @Html.RadioButton("rb_integrity", "正常", new { id = "rb" + @rb, onclick = "" })
                                                @Html.Label("rb" + @rb, "正常")@{rb++;}*@
                                                <!--2016 12 05 將約束的皮膚完整性、約束方式 ，兩項 改成複選 ， 註解部分為原本未更動前 單選 的code  by jarvis edit-->

                                                 @{                    
                                             if(Integritydt != null && Integritydt.Rows.Count > 0)
                                                  {
                                                      for(int x = 0; x < Integritydt.Rows.Count; x++)
                                                      {
                                                        @Html.Raw("<input  id='ck" + ck + "' name='ck_integrity' type='checkbox' text='" + Integritydt.Rows[x]["P_VALUE"] + "' ")
                                                        @Html.Raw(" value='" + Integritydt.Rows[x]["P_VALUE"] + "' onclick=\"")
                                                        @Html.Raw("\"/>")
                                                        @Html.Raw("<label  for='ck" + ck + "'>" + Integritydt.Rows[x]["P_VALUE"] + "</label>")
                                                          ck++;
                                                      }
                                                      rblist++;
                                                  }
                                                    }
                                            </td>
                                        </tr>
                                        <tr >
                                            <th style="width:15%;height:30px;">感覺度</th>
                                            <td>
                                                <input id ="rb_feeling"  type="hidden" value="@FEELING"  name="FEELING"/>
                                                @Html.RadioButton("rb_feeling", "麻木", new { id = "rb" + @rb, onclick = "" })
                                                @Html.Label("rb" + @rb, "麻木")@{rb++;}
                                                @Html.RadioButton("rb_feeling", "刺痛", new { id = "rb" + @rb, onclick = "" })
                                                @Html.Label("rb" + @rb, "刺痛")@{rb++;}
                                                @Html.RadioButton("rb_feeling", "正常", new { id = "rb" + @rb, onclick = "" })
                                                @Html.Label("rb" + @rb, "正常")@{rb++;}
                                                @Html.RadioButton("rb_feeling", "無法評估", new { id = "rb" + @rb, onclick = "" })
                                                @Html.Label("rb" + @rb, "無法評估")@{rb++;}
                                            </td>
                                        </tr>
                                         <tr >
                                            <th style="width:15%;height:30px;">鬆除約束、翻身、肢體活動、清潔</th>
                                            <td>
                                                <input id ="rb_remove"  type="hidden" value="@REMOVE"  name="REMOVE"/>
                                                @Html.RadioButton("rb_remove", "是", new { id = "rb" + @rb, onclick = "" })
                                                @Html.Label("rb" + @rb, "是")@{rb++;}
                                                @Html.RadioButton("rb_remove", "否", new { id = "rb" + @rb, onclick = "" })
                                                @Html.Label("rb" + @rb, "否")@{rb++;}
                                            </td>
                                        </tr>
                                        <tr>
                                            <th style="width:15%;height:30px;">備註</th>
                                            <td>
                                               @Html.TextBox("txt10", "", new { id = "txt10", style = "width:150px;"})
                                            </td>
                                        </tr> 
                                         }
   
                                    </table>
                                </div>
                                }
                        </td>
                    </tr>
                </table>
            </div>
                </td>
            </tr>
        </table>
    </div>
</form>
    </div>

<script>
    $(function () {
        $(".voiceHistory").on("click", function () {
            $("#voiceBtnId").val($(this).attr("voiceHistoryId"));
            var popData = {
                url: $(this).attr("title"),
                width: 700,
                height: 700  
            };           

            popWindow(popData);
            
        });

        function popWindow(data)
        {
            new_window.push(
                window.open(
                    data.url + '?source=AssessNew',
                    'top_dialog',
                    'menubar=no,status=no,scrollbars=yes,top=0,left=200,resizable=yes,toolbar=no,width=' + data.width + ',height=' + data.height
                )
            );
        }
    });


</script>
