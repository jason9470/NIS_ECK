@using NIS.Data;
@using NIS.Models;
@{
    Layout = "~/Views/Layout/FormLayout.cshtml";
}
<link rel="Stylesheet" type="text/css" href="~/Content/StyleSheet/naStyle.css" />
<script type="text/javascript">

    // 格行換色
    function setColor() {
        $('.dataHeader th').css('background', '#85A5CC');
        $('.dataArea tr:odd, #new_tag tr:even').css('background', '#ABC8E2');
        $('.dataArea tr:even, #new_tag tr:odd').css('background', '#E1E6FA');
    }

    function setDataAreaSize() {
        var height = $(document).height() - 170;
        if (height <= 420)
            height = 420;
        $(".dataArea").height(height);
    }

    $(document).ready(function () {

        // 新增標籤視窗
        $("#but_add_naitem").click(function () {    
            var top = $(this).position().top + $(this).height() + 10;
            var left = $(this).position().left;
            $("#new_tag").css({
                "top": top,
                "left": left
            });

            if (!$("#new_tag").is(":visible")) {
                $('#new_tag').slideDown(500);
                $(this).val("關閉新增").css("background-color", "#FFFFCC");
            } else {
                $('#new_tag').slideUp(500);
                $(this).val("新增評估單").css("background-color", "");
            }
        });

        // 新增標籤按鈕
        $("#but_inc_item").click(function () {
            var dataStr = "na_cate=" + encodeURIComponent($("select[name=inc_na_cate]").val());
            dataStr += "&na_name=" + encodeURIComponent($("input[name=inc_na_name]").val());
            dataStr += "&na_type=" + encodeURIComponent($("input[name=inc_na_type]").val());
            dataStr += "&na_sort=" + encodeURIComponent($("input[name=inc_na_sort]").val());
            $.ajax({
                url: '../Function/Na_Item_Add',
                type: 'post',
                data: dataStr,
                success: function (data) {
                    if (data == "Y") {
                        location.reload(true);
                    } else {
                        showHint("新增失敗");
                    }
                }
            });
        });

        //tooltip
        $(".tooltip").tooltip({
            content: function () { return $(this).attr('title'); }
        });

        setColor();
        $(window).resize(function () { setDataAreaSize(); }).trigger('resize');

        @if (Request["message"] != null) {
            @Html.Raw("showHint(\""+ Request["message"] +"\");")
        }
        @{  
            List<NursingAssessmentItem> item_info = (List<NursingAssessmentItem>)ViewData["item_info"];
        }
    });
</script>

<form name="na_item_form" method="post" action="Na_Item_Save">
    <p>
        <input type="button" value="返回" onclick="location.href='../Function/Na_Index'" />
        <input type="button" id="but_add_naitem" value="新增評估單" />
        <input type="button" id="but_save" value="儲存" onclick="$('form[name=na_item_form]').submit();"/>
        <a href="javascript:void(0);" class="tooltip"
                title="<font color='red'>注意：一次僅能新增一個版本</font><br />儲存：儲存後將會已最新版本列為正式版本<br/>">操作說明
        </a>
    </p>
    <div class="dataHeader">
        <table border="0" cellpadding="4" cellspacing="1" width="100%">
            <tr>
                <th width="20%">評估單分類</th>
                <th width="50%">評估單名稱</th>
                <th width="20%">評估單代碼</th>
                <th width="10%">排序</th>
            </tr>
        </table>
    </div>
    <div class="dataArea">
        <table border="0" cellpadding="4" cellspacing="1" width="100%">
            @for (int i = 0; i <= item_info.Count-1; i++)
            { 
                <tr>
                    <td width="20%">
                        @Html.DropDownList( item_info[i].na_type + "_na_cate", new SelectList((Dictionary<string, string>)ViewData["na_cate_list"], "Value", "Key", item_info[i].na_cate), new { @style="width:90%;"})
                    </td>
                    <td width="50%">
                        <input type="text" name="@(item_info[i].na_type)_na_name" value="@(item_info[i].na_name)" maxlength="50" />
                    </td>
                    <td width="20%">
                        <input type="text" name="na_type" value="@(item_info[i].na_type)" maxlength="2" />
                    </td>
                    <td width="10%">
                        <input type="text" name="@(item_info[i].na_type)_na_sort" value="@(item_info[i].na_sort.ToString())" maxlength="3" />
                    </td>
                </tr>
            }
        </table>
    </div>
</form>

<div id="new_tag">
    <p>
        <input type="button" name="but_inc_item" id="but_inc_item" value="新增評估單" />
        <a class="tooltip" href="javascript:void(0);" title="新增護理評估單評估單">說明</a>
    </p>
    <table border="0" cellpadding="4" cellspacing="1">
        <tr>
            <td width="100">評估單分類</td>
            <td align="left">
                @Html.DropDownList( "inc_na_cate", new SelectList((Dictionary<string, string>)ViewData["na_cate_list"], "Value", "Key"))
            </td>
        </tr>
        <tr>
            <td>評估單名稱</td>
            <td align="left">
                <input type="text" name="inc_na_name" style="width: 250px;"/>
            </td>
        </tr>
        <tr>
            <td>評估單代碼</td>
            <td align="left">
                <input type="text" name="inc_na_type" /></td>
            </td>
        </tr>
        <tr>
            <td>排序</td>
            <td align="left">
                <input type="text" name="inc_na_sort" /></td>
            </td>
        </tr>
    </table>
</div>