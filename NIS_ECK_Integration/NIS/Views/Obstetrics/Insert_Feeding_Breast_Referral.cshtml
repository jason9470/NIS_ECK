@using System.Data;
@{
    ViewBag.Title = "";
    Layout = "~/Views/Layout/FormLayout.cshtml";
    DataTable dthis = ViewBag.dthis;
    DataRow Row = null;
    if (dthis != null && dthis.Rows.Count > 0)
    {
        Row = dthis.Rows[0];
    }

    DataTable dtsta = ViewBag.dtsta;
    DataRow RowSta = null;
    if (dtsta != null && dtsta.Rows.Count > 0)
    {
        RowSta = dtsta.Rows[0];
    }

    DataTable dtnb = ViewBag.dtnb;
}
<link href="~/Content/StyleSheet/BabySystem.css" rel="stylesheet" />
<script type="text/javascript">
    $(function () {
        close_pup_window();
        //設定高度
        $(window).resize(function () {
            window.opener.parent.check_session();
            var height = $(this).outerHeight();
            if (height <= 300)
                height = 450;
            $(".dataArea").outerHeight(height - 60);
        }).trigger("resize");
        setGridColor();
    });

    //格行換色
    function setGridColor() {
        var tr = $('.dataArea tr');
        var color = '#ABC8E2';
        for (var i = 0; i < tr.length; i++) {
            if ($(tr[i]).css('display') != 'none') {
                $(tr[i]).css('background', color);
                if (color == '#ABC8E2')
                    color = '#E1E6FA';
                else
                    color = '#ABC8E2';
            }
        }
        $('.head').css('background', '#85A5CC');
    }

    //驗證欄位_數字
    function numcheck(obj) {
        if (obj.value.indexOf('.') > -1) {
            var re = /^[0-9]+\.[0-9]*$/;
        }
        else {
            var re = /^[0-9]+$/;
        }
        if (!re.test(obj.value) && obj.value != "") {
            $(obj).val('');
            alert("只能輸入數字");
        }
    }

    function div_hidden(id_list) {
        var list = id_list.split(',');
        for (var i = 0; i < list.length; i++) {
            $('#' + list[i]).fadeOut(0);
            var input_list = $('#' + list[i] + ' input');
            for (var j = 0; j < input_list.length; j++) {
                if (input_list[j].type == 'text')
                    $(input_list[j]).val('');
                if (input_list[j].type == 'radio')
                    document.getElementById(input_list[j].id).checked = false;
            }
        }
    }

    function unable(id_list) {
        var list = id_list.split(',');
        for (var i = 0; i < list.length; i++) {
            document.getElementById(list[i]).disabled = true;
            document.getElementById(list[i]).checked = false;
        }
    }

    function able(id_list) {
        var list = id_list.split(',');
        for (var i = 0; i < list.length; i++) {
            document.getElementById(list[i]).disabled = false;
        }
    }

    function set_for_rb(rb_name, dvalue) {
        if (dvalue != 'undefined') {
            var rb = document.getElementsByName(rb_name);
            for (var i = 0; i < rb.length; i++) {
                if (rb[i].value == dvalue)
                    $(rb[i]).click();
            }
        }
    }

    function set_for_ck(ck_name, val) {
        if (val != '') {
            var default_val = val.split(",");
            var ck = document.getElementsByName(ck_name);
            for (var i = 0; i < default_val.length; i++) {
                for (var j = 0; j < ck.length; j++) {
                    if (default_val[i] == ck[j].value)
                        $(ck[j]).click();
                }
            }
        }
    }

    function get_employee_name(obj, name) {
        var userno = $(obj).attr('id')
        $.ajax({
            url: "Get_Employee_Name",
            type: "GET",
            data: { userno: document.getElementById(userno).value },
            success: function (data, textStatus, jqXHR) {
                var userNameId = userno.replace("TXT_" + name, "LB_" + name);
                if (data == "") {
                    alert("查無此員工編號!");
                    $("#" + userNameId).html('請輸入員工編號');
                }
                else {
                    $("#" + userNameId).html(data);
                }
            },
            error: function (err) {
            },
            dataType: 'text'
        });
    }
</script>
@using System.Data;
@using System.Web.Mvc.Html;
@{
    DataTable dt = ViewBag.dt;
    DataTable dtbtnb = ViewBag.dtbtnb;
    string Addr = ViewBag.Addr;
    string epds = ViewBag.epds;
    string weight = ViewBag.Weight;
}
@if (dt == null || dt.Rows.Count == 0)
{
    <div class="funcArea">
        <form action="Insert_Feeding_Breast_Referral" method="post">
            <table border="0" cellpadding="0" cellspacing="0" style="width:100%; font-size:12px;">
                <tr>
                    <td style="padding-bottom:5px;text-align:center;">
                        <span style="color:blue;font-size:26px;">哺餵母乳轉介</span>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div class="dataArea">
                            <input type="hidden" name="NB_COUNT" value="@dtnb.Rows.Count" />
                            <table border="0" cellpadding="4" cellspacing="1" style="width:100%">
                                <tr>
                                    <td colspan="1" class="head">轉介日期</td>
                                    <td colspan="3">
                                        @Html.TextBox("TXT_REF_DATE_DAY", DateTime.Now.ToString("yyyy/MM/dd"), new { style = "width:80px", @readonly = "readonly" })
                                        @Html.TextBox("TXT_REF_DATE_TIME", DateTime.Now.ToString("HH:mm"), new { style = "width:50px", @readonly = "readonly" })
                                        @WebTool.setDateTime("TXT_REF_DATE_DAY", "TXT_REF_DATE_TIME", "", "30")
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="4" class="head">產婦資料</td>
                                </tr>
                                <tr>
                                    <td style="width:15%" class="head">姓名</td>
                                    <td style="width:35%">
                                        @Html.TextBox("TXT_NAME", Row == null ? "" : Row["PAT_NAME"], new { style = "width:100px" })
                                    </td>
                                    <td style="width:15%" class="head">年齡</td>
                                    <td style="width:35%">
                                        @Html.TextBox("TXT_AGE", Row == null ? "" : (Convert.ToInt32(DateTime.Now.ToString("yyyy")) - Convert.ToInt32(Convert.ToDateTime(Row["PAT_BIRTH"]).ToString("yyyy"))).ToString(), new { style = "width:100px" })
                                    </td>
                                </tr>
                                <tr>
                                    <td class="head">教育程度</td>
                                    @if (Row == null)
                                    {
                                        <td>
                                            @Html.TextBox("TXT_EDU", "", new { style = "width:100px" })
                                        </td>
                                    }
                                    else
                                    {
                                        if (Row["PAT_EDU"].ToString() == "0")
                                        {
                                            <td>
                                                @Html.TextBox("TXT_EDU", "不識字", new { style = "width:100px" })
                                            </td>
                                        }
                                        else if (Row["PAT_EDU"].ToString() == "1")
                                        {
                                            <td>
                                                @Html.TextBox("TXT_EDU", "國小", new { style = "width:100px" })
                                            </td>
                                        }
                                        else if (Row["PAT_EDU"].ToString() == "2")
                                        {
                                            <td>
                                                @Html.TextBox("TXT_EDU", "國中", new { style = "width:100px" })
                                            </td>
                                        }
                                        else if (Row["PAT_EDU"].ToString() == "3")
                                        {
                                            <td>
                                                @Html.TextBox("TXT_EDU", "高中", new { style = "width:100px" })
                                            </td>
                                        }
                                        else if (Row["PAT_EDU"].ToString() == "4")
                                        {
                                            <td>
                                                @Html.TextBox("TXT_EDU", "大專以上", new { style = "width:100px" })
                                            </td>
                                        }
                                        else if (Row["PAT_EDU"].ToString() == "5")
                                        {
                                            <td>
                                                @Html.TextBox("TXT_EDU", "不詳", new { style = "width:100px" })
                                            </td>
                                        }
                                        else
                                        {
                                            <td>
                                                @Html.TextBox("TXT_EDU", "", new { style = "width:100px" })
                                            </td>
                                        }
                                    }
                                    <td class="head">電話</td>
                                    <td>
                                        @Html.TextBox("TXT_TEL", Row == null ? "" : Row["PAT_TEL"], new { style = "width:100px" })
                                    </td>
                                </tr>
                                <tr>
                                    <td class="head">籍貫</td>
                                    <td>
                                        @Html.TextBox("TXT_BP", Row == null ? "" : Row["PAT_NAT"], new { style = "width:100px" })
                                    </td>
                                    <td class="head">婚姻</td>
                                    <td>
                                        <input type="radio" name="RB_MAR" value="0" />已婚
                                        <input type="radio" name="RB_MAR" value="1" />未婚
                                        <input type="radio" name="RB_MAR" value="2" />不明
                                    </td>
                                </tr>
                                <tr>
                                    <td class="head">週數</td>
                                    <td>
                                        @Html.TextBox("TXT_GEST_M", Row == null ? "" : Row["GA_W"], new { style = "width:100px" })
                                    </td>
                                    <td class="head">胎次</td>
                                    <td>
                                        @Html.TextBox("TXT_P", RowSta == null ? "" : RowSta["PARITY_N"], new { style = "width:100px", onchange = "numcheck(this);" })
                                    </td>
                                </tr>
                                <tr>
                                    <td class="head">地址</td>
                                    <td colspan="3">
                                        @Html.TextBox("TXT_ADDR", Addr, new { style = "width:500px" })
                                    </td>
                                </tr>
                                <tr>
                                    <td class="head">產婦狀態</td>
                                    <td colspan="3">
                                        <input type="checkbox" name="CK_PAT_STA" value="0" />正常
                                        <input type="checkbox" name="CK_PAT_STA" value="1" />PPH
                                        <input type="checkbox" name="CK_PAT_STA" value="2" />PIH
                                        <input type="checkbox" name="CK_PAT_STA" value="3" />乳腺炎
                                        <input type="checkbox" name="CK_PAT_STA" value="4" />傷口感染
                                        <input type="checkbox" name="CK_PAT_STA" value="5" onclick="$('.PAT_STA_BL').fadeToggle()" />產後憂鬱症
                                        <span class="PAT_STA_BL" style="display:none">
                                            ，愛丁堡產後憂鬱症評估分數 @Html.TextBox("TXT_PAT_STA_BL", epds, new { style = "width:100px" })
                                        </span>

                                        <input type="checkbox" name="CK_PAT_STA" value="6" />TB
                                        <input type="checkbox" name="CK_PAT_STA" value="7" onclick="$('.PAT_STA_OTH').fadeToggle()" />其他
                                        <span class="PAT_STA_OTH" style="display:none">
                                            ，@Html.TextBox("TXT_PAT_STA_OTH", "", new { style = "width:100px" })
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="head">職業婦女</td>
                                    <td colspan="3">
                                        <input type="radio" name="RB_CW" value="0" />否
                                        <input type="radio" name="RB_CW" value="1" />是
                                    </td>
                                </tr>
                                @if (dtnb != null && dtnb.Rows.Count > 0)
                                {
                                    foreach (DataRow nb in dtnb.Rows)
                                    {
                                        var seq = nb["NB_TEMPNO"].ToString().Replace(nb["FEENO"].ToString(), "");
                                        var result = seq + "," + nb["NB_CHARTNO"];
                                        <tr>
                                            <td class="head">新生兒 @seq 資料</td>
                                            <td colspan="3">
                                                <input type="hidden" name="TXT_SQ_OF_NB" value="@seq" />@result
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="head">生產日期/時間</td>
                                            <td>
                                                @if (nb["BIRTH_DAY"].ToString() != "")
                                                {
                                                    @Html.TextBox("TXT_BIRTH_DAY" + seq, Convert.ToDateTime(nb["BIRTH_DAY"].ToString()).ToString("yyyy/MM/dd"), new { style = "width:80px", @readonly = "readonly" })
                                                    @Html.TextBox("TXT_BIRTH_TIME" + seq, Convert.ToDateTime(nb["BIRTH_DAY"].ToString()).ToString("HH:mm"), new { style = "width:50px", @readonly = "readonly" })
                                                }
                                                else
                                                {
                                                    @Html.TextBox("TXT_BIRTH_DAY" + seq, "", new { style = "width:80px", @readonly = "readonly" })
                                                    @Html.TextBox("TXT_BIRTH_TIME" + seq, "", new { style = "width:50px", @readonly = "readonly" })
                                                }
                                            </td>
                                            <td class="head">生產方式</td>
                                            <td>
                                                @if (nb["BIRTH_TYPE"].ToString() == "0")
                                                {
                                                    @Html.TextBox("TXT_BIRTH_TYPE" + seq, "NSD", new { style = "width:100px", @readonly = "readonly" })
                                                }
                                                else if (nb["BIRTH_TYPE"].ToString() == "1")
                                                {
                                                    @Html.TextBox("TXT_BIRTH_TYPE" + seq, "C/S", new { style = "width:100px", @readonly = "readonly" })
                                                }
                                                else
                                                {
                                                    @Html.TextBox("TXT_BIRTH_TYPE" + seq, "", new { style = "width:100px", @readonly = "readonly" })
                                                }
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="head">性別</td>
                                            <td>
                                                @Html.TextBox("TXT_GENDER" + seq, nb["GENDER_PF"], new { style = "width:100px", @readonly = "readonly" })
                                            </td>
                                            <td class="head">目前年齡</td>
                                            <td>
                                                @Html.TextBox("TXT_AGE_N" + seq, nb["AGE_N"], new { style = "width:100px", @readonly = "readonly" }) 天
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="head">出生體重</td>
                                            <td>
                                                @Html.TextBox("TXT_WEIGHT_BIRTH" + seq, nb["WEIGHT_BIRTH"], new { style = "width:150px", @readonly = "readonly" })
                                            </td>
                                            <td class="head">現在體重</td>
                                            <td>
                                                @Html.TextBox("TXT_WEIGHT_N" + seq, nb["WEIGHT_NOW"], new { style = "width:100px" })
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="head">新生兒狀態</td>
                                            <td colspan="3">
                                                <input type="checkbox" name="CK_NB_STA@(seq)" value="0" />正常
                                                <input type="checkbox" name="CK_NB_STA@(seq)" value="1" />早產
                                                <input type="checkbox" name="CK_NB_STA@(seq)" value="2" />黃疸 ≧ 17gm/dl
                                                <input type="checkbox" name="CK_NB_STA@(seq)" value="3" />先天性心臟病
                                                <input type="checkbox" name="CK_NB_STA@(seq)" value="4" />RDS
                                                <input type="checkbox" name="CK_NB_STA@(seq)" value="5" />TTNB
                                                <input type="checkbox" name="CK_NB_STA@(seq)" value="6" />急性脫水
                                                <input type="checkbox" name="CK_NB_STA@(seq)" value="7" />低血糖
                                                <input type="checkbox" name="CK_NB_STA@(seq)" value="8" />兔唇
                                                <input type="checkbox" name="CK_NB_STA@(seq)" value="9" />顎裂
                                                <input type="checkbox" name="CK_NB_STA@(seq)" value="10" />雙胞胎
                                                <input type="checkbox" name="CK_NB_STA@(seq)" value="11" />多胞胎
                                                <input type="checkbox" name="CK_NB_STA@(seq)" value="12" onclick="$('.NB_STA_OTH' + '@seq').fadeToggle()" />其他
                                                <span class="NB_STA_OTH@(seq)" style="display:none">
                                                    ，@Html.TextBox("TXT_NB_STA_OTH" + seq, "", new { style = "width:100px" })
                                                </span>
                                            </td>
                                        </tr>
                                    }
                                }
                                <tr>
                                    <td class="head">哺餵方式</td>
                                    <td>
                                        <input type="radio" name="RB_BREED" value="0" />純母乳
                                        <input type="radio" name="RB_BREED" value="1" />混合乳
                                        <input type="radio" name="RB_BREED" value="2" />配方乳
                                    </td>
                                    <td class="head">哺餵習慣</td>
                                    <td>
                                        <input type="radio" name="RB_BREED_H" value="0" />想吃就餵
                                        <input type="radio" name="RB_BREED_H" value="1" />固定時間
                                    </td>
                                </tr>
                                <tr>
                                    <td class="head">追蹤事項</td>
                                    <td colspan="3">
                                        <input type="checkbox" name="CK_TRACE" value="0" />母乳哺育重要性的加強
                                        <input type="checkbox" name="CK_TRACE" value="1" />哺餵母乳的技巧
                                        <input type="checkbox" name="CK_TRACE" value="2" />哺餵母乳的心理支持
                                        <input type="checkbox" name="CK_TRACE" value="3" />母乳哺餵母親的營養需求
                                        <input type="checkbox" name="CK_TRACE" value="4" onclick="$('.TRACE_OTH').fadeToggle()" />其他
                                        <span class="TRACE_OTH" style="display:none">
                                            ，@Html.TextBox("TXT_TRACE_OTH", "", new { style = "width:100px" })
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="head">轉介原因</td>
                                    <td colspan="3">
                                        <input type="checkbox" name="CK_REF" value="0" />乳頭酸痛
                                        <input type="checkbox" name="CK_REF" value="1" />乳頭龜裂
                                        <input type="checkbox" name="CK_REF" value="2" />乳頭破皮
                                        <input type="checkbox" name="CK_REF" value="3" />乳腺炎
                                        <input type="checkbox" name="CK_REF" value="4" />產婦缺乏哺餵母乳動機
                                        <input type="checkbox" name="CK_REF" value="5" />(產婦哺乳技巧不熟練，須加強協助)
                                        <input type="checkbox" name="CK_REF" value="6" />寶寶吸奶姿勢不良
                                        <input type="checkbox" name="CK_REF" value="7" />寶寶吸吮力較弱
                                        <input type="checkbox" name="CK_REF" value="8" />奶水分泌不足
                                        <input type="checkbox" name="CK_REF" value="9" />先生不支持
                                        <input type="checkbox" name="CK_REF" value="10" />家人不支持
                                        <input type="checkbox" name="CK_REF" value="11" onclick="$('.REF_OTH').fadeToggle()" />其他
                                        <span class="REF_OTH" style="display:none">
                                            ，@Html.TextBox("TXT_REF_OTH", "", new { style = "width:100px" })
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="head">申請紀錄者</td>
                                    <td colspan="3">
                                        @Html.TextBox("TXT_APPLYNO", "", new { style = "width:100px", onchange = "get_employee_name(this,'APPLYNO');" })
                                        @Html.Label("LB_APPLYNO", "請輸入員工編號", new { id = "LB_APPLYNO", style = "width:100px" })
                                    </td>
                                </tr>
                                <tr>
                                    <td class="head" colspan="4">母乳個案轉介回覆單</td>
                                </tr>
                                <tr>
                                    <td class="head">回覆日期</td>
                                    <td>
                                        @Html.TextBox("TXT_REPLY_DATE_DAY", "", new { style = "width:80px", @readonly = "readonly" })
                                        @*@WebTool.setDateTime("TXT_REPLY_DATE_DAY", "", "", "", "30")*@
                                        @WebTool.setDateTime("TXT_REPLY_DATE_DAY", "", "", "", "")     @*modified by chih,20200824*@
                                    </td>
                                    <td class="head">受轉介單位名稱</td>
                                    <td>
                                        @Html.TextBox("TXT_REF_ORG", "", new { style = "width:100px" })
                                    </td>
                                </tr>
                                <tr>
                                    <td class="head">傳真</td>
                                    <td>
                                        @Html.TextBox("TXT_REF_FAX", "", new { style = "width:100px" })
                                    </td>

                                    <td class="head">回覆承辦人姓名</td>
                                    <td colspan="3">
                                        @Html.TextBox("TXT_REF_NAME", "", new { style = "width:100px" })
                                    </td>
                                </tr>
                                <tr>
                                    <td class="head">連絡電話</td>
                                    <td colspan="3">
                                        @Html.TextBox("TXT_REF_TEL", "", new { style = "width:100px" })
                                    </td>
                                </tr>
                                <tr>
                                    <td class="head">處理方式</td>
                                    <td colspan="3">
                                        <input type="checkbox" name="CK_REF_WAY" value="0" />電話訪視
                                        <input type="checkbox" name="CK_REF_WAY" value="1" />家訪
                                        <input type="checkbox" name="CK_REF_WAY" value="2" />提供宣導資料
                                        <input type="checkbox" name="CK_REF_WAY" value="3" />邀請參加支持團體
                                        <input type="checkbox" name="CK_REF_WAY" value="4" onclick="$('.REF_WAY_OTH').fadeToggle()" />其他
                                        <span class="REF_WAY_OTH" style="display:none">
                                            ，@Html.TextBox("TXT_REF_WAY_OTH", "", new { style = "width:100px" })
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="head">處理結果</td>
                                    <td colspan="3">
                                        @Html.TextBox("TXT_REF_RST", "", new { style = "width:500px" })
                                    </td>
                                </tr>
                                <tr>
                                    <td class="head">回覆紀錄者</td>
                                    <td colspan="3">
                                        @Html.TextBox("TXT_REPLYNO", "", new { style = "width:100px", onchange = "get_employee_name(this,'REPLYNO');" })
                                        @Html.Label("LB_REPLYNO", "請輸入員工編號", new { id = "LB_REPLYNO", style = "width:100px" })
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="4" style="color:red">
                                        *轉介單位請將本轉介單傳真至 產婦戶籍地所在衛生所
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </td>
                </tr>
            </table>
            <div style="text-align:center;">
                <input type="submit" value="確定" />
                <input type="button" value="取消" onclick="if (confirm('確認取消?')) window.close();" />
            </div>
        </form>
    </div>
}
else
{
    foreach (DataRow r in dt.Rows)
    {
        <div class="funcArea">
            <form action="Upd_Feeding_Breast_Referral" method="post">
                <table border="0" cellpadding="0" cellspacing="0" style="width:100%; font-size:12px;">
                    <tr>
                        <td style="padding-bottom:5px;text-align:center;">
                            <span style="color:blue;font-size:26px;">哺餵母乳轉介</span>
                            <input type="hidden" name="IID" value="@r["IID"]" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="dataArea">
                                <input name="NB_COUNT" value="@dtnb.Rows.Count" type="hidden" />
                                <table border="0" cellpadding="4" cellspacing="1" style="width:100%">
                                    <tr>
                                        <td colspan="1" class="head">轉介日期</td>
                                        <td colspan="3">
                                            @if (r["REF_DATE"].ToString() == null)
                                            {
                                                @Html.TextBox("TXT_REF_DATE_DAY" + r["IID"], "", new { style = "width:80px", @readonly = "readonly" })
                                                @Html.TextBox("TXT_REF_DATE_TIME" + r["IID"], "", new { style = "width:50px", @readonly = "readonly" })
                                            }
                                            else
                                            {
                                                @Html.TextBox("TXT_REF_DATE_DAY" + r["IID"], Convert.ToDateTime(r["REF_DATE"].ToString()).ToString("yyyy/MM/dd"), new { style = "width:80px", @readonly = "readonly" })
                                                @Html.TextBox("TXT_REF_DATE_TIME" + r["IID"], Convert.ToDateTime(r["REF_DATE"].ToString()).ToString("HH:mm"), new { style = "width:50px", @readonly = "readonly" })
                                            }
                                            @WebTool.setDateTime("TXT_REF_DATE_DAY" + r["IID"], "TXT_REF_DATE_TIME" + r["IID"], "", "30")
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="4" class="head">產婦資料</td>
                                    </tr>
                                    <tr>
                                        <td style="width:15%" class="head">姓名</td>
                                        <td style="width:35%">
                                            @Html.TextBox("TXT_NAME" + r["IID"], r["NAME"], new { style = "width:100px" })
                                        </td>
                                        <td style="width:15%" class="head">年齡</td>
                                        <td style="width:35%">
                                            @Html.TextBox("TXT_AGE" + r["IID"], Row == null ? "" : (Convert.ToInt32(DateTime.Now.ToString("yyyy")) - Convert.ToInt32(Convert.ToDateTime(Row["PAT_BIRTH"]).ToString("yyyy"))).ToString(), new { style = "width:100px" })
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="head">教育程度</td>
                                        <td>
                                            @Html.TextBox("TXT_EDU" + r["IID"], r["EDU"], new { style = "width:100px" })
                                        </td>
                                        <td class="head">電話</td>
                                        <td>
                                            @Html.TextBox("TXT_TEL" + r["IID"], r["TEL"], new { style = "width:100px" })
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="head">籍貫</td>
                                        <td>
                                            @Html.TextBox("TXT_BP" + r["IID"], r["BP"], new { style = "width:100px" })
                                        </td>
                                        <td class="head">婚姻</td>
                                        <td>
                                            <input type="radio" name="RB_MAR@(r["IID"])" value="0" />已婚
                                            <input type="radio" name="RB_MAR@(r["IID"])" value="1" />未婚
                                            <input type="radio" name="RB_MAR@(r["IID"])" value="2" />不明
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="head">週數</td>
                                        <td>
                                            @Html.TextBox("TXT_GEST_M" + r["IID"], r["GEST_M"], new { style = "width:100px" })
                                        </td>
                                        <td class="head">胎次</td>
                                        <td>
                                            @Html.TextBox("TXT_P" + r["IID"], r["P"], new { style = "width:100px", onchange = "numcheck(this);" })
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="head">地址</td>
                                        <td colspan="3">
                                            @Html.TextBox("TXT_ADDR" + r["IID"], r["ADDR"], new { style = "width:500px" })
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="head">產婦狀態</td>
                                        <td colspan="3">
                                            <input type="checkbox" name="CK_PAT_STA@(r["IID"])" value="0" />正常
                                            <input type="checkbox" name="CK_PAT_STA@(r["IID"])" value="1" />PPH
                                            <input type="checkbox" name="CK_PAT_STA@(r["IID"])" value="2" />PIH
                                            <input type="checkbox" name="CK_PAT_STA@(r["IID"])" value="3" />乳腺炎
                                            <input type="checkbox" name="CK_PAT_STA@(r["IID"])" value="4" />傷口感染
                                            <input type="checkbox" name="CK_PAT_STA@(r["IID"])" value="5" onclick="$('.PAT_STA_BL').fadeToggle()" />產後憂鬱症
                                            <span class="PAT_STA_BL" style="display:none">
                                                ，愛丁堡產後憂鬱症評估分數 @Html.TextBox("TXT_PAT_STA_BL" + r["IID"], r["PAT_STA_BL"], new { style = "width:100px" })
                                            </span>

                                            <input type="checkbox" name="CK_PAT_STA@(r["IID"])" value="6" />TB
                                            <input type="checkbox" name="CK_PAT_STA@(r["IID"])" value="7" onclick="$('.PAT_STA_OTH').fadeToggle()" />其他
                                            <span class="PAT_STA_OTH" style="display:none">
                                                ，@Html.TextBox("TXT_PAT_STA_OTH" + r["IID"], r["PAT_STA_OTH"], new { style = "width:100px" })
                                            </span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="head">職業婦女</td>
                                        <td colspan="3">
                                            <input type="radio" name="RB_CW@(r["IID"])" value="0" />否
                                            <input type="radio" name="RB_CW@(r["IID"])" value="1" />是
                                        </td>
                                    </tr>
                                    @if (dtnb != null && dtnb.Rows.Count > 0)
                                    {
                                        foreach (DataRow nb in dtnb.Rows)
                                        {
                                            var seq = nb["NB_TEMPNO"].ToString().Replace(nb["FEENO"].ToString(), "");
                                            var result = seq + "," + nb["NB_CHARTNO"];
                                            <tr>
                                                <td class="head">新生兒 @seq 資料</td>
                                                <td colspan="3">
                                                    <input type="hidden" name="TXT_SQ_OF_NB@(r["IID"])" value="@seq" />@result
                                                </td>
                                            </tr>
                                        }
                                    }
                                    @if (dtbtnb != null && dtbtnb.Rows.Count > 0)
                                    {
                                        foreach (DataRow btnb in dtbtnb.Rows)
                                        {
                                            <tr>
                                                <td class="head">生產日期/時間</td>
                                                <td>
                                                    @Html.TextBox("TXT_BIRTH_DAY" + r["IID"] + btnb["SQ_OF_NB"], Convert.ToDateTime(btnb["BIRTH"]).ToString("yyyy/MM/dd"), new { style = "width:80px", @readonly = "readonly" })
                                                    @Html.TextBox("TXT_BIRTH_TIME" + r["IID"] + btnb["SQ_OF_NB"], Convert.ToDateTime(btnb["BIRTH"]).ToString("HH:mm"), new { style = "width:50px", @readonly = "readonly" })
                                                </td>
                                                <td class="head">生產方式</td>
                                                <td>
                                                    @Html.TextBox("TXT_BIRTH_TYPE" + r["IID"] + btnb["SQ_OF_NB"], btnb["BIRTH_TYPE"], new { style = "width:100px", @readonly = "readonly" })
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="head">性別</td>
                                                <td>
                                                    @Html.TextBox("TXT_GENDER" + r["IID"] + btnb["SQ_OF_NB"], btnb["GENDER"], new { style = "width:100px", @readonly = "readonly" })
                                                </td>
                                                <td class="head">目前年齡</td>
                                                <td>
                                                    @Html.TextBox("TXT_AGE_N" + r["IID"] + btnb["SQ_OF_NB"], (DateTime.Now - Convert.ToDateTime(btnb["BIRTH"])).Days.ToString(), new { style = "width:100px", @readonly = "readonly" }) 天
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="head">出生體重</td>
                                                <td>
                                                    @Html.TextBox("TXT_WEIGHT_BIRTH" + r["IID"] + btnb["SQ_OF_NB"], btnb["WEIGHT_BIRTH"], new { style = "width:150px", @readonly = "readonly" })
                                                </td>
                                                <td class="head">現在體重</td>
                                                <td>
                                                    @Html.TextBox("TXT_WEIGHT_N" + r["IID"] + btnb["SQ_OF_NB"], btnb["WEIGHT_N"], new { style = "width:100px" })
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="head">新生兒狀態</td>
                                                <td colspan="3">
                                                    <input type="checkbox" name="CK_NB_STA@(r["IID"])@(btnb["SQ_OF_NB"])" value="0" />正常
                                                    <input type="checkbox" name="CK_NB_STA@(r["IID"])@(btnb["SQ_OF_NB"])" value="1" />早產
                                                    <input type="checkbox" name="CK_NB_STA@(r["IID"])@(btnb["SQ_OF_NB"])" value="2" />黃疸 ≧ 17gm/dl
                                                    <input type="checkbox" name="CK_NB_STA@(r["IID"])@(btnb["SQ_OF_NB"])" value="3" />先天性心臟病
                                                    <input type="checkbox" name="CK_NB_STA@(r["IID"])@(btnb["SQ_OF_NB"])" value="4" />RDS
                                                    <input type="checkbox" name="CK_NB_STA@(r["IID"])@(btnb["SQ_OF_NB"])" value="5" />TTNB
                                                    <input type="checkbox" name="CK_NB_STA@(r["IID"])@(btnb["SQ_OF_NB"])" value="6" />急性脫水
                                                    <input type="checkbox" name="CK_NB_STA@(r["IID"])@(btnb["SQ_OF_NB"])" value="7" />低血糖
                                                    <input type="checkbox" name="CK_NB_STA@(r["IID"])@(btnb["SQ_OF_NB"])" value="8" />兔唇
                                                    <input type="checkbox" name="CK_NB_STA@(r["IID"])@(btnb["SQ_OF_NB"])" value="9" />顎裂
                                                    <input type="checkbox" name="CK_NB_STA@(r["IID"])@(btnb["SQ_OF_NB"])" value="10" />雙胞胎
                                                    <input type="checkbox" name="CK_NB_STA@(r["IID"])@(btnb["SQ_OF_NB"])" value="11" />多胞胎
                                                    <input type="checkbox" name="CK_NB_STA@(r["IID"])@(btnb["SQ_OF_NB"])" value="12" onclick="$('.NB_STA_OTH' + '@btnb["SQ_OF_NB"]').fadeToggle()" />其他
                                                    <span class="NB_STA_OTH@(btnb["SQ_OF_NB"])" style="display:none">
                                                        ，@Html.TextBox("TXT_NB_STA_OTH" + r["IID"] + btnb["SQ_OF_NB"], btnb["NB_STA_OTH"], new { style = "width:100px" })
                                                    </span>
                                                    <script>
                                                        @if (btnb["NB_STA"].ToString() != "") {
                                                            var NB_STA = btnb["NB_STA"].ToString();
                                                            var NB_STAV = new List<string>();

                                                            for (var i = 0; i < NB_STA.ToString().Length; i++) {
                                                                if (NB_STA[i] == '1') {
                                                                    NB_STAV.Add(i.ToString());
                                                                }
                                                            }
                                                            @: set_for_ck('CK_NB_STA@(r["IID"])@(btnb["SQ_OF_NB"])', '@String.Join(",", NB_STAV)');
                                                        }
                                                    </script>
                                                </td>
                                            </tr>
                                        }
                                    }
                                    <tr>
                                        <td class="head">哺餵方式</td>
                                        <td>
                                            <input type="radio" name="RB_BREED@(r["IID"])" value="0" />純母乳
                                            <input type="radio" name="RB_BREED@(r["IID"])" value="1" />混合乳
                                            <input type="radio" name="RB_BREED@(r["IID"])" value="2" />配方乳
                                        </td>
                                        <td class="head">哺餵習慣</td>
                                        <td>
                                            <input type="radio" name="RB_BREED_H@(r["IID"])" value="0" />想吃就餵
                                            <input type="radio" name="RB_BREED_H@(r["IID"])" value="1" />固定時間
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="head">追蹤事項</td>
                                        <td colspan="3">
                                            <input type="checkbox" name="CK_TRACE@(r["IID"])" value="0" />母乳哺育重要性的加強
                                            <input type="checkbox" name="CK_TRACE@(r["IID"])" value="1" />哺餵母乳的技巧
                                            <input type="checkbox" name="CK_TRACE@(r["IID"])" value="2" />哺餵母乳的心理支持
                                            <input type="checkbox" name="CK_TRACE@(r["IID"])" value="3" />母乳哺餵母親的營養需求
                                            <input type="checkbox" name="CK_TRACE@(r["IID"])" value="4" onclick="$('.TRACE_OTH').fadeToggle()" />其他
                                            <span class="TRACE_OTH" style="display:none">
                                                ，@Html.TextBox("TXT_TRACE_OTH" + r["IID"], r["TRACE_OTH"], new { style = "width:100px" })
                                            </span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="head">轉介原因</td>
                                        <td colspan="3">
                                            <input type="checkbox" name="CK_REF@(r["IID"])" value="0" />乳頭酸痛
                                            <input type="checkbox" name="CK_REF@(r["IID"])" value="1" />乳頭龜裂
                                            <input type="checkbox" name="CK_REF@(r["IID"])" value="2" />乳頭破皮
                                            <input type="checkbox" name="CK_REF@(r["IID"])" value="3" />乳腺炎
                                            <input type="checkbox" name="CK_REF@(r["IID"])" value="4" />產婦缺乏哺餵母乳動機
                                            <input type="checkbox" name="CK_REF@(r["IID"])" value="5" />(產婦哺乳技巧不熟練，須加強協助)
                                            <input type="checkbox" name="CK_REF@(r["IID"])" value="6" />寶寶吸奶姿勢不良
                                            <input type="checkbox" name="CK_REF@(r["IID"])" value="7" />寶寶吸吮力較弱
                                            <input type="checkbox" name="CK_REF@(r["IID"])" value="8" />奶水分泌不足
                                            <input type="checkbox" name="CK_REF@(r["IID"])" value="9" />先生不支持
                                            <input type="checkbox" name="CK_REF@(r["IID"])" value="10" />家人不支持
                                            <input type="checkbox" name="CK_REF@(r["IID"])" value="11" onclick="$('.REF_OTH').fadeToggle()" />其他
                                            <span class="REF_OTH" style="display:none">
                                                ，@Html.TextBox("TXT_REF_OTH" + r["IID"], r["REF_OTH"], new { style = "width:100px" })
                                            </span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="head">申請紀錄者</td>
                                        <td colspan="3">
                                            @Html.TextBox("TXT_APPLYNO" + r["IID"], r["APPLYNO"], new { style = "width:100px", onchange = "get_employee_name(this,'APPLYNO');" })
                                            @if (r["APPLYNO_NAME"].ToString() != "")
                                            {
                                                @Html.Label("LB_APPLYNO" + r["IID"], r["APPLYNO_NAME"].ToString(), new { id = "LB_APPLYNO" + r["IID"], style = "width:100px" })
                                            }
                                            else
                                            {
                                                @Html.Label("LB_APPLYNO" + r["IID"], "請輸入員工編號", new { id = "LB_APPLYNO" + r["IID"], style = "width:100px" })
                                            }
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="head" colspan="4">母乳個案轉介回覆單</td>
                                    </tr>
                                    <tr>
                                        <td class="head">回覆日期</td>
                                        <td>
                                            @if (r["REPLY_DATE"].ToString() != "")
                                            {
                                                @Html.TextBox("TXT_REPLY_DATE_DAY" + r["IID"], Convert.ToDateTime(r["REPLY_DATE"]).ToString("yyyy/MM/dd"), new { style = "width:80px", @readonly = "readonly" })
                                            }
                                            else
                                            {
                                                @Html.TextBox("TXT_REPLY_DATE_DAY" + r["IID"], "", new { style = "width:80px", @readonly = "readonly" })
                                            }
                                            @*@WebTool.setDateTime("TXT_REPLY_DATE_DAY" + r["IID"], "", "", "", "30")*@                                            
                                            @WebTool.setDateTime("TXT_REPLY_DATE_DAY" + r["IID"], "", "", "", "")     @*modified by chih,20201210*@
                                        </td>
                                        <td class="head">受轉介單位名稱</td>
                                        <td>
                                            @Html.TextBox("TXT_REF_ORG" + r["IID"], r["REF_ORG"], new { style = "width:100px" })
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="head">傳真</td>
                                        <td>
                                            @Html.TextBox("TXT_REF_FAX" + r["IID"], r["REF_FAX"], new { style = "width:100px" })
                                        </td>

                                        <td class="head">回覆承辦人姓名</td>
                                        <td colspan="3">
                                            @Html.TextBox("TXT_REF_NAME" + r["IID"], r["REF_NAME"], new { style = "width:100px" })
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="head">連絡電話</td>
                                        <td colspan="3">
                                            @Html.TextBox("TXT_REF_TEL" + r["IID"], r["REF_TEL"], new { style = "width:100px" })
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="head">處理方式</td>
                                        <td colspan="3">
                                            <input type="checkbox" name="CK_REF_WAY@(r["IID"])" value="0" />電話訪視
                                            <input type="checkbox" name="CK_REF_WAY@(r["IID"])" value="1" />家訪
                                            <input type="checkbox" name="CK_REF_WAY@(r["IID"])" value="2" />提供宣導資料
                                            <input type="checkbox" name="CK_REF_WAY@(r["IID"])" value="3" />邀請參加支持團體
                                            <input type="checkbox" name="CK_REF_WAY@(r["IID"])" value="4" onclick="$('.REF_WAY_OTH').fadeToggle()" />其他
                                            <span class="REF_WAY_OTH" style="display:none">
                                                ，@Html.TextBox("TXT_REF_WAY_OTH" + r["IID"], r["REF_WAY_OTH"], new { style = "width:100px" })
                                            </span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="head">處理結果</td>
                                        <td colspan="3">
                                            @Html.TextBox("TXT_REF_RST" + r["IID"], r["REF_RST"], new { style = "width:500px" })
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="head">回覆紀錄者</td>
                                        <td colspan="3">
                                            @Html.TextBox("TXT_REPLYNO" + r["IID"], r["REPLYNO"], new { style = "width:100px", onchange = "get_employee_name(this,'REPLYNO');" })
                                            @if (r["REPLYNO_NAME"].ToString() != "")
                                            {
                                                @Html.Label("LB_REPLYNO" + r["IID"], r["REPLYNO_NAME"].ToString(), new { id = "LB_REPLYNO" + r["IID"], style = "width:100px" })
                                            }
                                            else
                                            {
                                                @Html.Label("LB_REPLYNO" + r["IID"], "請輸入員工編號", new { id = "LB_REPLYNO" + r["IID"], style = "width:100px" })
                                            }
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="4" style="color:red">
                                            *轉介單位請將本轉介單傳真至 產婦戶籍地所在衛生所
                                        </td>
                                    </tr>
                                </table>
                                <script>
                                     @if(r["MAR"].ToString() != "")
                 {
                    @:set_for_rb('RB_MAR@(r["IID"])', '@r["MAR"]');
                 }
                                       @if(r["CW"].ToString() != "")
                 {
                    @:set_for_rb('RB_CW@(r["IID"])', '@r["CW"]');
                 }
                                        @if(r["BREED"].ToString() != "")
                 {
                    @:set_for_rb('RB_BREED@(r["IID"])', '@r["BREED"]');
                 }
                                        @if(r["BREED_H"].ToString() != "")
                 {
                    @:set_for_rb('RB_BREED_H@(r["IID"])', '@r["BREED_H"]');
                 }


                                    @if (r["PAT_STA"].ToString() != "")
                                    {
                                        var PAT_STA = r["PAT_STA"].ToString();
                                        var PAT_STAV = new List<string>();

                                        for (var i = 0; i < PAT_STA.ToString().Length; i++)
                                        {
                                            if (PAT_STA[i] == '1')
                                            {
                                                PAT_STAV.Add(i.ToString());
                                            }
                                        }
                                                 @:set_for_ck('CK_PAT_STA@(r["IID"])', '@String.Join(",", PAT_STAV)');
                                             }

                                    @if (r["TRACE"].ToString() != "")
                                    {
                                        var TRACE = r["TRACE"].ToString();
                                        var TRACEV = new List<string>();

                                        for (var i = 0; i < TRACE.ToString().Length; i++)
                                        {
                                            if (TRACE[i] == '1')
                                            {
                                                TRACEV.Add(i.ToString());
                                            }
                                        }
                                                 @:set_for_ck('CK_TRACE@(r["IID"])', '@String.Join(",", TRACEV)');
                                             }

                                     @if (r["REF"].ToString() != "")
                                     {
                                         var REF = r["REF"].ToString();
                                         var REFV = new List<string>();

                                         for (var i = 0; i < REF.ToString().Length; i++)
                                         {
                                             if (REF[i] == '1')
                                             {
                                                 REFV.Add(i.ToString());
                                             }
                                         }
                                                 @:set_for_ck('CK_REF@(r["IID"])', '@String.Join(",", REFV)');
                                             }

                                     @if (r["REF_WAY"].ToString() != "")
                                     {
                                         var REF_WAY = r["REF_WAY"].ToString();
                                         var REF_WAYV = new List<string>();

                                         for (var i = 0; i < REF_WAY.ToString().Length; i++)
                                         {
                                             if (REF_WAY[i] == '1')
                                             {
                                                 REF_WAYV.Add(i.ToString());
                                             }
                                         }
                                                 @:set_for_ck('CK_REF_WAY@(r["IID"])', '@String.Join(",", REF_WAYV)');
                                             }
                                </script>
                            </div>
                        </td>
                    </tr>
                </table>
                <div style="text-align:center;">
                    <input type="submit" value="確定" />
                    <input type="button" value="取消" onclick="if (confirm('確認取消?')) window.close();" />
                </div>
            </form>
        </div>
    }
}

<script>
    $('form').on('keyup keypress', function (e) {
        var keyCode = e.keyCode || e.which;
        if (keyCode === 13) {
            e.preventDefault();
            return false;
        }
    });
</script>