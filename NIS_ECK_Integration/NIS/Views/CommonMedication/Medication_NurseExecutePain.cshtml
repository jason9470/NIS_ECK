@using NIS.Data;
@using System.Data;
@{
    Layout = "~/Views/Layout/FormLayout.cshtml";
    DataTable dt_stat = ViewBag.dt_stat;
    DataTable dt_reg = ViewBag.dt_reg;
    DataTable dt_iv = ViewBag.dt_iv;
    DataTable dt_prn = ViewBag.dt_prn;
    string checker = "";
    if (ViewBag.checker != null)
    { checker = ViewBag.checker; }
    string textname = ViewBag.text, udodrgcode = ViewBag.udodrgcode;
    string feeno = ViewBag.feeno, chrno = ViewBag.chrno;
    //日期選擇器，鎖定時間
    NIS.Data.PatientInfo pf = (NIS.Data.PatientInfo)Session["PatInfo"];
    NIS.Data.Complement_List complement_List = (NIS.Data.Complement_List)Session["Complement_List"];

}

<style type="text/css">
    /*頁籤的css，暫放*/
    .ui-tabs .ui-tabs-nav li a {
        font-size: 16px;
        padding: 3px 5px 3px 5px;
    }

    .ui-tabs {
        font-size: 16px;
    }

    .hide {
        display: none;
    }

    /*-----數字按鈕的css*/
    .FontSizeExample {
        font-size: 12px;
        text-align: left;
    }

    .WhiteBoxExample, .RedBoxExample {
        border: solid 1px #000;
    }

    .GreenBoxExample, .WhiteBoxExample, .BlueBoxExample, .RedBoxExample {
        width: 14px;
        word-break: break-all;
        font-weight: bold;
        text-align: center;
        display: inline-block;
    }

    .GreenBoxExample {
        background-color: #6AA84F;
    }

    .WhiteBoxExample {
        background-color: #fff;
    }

    .BlueBoxExample {
        background-color: #2B78E4;
    }

    .RedBoxExample, .RedBGExample {
        background-color: #CC0000;
    }

    .GrayBGExample {
        background-color: #808080;
    }

    .YellowBGExample {
        background-color: #FFE599;
    }
</style>

<script type="text/javascript">
    $(document).ready(function () {
        reloadMed('@(pf.InDate)');
          });

    function reloadMed(InDate) {       
        SetDatePicker($('#start_date'), '1d');
    }


    function SetDatePicker(DateObj, AddDay) {
        DateObj.prop('readonly', true).css({ 'width': '80px', 'font-size': '12px' });
        DateObj.datepicker({
            beforeShowDay: function (date) {
                switch (date.getDay()) {
                    case 6:
                        return [true, 'satday'];
                        break;
                    case 0:
                        return [true, 'sunday'];
                        break;
                    default:
                        return [true, ''];
                        break;
                }
            },
            inline: true,
            showAnim: "slideDown",
            controlType: myControl,
            maxDate: AddDay,
            minDate: '@pf.InDate.AddDays(-1)',
            changeYear: true,
            changeMonth: true,
            onSelect: function () {
                ChangeStartDate('', 'BtnNextDay,BtnDayBefore', 'txt', 'pain');
            }
        });
    }

    function Med_SearchList() {
        window.parent.ResetIframme('@Url.Content("~/CommonMedication/Med_SearchList")');
    }
</script>

<div>
    @{
        PatientInfo piInfo = (PatientInfo)Session["PatInfo"];
        @:床號：@(piInfo.BedNo)&emsp;
        @:病歷號：@(piInfo.ChartNo)&emsp;
        @:姓名：@(piInfo.PatientName)
    }
</div>
<div class="funcArea">
    <input type="hidden" id="execflag" name="execflag" value="" />
    @*<label>病人手圈：</label>
        @Html.TextBox("PatientNo", "", new { style = "width:100px", tabindex = "1" }) &emsp;&emsp;*@
    <input type="button" value="前一天" id="BtnDayBefore" onclick="ChangeStartDate('prev', 'BtnNextDay,BtnDayBefore', this, 'pain');" indate="@(ViewBag.InDate)" />
    <input type="text" id="start_date" name="start_date" onclick="reloadMed('@(pf.InDate)');" value="@(DateTime.Now.ToString("yyyy/MM/dd"))" />
    <input type="button" value="後一天" id="BtnNextDay" onclick="ChangeStartDate('next', 'BtnNextDay,BtnDayBefore', this, 'pain');" />
    <input type="button" value="醫囑查詢" onclick="@Java_funcion.pup_window("../CommonMedication/Med_QueryOrderPain", 900, 600, "");" />
    <input type="button" id="search" value="頻次表" onclick="OpenFrequency();" />
    @*<input type="button" value="批次註記" id="BtnBatch" onclick="OpenBatchRemark();" style="display:none;" />*@
    <input type="button" value="存檔" name="val" onclick="OpenChecksList('pain');" />
    @*<input type="button" value="給藥記錄單查詢" onclick="Med_SearchList();" />*@
    <input type="checkbox" id="Replenish" value="補登" />補登
    @Html.TextBox("TxtReplenishDate", DateTime.Now.ToString("yyyy/MM/dd"), new { @id = "TxtReplenishDate" })
    @Html.TextBox("TxtReplenishTime", DateTime.Now.ToString("HH:mm"), new { @id = "TxtReplenishTime" })
    @*@WebTool.setDateTime("TxtReplenishDate", "TxtReplenishTime")*@
    @WebTool.complementList_Status(complement_List.Status, pf.InDate.AddDays(-1).ToString("MM/dd/yyyy HH:mm"), @DateTime.Now.ToString("yyyy/MM/dd"), "TxtReplenishDate", "TxtReplenishTime", false)


</div>
@* <div class="funcArea" >
    <label>藥包條碼：</label>
      @Html.TextBox("udodrgcode", udodrgcode, new { style = "width:150px", tabindex = "2" }) &emsp;&emsp;
        &emsp;

        <input type="hidden" id="checker" value="" name="cker"/>
        <label id="l_checker"></label>
    </div>*@
@*<p>★：高危險性藥品&emsp;!：高危跌倒藥品&emsp;$：特殊藥品需監測病人反應&emsp;@@：不可磨粉&emsp;***：抗生素類藥品</p><hr />*@

<div id="PnMedResult">
    @{Html.RenderPartial("Medication_Result");}
</div>

<div style="margin-top:-7px">
    <table>
        <tr>
            <td class="FontSizeExample">
                按鈕顏色說明：
            </td>
            <td class="FontSizeExample"><div class="WhiteBoxExample"> &emsp; </div>&ensp;預計用藥時間</td>
            <td class="FontSizeExample"><div class="RedBoxExample"> &emsp; </div>&ensp;過時未給藥</td>
            <td class="FontSizeExample">&emsp; 藥物底色說明：</td>
            <td class="FontSizeExample"><div class="YellowBGExample" style="width:90px;text-align:center;">正常</div></td>
            <td class="FontSizeExample"><div class="GrayBGExample" style="width: 90px; text-align: center;">已過DC時間</div></td>
        </tr>
        <tr>
            <td class="FontSizeExample"></td>
            <td class="FontSizeExample"><div class="GreenBoxExample"> &emsp; </div>&ensp;已給藥</td>
            <td class="FontSizeExample"><div class="BlueBoxExample"> &emsp; </div>&ensp;取消給藥</td>
            <td class="FontSizeExample"></td>
            <td class="FontSizeExample"><div class="RedBGExample" style="width: 90px; text-align: center;">藥物過時未給</div></td>
            <td class="FontSizeExample"></td>
        </tr>
    </table>
</div>

<!--批次原因註記-->
@*<div id="dv_type" class="popup" >
        <span class="p_close">
            <img src="~/Images/Close.png" alt="關閉" onclick="cc();$('#dv_type').fadeOut(500);" />
        </span>
        <table style="border-style: solid; border-width: 2px; width: 100%; text-align:left">
            <tr>
                <td rowspan="2" style="width: 120px; height: 120px; text-align: left; padding: 8px;">
                    <img id="img1" src="../images/system/logo.png" style="width:100px;height:100px" />
                </td>
                <td style="text-align: left; padding: 8px;"colspan="2">
                    日期：
                    @Html.TextBox("date1", DateTime.Now.ToString("yyyy/MM/dd"))
                    @Html.TextBox("time1", DateTime.Now.ToString("HH:mm"))
                    @WebTool.setDateTime("date1", "time1")
                </td>
            </tr>
            <tr>
                <td colspan="2" style="text-align: left; padding: 8px;">
                    <textarea id="txt1" name="txt1" cols="60" rows="4" placeholder="醫囑"></textarea>
                </td>
            </tr>
            <tr>
                <td style="text-align:left;padding:8px;">
                    此次給予劑量：
                </td>
                <td style="text-align: left; padding: 8px;">
                    <input type="text" id="txt1" name="txt1" />&nbsp;
                    <label><input type="checkbox" id="chk1" name="chk1" />未給予</label>&emsp;
                    原因：
                    <select id="sel1">
                        <option value="-1">選擇原因</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td style="text-align:left;padding:8px;">
                    延遲給藥原因：
                </td>
                <td style="text-align: left; padding: 8px;">
                    <select id="sel1">
                        <option value="-1">選擇原因</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td style="text-align:left;padding:8px;">
                    備註：
                </td>
                <td style="text-align: left; padding: 8px;">
                    <input type="text" id="txt1" name="txt1" style="width:400px" />
                </td>
            </tr>
            <tr>
                <td style="text-align:right;padding:8px;" colspan="2">
                    <label><input type="checkbox" id="chk1" name="chk1" />帶入護理紀錄</label>
                    <input id="add" type="button" value="確認給藥" onclick="$('#dv_type').fadeOut(500); $('#block').hide();//reason('textbox','Z');" />
                    <input id="back" type="button" value="取消" onclick="$('#dv_type').fadeOut(500);$('#block').hide();" />
                </td>
            </tr>
        </table>
    </div>*@

<div id="dv_type1" class="popup">
    @{Html.RenderPartial("Medication_Remark");}
</div>
<div id="PnChecksRights" class="popup">
    @{Html.RenderPartial("Medication_3Checks5RightsPain");}
</div>
<div id="PnFrequency" class="popup">
    @{Html.RenderPartial("Medication_Frequency");}
</div>

<!--還沒改過-->
<div id="div_Med" class="popup2">
    <span class="p_close">
        <img src="~/Images/Close.png" alt="關閉" onclick="cc();$('#div_Med').fadeOut(500);" />
    </span>

    <input type="button" value="確定" name="div_med_ok" onclick="MedicinalInfo_Click('');$('#div_Med').fadeOut(500);">
    <input type="button" value="取消" name="div_med_cancel" onclick="cc();$('#div_Med').fadeOut(500);"><br />
    <label id="medmessage" style="display:none;color:yellow;background:red"></label>
    <table border='0' style='width:100%' id='MedInfo'>
        <tr>
            <th style='width:300px'>藥品圖片</th>
            <th style='width:300px'>藥品資訊</th>
        </tr>
        <tr style='text-align:left; vertical-align:top;'>
            <td style="text-align:center"><img src='' width="300" height="300" id="l_src" /></td>
            <td>
                <label id="l_drugname"></label><br />
                <label id="l_dose"></label><br />
                <label id="l_cir"></label><br />
                <label id="l_effect"></label><br />
                <label id="l_sideeffect"></label>
            </td>
        </tr>
    </table>
</div>
<!--還沒改過-->
<div id="div_login" class="popup" style="height:auto">
    <span style="text-align:left">覆核人員登入：</span>
    <table border="0" cellpadding="0" cellspacing="0" style="width:100%;padding:18px 7px 10px 4px;">
        <tr>
            <td>
                @Html.Label("txtid", "帳號：")
                @Html.TextBox("txtid", "", new { style = "width:160px;", tabindex = "11" })
            </td>
        </tr>
        <tr>
            <td style="padding:5px 0 5px 0;">
                @Html.Label("txtpwd", "密碼：")
                @Html.Password("txtpwd", "", new { style = "width:160px;", tabindex = "12" })
            </td>
        </tr>
        <tr>
            <td>
                <input type="button" value="確認" class="btn_m" onclick="DouCheck('ok')" tabindex="13" />
                <input type="button" value="取消" class="btn_m" onclick="DouCheck('cancel')" tabindex="14" />
            </td>
        </tr>
    </table>
</div>

<div id="block"></div>
<div id="saving">
    <label for="lab" style="font-size:16px">Saving...</label><br />
    <img src="~/Images/loading.gif" alt="" border="0" />
</div>
<script type="text/javascript">
    $(document).ready(function () {
        //SetDatePicker($('#start_date'), '1d');
        reloadMed('@(pf.InDate)');
    });
    </Script>