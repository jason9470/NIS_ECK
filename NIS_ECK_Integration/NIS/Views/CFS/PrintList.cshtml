@{
    Layout = "~/Views/Layout/FormLayout.cshtml";
    int x = 0;
    NIS.Data.PatientInfo ptinof = (NIS.Data.PatientInfo)ViewData["ptinfo"];
}
<script type="text/javascript">
    $(document).ready(function () {
        setGridColor();
    });
    function setGridColor() {
        //格行換色
        $('.dataArea_PDF tr:odd').css('background', '#ABC8E2');
        $('.dataArea_PDF tr:even').css('background', '#E1E6FA');
    }
</script>
@using System.Data;
@{
    DataTable dt = ViewBag.dt;
}
<form id="edu_form" action="Score" method="post">
    <div class="funcArea">
        <table border="0" cellpadding="0" cellspacing="0" style=" width:100%; font-size:14px;">
            <tr>
                <td>
                    <div style="text-align:center">
                    <b><label style="font-size:20px;">衰弱評估總表</label></b>
                    </div>
                    <br>
                    <table border="0" style="width:100%;">
                        <tr>
                            <td>病人姓名：@ptinof.PatientName</td>
                            @if (ptinof.Birthday != null)
                            {
                                <td>生日：@Convert.ToDateTime(ptinof.Birthday).ToString("yyyy/MM/dd")</td>
                            }
                            else
                            {
                                <td>生日：</td>
                            }
                            <td>年齡：@(ptinof.Age)  &nbsp; 性別：@(ptinof.PatientGender)</td>
                            @*<td>病床號：@ptinof.BedNo</td>*@
                            <td colspan="2">病歷號：@ptinof.ChartNo</td>
                        </tr>
                        <tr>
                            <td>科別：@ptinof.DeptName</td>
                            <td>主治醫師：@ptinof.DocName</td>
                            @if (ptinof.InDate != null)
                            {
                                <td>住院日期：@Convert.ToDateTime(ptinof.InDate).ToString("yyyy/MM/dd HH:mm") (@ptinof.InDay)</td>
                            }
                            else
                            {
                                <td>住院日期：</td>
                            }
                            <td colspan="2">診斷：@ptinof.ICD9_code1</td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td style="padding: 5px 0px 5px 0px; text-align:center">

                    <div class="dataHeader" style="margin-right:0px;">
                        <table border="0" cellpadding="4" cellspacing="1" style="width:100%;font-size:14px;">
                            <tr>                         
                                <td rowspan="2" style="width:15%;">日期時間</td>
                                <td colspan="3" style="width:30%;">CFS 衰弱評估</td>
                                <td colspan="2" style="width:30%;">Mini-Cog 失智評估</td>
                                <td rowspan="2" style="width:8%;">執行者</td>
                            </tr>
                            <tr>

                                <td colspan="2" style="width:20%;" title="">健康狀態</td>
                                <td title="" style="width:10%;">分數</td>
                                <td title="" style="width:10%;">總分</td>
                                <td title="" style="width:20%;">照片檔案</td>

                            </tr>
                        </table>
                    </div>
                    <div class="dataArea_PDF">
                       @if (dt != null && dt.Rows.Count > 0)
                       {
                        <table border="0" cellpadding="4" cellspacing="1" style="width:100%;font-size:14px;">
                            @foreach (DataRow r in dt.Rows)
                            {
                                string[] TempStrScore = { "是", "否", "無法評估" };
                                string status = "";
                                string status_detail = "";
                                var cog_1 = "";
                                var cog_2 = "";
                                var cog_3 = "";
                                var cog_result = "";
                                if (!string.IsNullOrEmpty(r["COG_RESULT"].ToString()))
                                {
                                    cog_result = r["COG_RESULT"].ToString();
                                }
                                if (!string.IsNullOrEmpty(r["CFS_SCORE"].ToString()))
                                {
                                    switch (Convert.ToInt32(r["CFS_SCORE"]))
                                    {
                                        case 1:
                                            status = "非常健康";
                                            status_detail = "健壯，覺得比同年齡層健康";
                                            break;
                                        case 2:
                                            status = "健康";
                                            status_detail = "無明顯疾病症狀，但不比同等級的人健康";
                                            break;
                                        case 3:
                                            status = "維持良好";
                                            status_detail = "可規律行走，患有慢性病但控制良好";
                                            break;
                                        case 4:
                                            status = "脆弱較易受傷害";
                                            status_detail = "日生活不需依賴他人，主訴行動緩慢或白天時覺得疲倦";
                                            break;
                                        case 5:
                                            status = "輕度衰弱";
                                            status_detail = "工具性日常生活(理財、搭交通工具、服藥、重型家務)需要幫助，行動明顯緩慢";
                                            break;
                                        case 6:
                                            status = "中度衰弱";
                                            status_detail = "所有室外活動和家務需要他人協助，上下樓梯及洗澡需要幫助";
                                            break;
                                        case 7:
                                            status = "嚴重衰弱";
                                            status_detail = "無論導因而生活完全無法自理，但身體狀況6個月內相對穩定無死亡風險";
                                            break;
                                        case 8:
                                            status = "非常嚴重衰弱";
                                            status_detail = "生活完全無法自理，接近生命終點";
                                            break;
                                        case 9:
                                            status = "末期";
                                            status_detail = "接近生命終點，預期壽命少於6個月";
                                            break;
                                    }

                                }
                                if (!string.IsNullOrEmpty(r["MC_SCORE1"].ToString()))
                                {
                                    cog_1 = r["MC_SCORE1"].ToString();
                                }
                                if (!string.IsNullOrEmpty(r["MC_SCORE2"].ToString()))
                                {
                                    switch (r["MC_SCORE2"].ToString())
                                    {
                                        case "0":
                                            cog_2 = "是";
                                            break;
                                        case "1":
                                            cog_2 = "否";
                                            break;
                                    }
                                }
                                if (!string.IsNullOrEmpty(r["MC_SCORE3"].ToString()))
                                {
                                    switch (r["MC_SCORE3"].ToString())
                                    {
                                        case "0":
                                            cog_3 = "是";
                                            break;
                                        case "1":
                                            cog_3 = "否";
                                            break;
                                    }
                                }
                                <tr style="height:60px">
                                    <td style="width:15%;text-align:center;">
                                        @Html.Raw(Convert.ToDateTime(r["ASSESS_DT"]).ToString("yyyy/MM/dd HH:mm"))
                                    </td>
                                    <td style="width:20%; text-align:center; height: 0px;">@((!string.IsNullOrEmpty(r["CFS_SCORE"].ToString())) ? (status.ToString()) : "")</td>
                                    <td style="width:10%; text-align:center;">
                                        <a class="tooltip" title="@((!string.IsNullOrEmpty(r["CFS_SCORE"].ToString())) ? r["CFS_SCORE"].ToString() : "")分  @status_detail">
                                            <font color="black">@((!string.IsNullOrEmpty(r["CFS_SCORE"].ToString())) ? r["CFS_SCORE"].ToString() : "")</font>
                                        </a>
                                    </td>
                                    <td style="width:10%;text-align:center;">
                                        @if (!string.IsNullOrEmpty(r["MC_SCORE"].ToString()))
                                        {
                                            if (r["MC_SCORE"].ToString() != "無法評估" && r["MC_SCORE"].ToString() != null)
                                            {
                                                <a class="tooltip" title="@((!string.IsNullOrEmpty(r["MC_SCORE"].ToString())) ? r["MC_SCORE"].ToString() : "")分 <br /> <b>病人可依引導於畫鐘後，正確覆誦紅色、快樂、腳踏車</b> <br />@cog_1 <br /> <br /> <b>病人可自行完成畫鐘數字及順序正確 </b><br />@cog_2 <br /> <br /><b>病人可於畫鐘上畫上指針正確指向 11:10</b><br />@cog_3">
                                                    <font color="black">@((!string.IsNullOrEmpty(r["MC_SCORE"].ToString())) ? r["MC_SCORE"].ToString() : "")</font>
                                                </a>
                                            }
                                            else
                                            {

                                            }
                                        }
                                        else
                                        {
                                            if (cog_result == "" || cog_result == null)
                                            {
                                                <a class="tooltip" title="無需評估">
                                                    <font color="black">無需評估</font>
                                                </a>
                                            }
                                            else
                                            {
                                                <a class="tooltip" title="無法評估 <br />原因:  @cog_result">
                                                    <font color="black">無法評估</font>
                                                </a>
                                            }
                                        }
                                    </td>
                                    <td style="width:20%;text-align:center;">

                                        @if (!string.IsNullOrWhiteSpace(r["CLOCK_FILE"].ToString()))
                                        {
                                            @*<img src="@Url.Content("~/Images/Function/func_data.png")" style="width:20px;height:20px;cursor:pointer;" onclick="ShowImg(this,'@(r["ASSESS_ID"])');" />*@
                                        byte[] imageBytes = (byte[])r["CLOCK_FILE"];
                                        string base64String = Convert.ToBase64String(imageBytes);
                                        <img src="@String.Format("data:image/png;base64,{0}", base64String)" style="width:50px;height:50px;cursor:pointer;" onclick="ShowImg(this,'@(r["ASSESS_ID"])');" />
                                        }
                                    </td>

                                    <td style="width:8%;text-align:center;">@r["MODIFY_USER_NAME"]</td>

                                </tr>



                                {
                                    x += 1;
                                }
                            }
                        </table>
                       }
                    </div>
                </td>
            </tr>
        </table>
    </div>
</form>