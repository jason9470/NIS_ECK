@using System.Data;
@using NIS.Data;
@{
    ViewBag.Title = "CheckTestButton";
    Layout = "~/Views/Layout/FormLayout.cshtml";

    string msg = ViewBag.msg;
    //日期選擇器，鎖定時間
    NIS.Data.PatientInfo pf = (NIS.Data.PatientInfo)ViewBag.ptinfo;
    NIS.Data.Complement_List complement_List = (NIS.Data.Complement_List)Session["Complement_List"];
}
<style type="text/css">
    .dataArea td {
        border-bottom: 1px solid rgba(20%,20%,40%,0.5);
        text-align: left;
        height:26px;
    }
</style>

<script type="text/javascript">
    $(function () {
        // 加入focus事件
        $(window).focus(function () {
            window.opener.parent.check_session();
        });
        setGridColor();
        @if (ViewBag.ER == "ER")
        {
            @:$('button').hide();
            @:$('button[value="查詢"]').show();
        }
    });

    //格行換色
    function setGridColor() {
        var tr = $('.dataArea tr');
        var color = '#ABC8E2';
        for (var i = 0; i < tr.length; i++) {
            if ($(tr[i]).css('display') != 'none') {
                $(tr[i]).css('background', color);
                if (color == '#ABC8E2')
                    color = '#E1E6FA';
                else
                    color = '#ABC8E2';
            }
        }
        $('.head').css('background', '#85A5CC');
    }

    function able(id) {
        document.getElementById(id).disabled = false;
        document.getElementById(id).focus();
    }
    function enable(id) {
        document.getElementById(id).disabled = true;
        $('#' + id).val('');
    }

    function div_hidden(id_list) {
        var list = id_list.split(',');
        for (var i = 0 ; i < list.length; i++) {
            $('.' + list[i]).fadeOut(0);
            var input_list = $('.' + list[i] + ' input, .' + list[i] + ' textarea');
            for (var j = 0 ; j < input_list.length; j++) {
                if (input_list[j].type == "textarea" || input_list[j].type == 'text')
                    $(input_list[j]).val('');
                else if  (input_list[j].type == 'radio')
                    input_list[j].checked = false;
                else {
                    if (input_list[j].checked)
                        $(input_list[j]).click();
                }
            }
        }
    }

    //螢幕鍵盤輸入_驗證
    function btn_write(date, name, id) {
        var word =  name + " " + $('#' + id).text()+"、";
        window.opener.document.getElementById('record_com').value += word;
    }

    function Search() {
        window.location.href = 'ExamButton?HasBtn=@(ViewBag.HasBtn)&stDate=' + $('#stDate').val() + '&edDate=' + $('#edDate').val() + '&feeno=@(pf.FeeNo)';
    }
</script>

<form action="CheckTest" method="post">
    <div class="funcArea">
        <table border="0" cellpadding="0" cellspacing="0" style="width:100%;">
            <tr>
                <td style="padding-bottom:5px;text-align:center;">
                    @if(string.IsNullOrWhiteSpace(ViewBag.HasBtn))
                    {
                    <span style="color:blue;font-size:26px;">檢查資料帶入護理紀錄</span>
                    }
                    else
                    {
                    <span style="color:blue;font-size:26px;">檢查資料</span>
                    }
                    @(Html.TextBox("stDate", DateTime.Now.ToString("yyyy/MM/dd"), new { @style = "width:70px" }))
                    ~
                    @(Html.TextBox("edDate", DateTime.Now.ToString("yyyy/MM/dd"), new { @style = "width:70px" }))
                    @*@WebTool.setDateTime("stDate")
                    @WebTool.setDateTime("edDate")*@
                    @WebTool.complementList_Status(complement_List.Status, pf.InDate.ToString("MM/dd/yyyy HH:mm"), @DateTime.Now.ToString("yyyy/MM/dd"), "stDate", "", false)
                    @WebTool.complementList_Status(complement_List.Status, pf.InDate.ToString("MM/dd/yyyy HH:mm"), @DateTime.Now.ToString("yyyy/MM/dd"), "edDate", "", false)
                    <input type="button" value="查詢" onclick="Search();" />
                </td>

            </tr>
            <tr>
                <td>
                    床號：@(pf.BedNo)&nbsp;&nbsp;&nbsp;病歷號：@(pf.ChartNo)&nbsp;&nbsp;&nbsp;姓名：@(pf.PatientName)
                </td>
            </tr>
            <tr>
                <td style="padding:5px 0 5px 0;">                   
                    <div class="dataArea" style="height:260px;">
                        <table border="0" cellpadding="4" cellspacing="1" style="width:100%;">
                      
                            <tr><th>檢查</th></tr>
                            <tr>
                                <td>
                                    @if (ViewData["exam"] != null && ((List<Exam>)ViewData["exam"]).Count > 0)
                                    {
                                        List<Exam> examlist = (List<Exam>)ViewData["exam"];
                                        <table border="1" width="100%">
                                            <tr>
                                                @*<th style="background:#E1E6FA;">帶紀錄</th>*@
                                                <th style="background:#E1E6FA;width:150px">執行日期</th>
                                                <th style="background:#E1E6FA;width:250px">檢查項目</th>
                                                <th style="background:#E1E6FA;">檢查結果</th>

                                            </tr>
                                            @for (int e = 0; e <= examlist.Count - 1; e++)
                                            {
                                                <tr>
                                                    <td style="text-align:center">
                                                        @*<input type="checkbox" name="exam_ck" value="@examlist[e].ExamNo" />*@
                                                        <input type="hidden" name="d_@examlist[e].ExamNo" value="@(examlist[e].ExamDate.ToString("yyyy/MM/dd HH:mm"))" />
                                                        <input type="hidden" name="i_@examlist[e].ExamNo" value="@(examlist[e].ExamName.ToString().Trim())" />
                                                        @*<input type="hidden" name="r_@examlist[e].ExamNo" value="@(examlist[e].ExamReport)" />*@
                                                   
                                                        @if (@Convert.ToDateTime(@examlist[e].ExamDate) != DateTime.MinValue)
                                                        {
                                                            @examlist[e].ExamDate.ToString("yyyy/MM/dd HH:mm")
                                                        }
                                                    </td>
                                                    <td style="text-align:center">
                                                        @if(string.IsNullOrWhiteSpace(ViewBag.HasBtn))
                                                        {
                                                        <input id="0" type="button" value="帶入" onclick="btn_write('@(examlist[e].ExamDate.ToString("yyyy/MM/dd HH:mm"))','@examlist[e].ExamName.ToString().Trim()','report_@e');" />
                                                        }
                                                 <br />
                                                          @examlist[e].ExamName.ToString().Trim()
                                                    </td>
                                                    <td width="50%" id="report_@e">
                                                        @examlist[e].ExamReport
                                                    @{ 
                                                        if (!string.IsNullOrEmpty(examlist[e].ExamUrl))
                                                        {
                                                            @:<input type="button" value="PACS畫面" onclick="window.open('@(examlist[e].ExamUrl)', 'url_dialog', 'menubar=no,status=no,scrollbars=yes,top=0,resizable=yes,left=200,toolbar=no,width=1024,height=768')" />
                                                        }
                                                    }
                                                    </td>
                                                </tr>
                                            }
                                        </table>
                                    }
                                    else
                                    {
                                        @Html.Raw("目前無資料")
                                    }
                                </td>
                            </tr>
                        </table>
                    </div>
                </td>
            </tr>
            <tr>
                <td style="padding:5px 0 5px 0;text-align:center;">
                    <div class="funcArea">
                        @*<input type="button" value="儲存" style="width:60px;" onclick="submit();" />*@
                        <input type="button" value="關閉" style="width:60px;" onclick="window.close();" />
                    </div>
                </td>
            </tr>
        </table>
    </div>
</form>