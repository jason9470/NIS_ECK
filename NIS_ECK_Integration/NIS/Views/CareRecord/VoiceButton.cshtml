@using System.Data;
@using NIS.Data;
@{
    ViewBag.Title = "CheckTestButton";
    Layout = "~/Views/Layout/FormLayout.cshtml";
    List<VoiceCommand> voicelist = (List<VoiceCommand>)ViewData["voice"];
    DataTable dt_phrase = ViewBag.dt_phraseData;

    string msg = ViewBag.msg;
//日期選擇器，鎖定時間
NIS.Data.PatientInfo pf = (NIS.Data.PatientInfo)Session["PatInfo"];
NIS.Data.Complement_List complement_List = (NIS.Data.Complement_List)Session["Complement_List"];
}
<style type="text/css">
    .dataArea td {
        border-bottom: 1px solid rgba(20%,20%,40%,0.5);
        text-align: left;
        /*height:26px;*/
    }

    .lab_error {
        color: #F00;
    }

    .hide {
        display: none;
    }
</style>

<script type="text/javascript">
    $(function () {
        // 加入focus事件
        $(window).focus(function () {
            window.opener.parent.check_session();
        });
        @if (ViewBag.ER == "ER")
        {
            @:$('button').hide();
            @:$('button[value="查詢"]').show();
        }
        setGridColor();
    });

    //格行換色
    function setGridColor() {
        var tr = $('.dataArea tr');
        var color = '#ABC8E2';
        for (var i = 0; i < tr.length; i++) {
            if ($(tr[i]).css('display') != 'none') {
                $(tr[i]).css('background', color);
                if (color == '#ABC8E2')
                    color = '#E1E6FA';
                else
                    color = '#ABC8E2';
            }
        }
        $('.head').css('background', '#85A5CC');
    }

    //格行換色 with 參數
    function setTableColor($tr) {
        var tr = $tr;
        var color = '#ABC8E2';
        for (var i = 0; i < tr.length; i++) {
            if ($(tr[i]).css('display') != 'none') {
                $(tr[i]).css('background', color);
                if (color == '#ABC8E2')
                    color = '#E1E6FA';
                else
                    color = '#ABC8E2';
            }
        }
        $('.head').css('background', '#85A5CC');
    }

    function able(id) {
        document.getElementById(id).disabled = false;
        document.getElementById(id).focus();
    }
    function enable(id) {
        document.getElementById(id).disabled = true;
        $('#' + id).val('');
    }

    function div_hidden(id_list) {
        var list = id_list.split(',');
        for (var i = 0 ; i < list.length; i++) {
            $('.' + list[i]).fadeOut(0);
            var input_list = $('.' + list[i] + ' input, .' + list[i] + ' textarea');
            for (var j = 0 ; j < input_list.length; j++) {
                if (input_list[j].type == "textarea" || input_list[j].type == 'text')
                    $(input_list[j]).val('');
                else if  (input_list[j].type == 'radio')
                    input_list[j].checked = false;
                else {
                    if (input_list[j].checked)
                        $(input_list[j]).click();
                }
            }
        }
    }

    function btn_write(date, name, ids)
    {  // 由於片語用特殊符號串接, 因此須作另外處理
        if (name.indexOf("と") == -1) {
            var word =  name + " " + "、";
        }
        else
        {
            var items = name.split('と');
            var title =  items[0] ;
            var item_c = items[1] ;
            var item_s = items[2] ;
            var item_o = items[3] ;
            var item_i = items[4] ;
            var word = items[1] + " " + "、";

            window.opener.document.getElementById('title').value = title ;
            window.opener.document.getElementById('record_s').value += item_s;
            window.opener.document.getElementById('record_o').value += item_o;
            window.opener.document.getElementById('record_i').value += item_i;
        }
        
        window.opener.document.getElementById('record_com').value += word;
    }

    function Search() {
        window.location.href = 'VoiceButton?HasBtn=@(ViewBag.HasBtn)&stDate=' + $('#stDate').val() + '&edDate=' + $('#edDate').val() ;
    }
</script>

<form action="CheckTest" method="post">
    <div class="funcArea">
        <table border="0" cellpadding="0" cellspacing="0" style="width:100%;">
            <tr>
                <td style="padding-bottom:5px;text-align:center;">
                    @if (string.IsNullOrWhiteSpace(ViewBag.HasBtn))
                    {
                        <span style="color:blue;font-size:26px;">語音執行項目</span>
                    }
                    else
                    {
                        <span style="color:blue;font-size:26px;">語音資料帶入</span>
                    }
                    @(Html.TextBox("stDate", DateTime.Now.ToString("yyyy/MM/dd"), new { @style = "width:70px" }))
                    ~
                    @(Html.TextBox("edDate", DateTime.Now.ToString("yyyy/MM/dd"), new { @style = "width:70px" }))
                   
                    @WebTool.complementList_Status(complement_List.Status, pf.InDate.ToString("MM/dd/yyyy HH:mm"), @DateTime.Now.ToString("yyyy/MM/dd"), "stDate", "", false)
                    @WebTool.complementList_Status(complement_List.Status, pf.InDate.ToString("MM/dd/yyyy HH:mm"), @DateTime.Now.ToString("yyyy/MM/dd"), "edDate", "", false)
                    <input type="button" value="查詢" onclick="Search();" />
                </td>

            </tr>
            <tr>
                <td style="padding:5px 0 5px 0;">
                    <div class="dataArea" style="height:100%;width:100%;overflow:auto;text-wrap:initial">
                        <table border="0" cellpadding="4" cellspacing="1">
                            <tr><th>執行項目  <input id="toggle_d" type='button' value="切換語音片語" onclick='toggle_voice();'></tr>
                            <tr class="flip-scroll-old">
                                <td>
                                    @if (dt_phrase != null && dt_phrase.Rows.Count > 0)
                                    {
                                        var p = 0;
                                        <table id="table_phrase" style="display:none;" class="table" border="1">
                                            <thead>
                                                <tr>
                                                    <th>片語標題</th>
                                                    <th>片語內容C</th>
                                                    <th>片語內容S</th>
                                                    <th>片語內容O</th>
                                                    <th>片語內容I</th>
                                                </tr>
                                            </thead>
                                            <tbody style="width:100%;">
                                                @foreach (DataRow r in dt_phrase.Rows)
                                                {
                                                    p += 1;
                                                    var content = r["NAME"] + "と" + r["C"] + "と" + r["S"] + "と" + r["O"] + "と" + r["I"];
                                                    <tr>
                                                        <td>
                                                            <input type="button" id="phrase_@p" value="帶入" onclick="btn_write('','@content','phrase_@p');" />
                                                            @r["NAME"]
                                                        </td>
                                                        <td>@r["C"]</td>
                                                        <td>@r["S"]</td>
                                                        <td>@r["O"]</td>
                                                        <td>@r["I"]</td>
                                                    </tr>
                                                }
                                            </tbody>

                                        </table>
                                    }
                                    else
                                    {
                                        @Html.Raw("無片語內容")
                                    }

                                    @if (voicelist != null && voicelist.Count > 0)
                                    {
                                        <table id="table_voice" class="table"   border="1">
                                            <thead>
                                                <tr>
                                                    <th>工作清單日期</th>
                                                    <th>內容</th>
                                                </tr>
                                            </thead>
                                            <tbody style="width:100%;">
                                                @for (int i = 0; i < voicelist.Count; i++)
                                                {
                                                    <tr>
                                                        <td>@voicelist[i].CREATE_TIME</td>
                                                        @{
                                                            var content = voicelist[i].Parameter; ;
                                                            content = content.Replace("{", "");
                                                            content = content.Replace("}", "");
                                                            content = content.Replace(@"""", "");
                                                            content = content.Substring(8);
                                                        }
                                                        <td>
                                                            <input type="button" id="voice_@i" value="帶入" onclick="btn_write('@voicelist[i].Start_Datetime','@content','voice_@i');" />
                                                            @content
                                                        </td>
                                                    </tr>
                                                }
                                                
                                            </tbody>
                                        </table>
                                    }
                                    else
                                    {
                                       @Html.Raw("工作清單無內容")
                                    }
                                </td>
                            </tr>

                        </table>
                    </div>
                </td>
            </tr>
            <tr>
                <td style="padding:5px 0 5px 0;text-align:center;">
                    <div class="funcArea">
                        <input type="button" value="關閉" style="width:60px;" onclick="window.close();" />
                    </div>
                </td>
            </tr>

        </table>
    </div>
</form>

<script>

    $(document).ready(function () {
        $("#ori_lab").removeAttr("style");                 
       
    });

    function toggle_voice() {
        $("#table_voice").toggle();
        $("#table_phrase").toggle();

        var $tmp = $("#toggle_d");
        $tmp.each(function () {
            if ($(this).val() == "切換語音片語")
                $(this).val("切換執行清單");
            else
                $(this).val("切換語音片語");
        });
    }

    

</script>